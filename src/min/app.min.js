"use strict";var eduwebApp=angular.module("eduwebApp",["ui.router","ui.bootstrap","dialogs.main","daterangepicker","ui.select","angularFileUpload","angularTrix","ui.grid","ui.grid.exporter","ui.grid.resizeColumns","ui.grid.pinning"]).constant("USER_ROLES",{all:"*",admin:"ADMIN",parent:"PARENT",staff:"STAFF",teacher:"TEACHER",sys_admin:"SYS_ADMIN"}).constant("AUTH_EVENTS",{loginSuccess:"auth-login-success",loginFailed:"auth-login-failed",logoutSuccess:"auth-logout-success",sessionTimeout:"auth-session-timeout",notAuthenticated:"auth-not-authenticated",notAuthorized:"auth-not-authorized",updatePwd:"update-pwd"}).config(["$httpProvider","$compileProvider",function(a,b){b.debugInfoEnabled(!1),a.interceptors.push(["$injector",function(a){return a.get("AuthInterceptor")}])}]);eduwebApp.filter("numeric",["$filter",function(a){return function(b){return 0>b?(b=Math.abs(b),b=a("currency")(b,""),b="("+b+")"):b=a("currency")(b,"")}}]),eduwebApp.filter("makePositive",["$filter",function(){return function(a){return Math.abs(a)}}]),eduwebApp.filter("titlecase",[function(){return function(a){return a=void 0===a||null===a?"":a,a.toString().toLowerCase().replace(/\b([a-z])/g,function(a){return a.toUpperCase()})}}]),eduwebApp.filter("arrayToList",[function(){return function(a){return a instanceof Array?a.join(", "):a}}]),eduwebApp.filter("makePositive",[function(){return function(a){return Math.abs(a)}}]),angular.module("eduwebApp").config(["$stateProvider","$urlRouterProvider","USER_ROLES",function(a,b,c){(function(){var a=!1;return function(b){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(b)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(b.substr(0,4)))&&(a=!0)}(navigator.userAgent||navigator.vendor||window.opera),!a})(),function(){return window.innerWidth<=768}();b.otherwise("/"),a.state("index",{url:"/",templateUrl:"app/landing.html",data:{authorizedRoles:[c.admin,c.parent,c.staff,c.teacher,c.sys_admin]}}).state("login",{url:"/login",templateUrl:"app/login.html",data:{authorizedRoles:[c.admin,c.parent,c.staff,c.teacher,c.sys_admin]}}).state("dashboard",{url:"/dashboard",templateUrl:"app/dashboard.html",data:{authorizedRoles:[c.admin,c.staff,c.teacher,c.sys_admin]}}).state("students",{url:"/students",params:{class_cat_id:null,class_id:null},templateUrl:"app/students/listStudents.html",data:{authorizedRoles:[c.admin,c.staff,c.teacher,c.sys_admin]}}).state("staff",{url:"/staff",params:{category:null,dept:null},templateUrl:"app/staff/listStaff.html",data:{authorizedRoles:[c.admin,c.staff,c.teacher,c.sys_admin]}}).state("fees/dashboard",{url:"/fees/dashboard",templateUrl:"app/fees/feesDashboard.html",data:{authorizedRoles:[c.admin,c.sys_admin]}}).state("fees/opening_balances",{url:"/fees/opening_balances",templateUrl:"app/fees/openingBalances.html",data:{authorizedRoles:[c.admin,c.sys_admin]}}).state("fees/invoices",{url:"/fees/invoices/:balance_status",templateUrl:"app/fees/invoices.html",data:{authorizedRoles:[c.admin,c.sys_admin]}}).state("fees/payments_received",{url:"/fees/payments_received",templateUrl:"app/fees/paymentsReceived.html",data:{authorizedRoles:[c.admin,c.sys_admin]}}).state("fees/fee_structure",{url:"/fees/fee_structure",templateUrl:"app/fees/feeStructure.html",data:{authorizedRoles:[c.admin,c.sys_admin]}}).state("fees/receipt/print",{url:"/fees/receipt/print",templateUrl:"app/fees/receipt.html",controller:"printReceiptCtrl",data:{authorizedRoles:[c.admin,c.sys_admin]}}).state("fees/invoice/print",{url:"/fees/invoice/print",templateUrl:"app/fees/invoice.html",controller:"printInvoiceCtrl",data:{authorizedRoles:[c.admin,c.sys_admin]}}).state("fees/statement/print",{url:"/fees/statement/print",templateUrl:"app/fees/statement.html",controller:"printStatementCtrl",data:{authorizedRoles:[c.admin,c.sys_admin]}}).state("school/departments",{url:"/school/departments",templateUrl:"app/school/departments.html",data:{authorizedRoles:[c.admin,c.sys_admin]}}).state("school/classes",{url:"/school/classes",params:{class_cat_id:null,class_id:null},templateUrl:"app/school/classes.html",data:{authorizedRoles:[c.admin,c.sys_admin]}}).state("school/subjects",{url:"/school/subjects",templateUrl:"app/school/subjects.html",data:{authorizedRoles:[c.admin,c.sys_admin]}}).state("my_classes/subjects",{url:"/school/subjects",templateUrl:"app/school/subjects.html",data:{authorizedRoles:[c.admin,c.sys_admin,c.teacher]}}).state("school/grading",{url:"/school/grading",templateUrl:"app/school/grading.html",data:{authorizedRoles:[c.admin,c.sys_admin]}}).state("school/school_dates",{url:"/school/school_dates",templateUrl:"app/school/dates.html",data:{authorizedRoles:[c.admin,c.sys_admin]}}).state("school/school_settings",{url:"/school/school_settings",templateUrl:"app/school/settings.html",data:{authorizedRoles:[c.admin,c.sys_admin]}}).state("exams/exams",{url:"/exams",templateUrl:"app/exams/listExams.html",data:{authorizedRoles:[c.admin,c.sys_admin,c.teacher]}}).state("exams/exam_types",{url:"/exams/exam_types",templateUrl:"app/exams/examTypes.html",data:{authorizedRoles:[c.admin,c.sys_admin,c.teacher]}}).state("exams/report_cards",{url:"/exams/report_cards",templateUrl:"app/exams/listReportCards.html",data:{authorizedRoles:[c.admin,c.sys_admin,c.teacher]}}).state("exams/report_card/print",{url:"/exams/report_card/print",templateUrl:"app/exams/reportCard.html",controller:"printReportCardCtrl",data:{authorizedRoles:[c.admin,c.sys_admin,c.teacher]}}).state("exams/class_analysis",{url:"/exams/class_analysis",templateUrl:"app/exams/classAnalysisReport.html",data:{authorizedRoles:[c.admin,c.sys_admin,c.teacher]}}).state("exams/analysis/print",{url:"/exams/analysis/print",templateUrl:"app/exams/printClassAnalysis.html",controller:"printClassAnalysisCtrl",data:{authorizedRoles:[c.admin,c.sys_admin,c.teacher]}}).state("school_settings",{url:"/school_settings",templateUrl:"app/school/settings.html",data:{authorizedRoles:[c.admin,c.sys_admin]}}).state("users",{url:"/users",templateUrl:"app/users/listUsers.html",data:{authorizedRoles:[c.admin,c.sys_admin]}}).state("communications/blog_posts",{url:"/communications/blog/posts",params:{class_id:null},templateUrl:"app/communications/listPosts.html",data:{authorizedRoles:[c.admin,c.teacher,c.sys_admin]}}).state("communications/homework",{url:"/communications/blog/homework",params:{class_id:null,subject_id:null},templateUrl:"app/communications/listHomework.html",data:{authorizedRoles:[c.admin,c.teacher,c.sys_admin]}}).state("communications/send_email",{url:"/communications/send_email",params:{class_id:null,subject_id:null},templateUrl:"app/communications/listEmails.html",data:{authorizedRoles:[c.admin,c.teacher,c.sys_admin]}}).state("communications/add_post",{url:"/communications/blog/post/:post_type",params:{action:"add",class_id:null,subject_id:null,class_subject_id:null},templateUrl:"app/communications/postForm.html",data:{authorizedRoles:[c.admin,c.teacher,c.sys_admin]}}).state("communications/edit_post",{url:"/communications/blog/post/:post_type/:post_id",params:{action:"edit",post:null},templateUrl:"app/communications/postForm.html",data:{authorizedRoles:[c.admin,c.teacher,c.sys_admin]}})}]),angular.module("eduwebApp").factory("AuthInterceptor",["$rootScope","$q","Session","AUTH_EVENTS",function(a,b,c,d){return{responseError:function(c){return a.$broadcast({401:d.notAuthenticated,403:d.notAuthorized,419:d.sessionTimeout,440:d.sessionTimeout}[c.status],c),b.reject(c)}}}]),angular.module("eduwebApp").directive("adjustForSmallScreen",["$window","$rootScope","$timeout",function(a,b,c){return function(d,e,f){setTimeout(function(){function d(){b.isSmallScreen=window.innerWidth<768;$(".navbar-header").height(),$(".content-fixed-header").height();b.isSmallScreen}$(".fixedHeader-floating").remove(),$("#navigation").hasClass("in")&&$("#mainnav").trigger("click"),c(function(){d()},100),a.addEventListener("resize",function(){c(function(){d()},100)},!1)},100)}}]).directive("ignoreDirty",[function(){return{restrict:"A",require:"ngModel",link:function(a,b,c,d){d.$setPristine=function(){},d.$pristine=!1}}}]).directive("numericOnly",[function(){return{require:"ngModel",link:function(a,b,c,d){d.$parsers.push(function(a){var b=a?a.replace(/[^\d.-]/g,""):null;return b!=a&&(d.$setViewValue(b),d.$commitViewValue(),d.$render()),b})}}}]).directive("ngEnter",[function(){return function(a,b,c){b.bind("keydown keypress",function(b){13===b.which&&(a.$apply(function(){a.$eval(c.ngEnter)}),b.preventDefault())})}}]).directive("mytabset",[function(){return{restrict:"E",replace:!0,transclude:!0,controller:function(a,b){a.templateUrl="";var c=a.tabs=[];a.selectTab=this.selectTab=function(d){angular.forEach(c,function(a){a.selected=!1}),d.selected=!0,a.searchTxt="Search"==d.title?a.savedSearchTxt:"",b.checkIfMobile?"Search"==d.title?setTimeout(function(){},1):"History"==d.title?setTimeout(function(){a.formatHistoryDataTables()},1):"GeoFence"==d.title&&setTimeout(function(){a.initGFTrucksDataGrids("assignOutTable")},1):"Search"==d.title?setTimeout(function(){a.zoomToSearchResults()},1):"History"==d.title?setTimeout(function(){a.zoomToHistoryPaths()},1):"GeoFence"==d.title?setTimeout(function(){a.initGFTrucksDataGrids("assignOutTable")},1):"Assets"==d.title||("Performance"==d.title?a.plotCharts():"Directions"==d.title&&setTimeout(a.initDirections,100)),angular.forEach(a.positions,function(a,b){a.isExpanded=!1}),angular.forEach(a.historyData,function(a,b){a.isExpanded=!0}),$(".vehicle-details").removeClass("in")},this.setTabTemplate=function(b){a.templateUrl=b},this.addTab=function(a){0==c.length?(a.show=!0,this.selectTab(a)):a.show="always"==a.showWhen,c.push(a)},a.activateTab=function(b){var c=a.tabs[b];c.show=!0,a.selectTab(c)},a.hideTab=function(b){var c=a.tabs[b];c.show=!1}},template:'<div class="full-height"><div class="panel-tabs"><ul class="nav nav-pills" ng-transclude></ul></div><div class="full-height2" id="mainView"><div class="full-height" ng-include="templateUrl"></div></div></div>'}}]).directive("mytab",[function(){return{restrict:"E",replace:!0,require:"^mytabset",scope:{title:"@",templateUrl:"@",showWhen:"@"},link:function(a,b,c,d){d.addTab(a),a.select=function(){d.selectTab(a)},a.$watch("selected",function(){a.selected&&d.setTabTemplate(a.templateUrl)})},template:'<li ng-class="{active: selected}" ng-show="show" id="{{ id }}"><a href="" ng-click="select()">{{ title }}</a></li>'}}]).directive("slideToggle",[function(){return{restrict:"A",link:function(a,b,c){var d=document.querySelector(c.slideToggle);c.expanded=c.expanded?c.expanded:!1,b.bind("click",function(){var a=d.querySelector(".slideable_content");if(c.expanded)d.style.height="0px";else{a.style.border="1px solid rgba(0,0,0,0)";a.clientHeight;a.style.border=0,d.style.height="340px"}})}}}]).directive("compile",["$compile",function(a){return function(b,c,d){b.$watch(function(a){return a.$eval(d.compile)},function(d){c.html(d),a(c.contents())(b)})}}]).directive("ngUserUnique",["apiService",function(a){return{require:"ngModel",link:function(b,c,d,e){c.on("blur",function(d){b.$apply(function(){var b=c.val();a.checkUsername(b,function(a){var b=angular.fromJson(a);"success"==b.response&&e.$setValidity("unique",data.unique)},function(a){})})})}}}]).directive("focusMe",["$timeout",function(a){return{scope:{trigger:"@focusMe"},link:function(b,c){b.$watch("trigger",function(b){"true"===b&&a(function(){c[0].focus()})})}}}]),angular.module("eduwebApp").run(["$rootScope","$state","$window","$timeout","Session","Auth","AUTH_EVENTS","apiService","dialogs",function(a,b,c,d,e,f,g,h,i){a.loggedIn=!1,a.currentPage="",a.isSmallScreen=!1,a.activeSection="";a.$on("$stateChangeStart",function(b,d,h){var i=window.location.host,j=i.substr(0,i.indexOf("."));a.clientIdentifier="parents"==j?"":j;var k=d.data.authorizedRoles.length>0?d.data.authorizedRoles:null,l=!1;a.currentPage=d.name,c.sessionStorage.userInfo?(l=!0,a.loggedIn=!0,a.currentUser=JSON.parse(c.sessionStorage.userInfo),e.create(a.currentUser),a.$broadcast(g.loginSuccess),a.getClassCats(),a.getAllClasses(),a.getEmpCats(),a.getDepts(),a.getCountries(),a.getInstallmentOptions()):"index"!=d.name&&(null===k||f.isAuthorized(k)||(f.isAuthenticated()?(a.$broadcast(g.notAuthorized),b.preventDefault()):l||(a.$broadcast(g.notAuthenticated),b.preventDefault())))}),a.$on("$stateChangeSuccess",function(b,c,e,f,g){a.navOpen=!1;var h=c.name;h=h.split("/"),a.activeSection=h[0],a.activeSubSection=void 0===h[1]?h[0]:h[1],a.activeSubSubSection=void 0===h[2]?h[0]:h[2],"print"==a.activeSubSubSection&&(a.isPrinting=!0),a.currentPageSection=h[0]+"/"+h[1],d(function(){$("#navigation").hasClass("in")&&($("#mainnav").trigger("click"),a.menuOn=!1)},100)}),a.wipNotice=function(){i.notify("Feature in Development","This feature is not yet complete, but hang in there, it will be awesome.",{size:"sm"})},a.checkIfMobile=function(){var a=!1;return function(b){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(b)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(b.substr(0,4)))&&(a=!0)}(navigator.userAgent||navigator.vendor||window.opera),a}(),a.showLogin=function(){a.$broadcast(g.notAuthenticated)},a.logout=function(){a.currentUser=null,a.permissions=null,f.logout()},a.userTypes=["SYS_ADMIN","TEACHER"],a.formatStudentData=function(a){var b=a.map(function(a){return a.student_name=a.first_name+" "+(a.middle_name||"")+" "+a.last_name,a.guardians&&(a.guardians=a.guardians.map(function(a){return a.parent_full_name=a.first_name+" "+(a.middle_name||"")+" "+a.last_name,a})),a.status=a.active?"Active":"In-Active",a.adoptedStr=a.adopted?"Yes":"No",a.adoptionAwareStr=a.adoption_aware?"Yes":"No",a.other_medical_conditions_str=a.other_medical_conditions?"Yes":"No",a.hospitalized_str=a.hospitalized?"Yes":"No",a.current_medical_treatment_str=a.current_medical_treatment?"Yes":"No",a.admission_date=null!==a.admission_date?moment(a.admission_date).format("YYYY-MM-DD"):"",a});return b},a.$on("studentAdded",function(b,c){a.$broadcast("refreshStudents",c)}),a.$on("invoiceAdded",function(b,c){a.$broadcast("refreshInvoices",c)}),a.$on("paymentAdded",function(b,c){a.$broadcast("refreshPayments",c)}),a.$on("feeItemAdded",function(b,c){a.$broadcast("refreshItems",c)}),a.$on("deptAdded",function(b,c){a.$broadcast("refreshDepartments",c)}),a.$on("termAdded",function(b,c){a.$broadcast("refreshDates",c)}),a.$on("subjectAdded",function(b,c){a.$broadcast("refreshSubjects",c)}),a.$on("classAdded",function(b,c){a.$broadcast("refreshClasses",c)}),a.$on("examMarksAdded",function(b,c){a.$broadcast("refreshExamMarks",c)}),a.$on("examMarksAdded2",function(b,c){a.$broadcast("refreshExamMarks2",c)}),a.$on("gradingAdded",function(b,c){a.$broadcast("refreshGrades",c)}),a.$on("employeeAdded",function(b,c){a.$broadcast("refreshStaff",c)}),a.$on("reportCardAdded",function(b,c){a.$broadcast("refreshReportCards",c)}),a.$on("reportCardAdded",function(b,c){a.$broadcast("refreshReportCards",c)}),a.$on("userAdded",function(b,c){a.$broadcast("refreshUsers",c)}),a.$on("postAdded",function(b,c){a.$broadcast("refreshPosts",c)}),a.$on("setSettings",function(b,d){a.currentUser.settings=angular.copy(d);var e=JSON.parse(c.sessionStorage.userInfo);e.settings=d,c.sessionStorage.userInfo=JSON.stringify(e)}),a.getClassCats=function(){if(void 0===a.classCats){var b="TEACHER"==a.currentUser.user_type?a.currentUser.emp_id:void 0;h.getClassCats(b,function(b){var c=angular.fromJson(b);"success"==c.response&&(a.classCats=c.data)},function(){})}},a.getAllClasses=function(){void 0===a.allClasses&&("TEACHER"==a.currentUser.user_type?h.getTeacherClasses(a.currentUser.emp_id,function(b){var c=angular.fromJson(b);return"success"==c.response&&(a.allClasses=c.data),c.data},function(){}):h.getAllClasses({},function(b){var c=angular.fromJson(b);return"success"==c.response&&(a.allClasses=c.data),c.data},function(){}))},a.getDepts=function(){void 0===a.allDepts&&h.getDepts(!0,function(b){var c=angular.fromJson(b);return"success"==c.response&&(a.allDepts=c.data),c.data},function(){})},a.getEmpCats=function(){void 0===a.empCats&&h.getEmpCats({},function(b){var c=angular.fromJson(b);return"success"==c.response&&(a.empCats=c.data),c.data},function(){})},a.getCountries=function(){void 0===a.countries&&h.getCountries({},function(b){var c=angular.fromJson(b);return"success"==c.response&&(a.countries=c.data),c.data},function(){})},a.getInstallmentOptions=function(){void 0===a.installmentOptions&&h.getInstallmentOptions({},function(b){var c=angular.fromJson(b);return"success"==c.response&&(a.installmentOptions=c.data),c.data},function(){})},a.getCurrentTerm=function(){h.getCurrentTerm({},function(b){var c=angular.fromJson(b);if("success"==c.response){a.currentTerm=c.data;var d=a.currentTerm.term_name;d=d.split(" "),a.currentTerm.term_name=d[1],a.currentTermTitle=a.currentTerm.term_name+", "+a.currentTerm.year}},function(){})},a.getPreviousTerm=function(){h.getPreviousTerm({},function(b){var c=angular.fromJson(b);if("success"==c.response){a.previousTerm=c.data;var d=a.previousTerm.term_name;d=d.split(" "),a.previousTerm.term_name=d[1],a.previousTermTitle=a.previousTerm.term_name+", "+a.previousTerm.year}},function(){})},a.getNextTerm=function(){h.getNextTerm({},function(b){var c=angular.fromJson(b);if("success"==c.response){a.nextTerm=c.data;var d=a.nextTerm.term_name;d=d.split(" "),a.nextTerm.term_name=d[1],a.nextTermTitle=a.nextTerm.term_name+", "+a.nextTerm.year}},function(){})},a.getTermRange=function(){h.getTermRange({},function(b){var c=angular.fromJson(b);"success"==c.response&&(a.termRange=c.data)},function(){})},a.setTermRanges=function(b){a.termRanges={},angular.forEach(b,function(b,c){a.termRanges[b.term_year_name]=[b.start_date,b.end_date]});var c=b.length-1;a.termRanges["Full Year"]=[b[0].start_date,b[c].end_date]},a.zeroPad=function(a,b){b=Math.max(b-1,0);var c=(a/Math.pow(10,b)).toFixed(b);return c.replace(".","")}}]),angular.module("eduwebApp").controller("ParentController",["$scope","$rootScope","$uibModal","dialogs","Auth","AUTH_EVENTS","USER_ROLES","$filter","$state","apiService",function(a,b,c,d,e,f,g,h,i,j){a.modalShown=!1,b.updatePwd=!1;var k=function(b){if(!a.modalShown){a.modalShown=!0;var d=c.open({templateUrl:"app/login.html",controller:"LoginCtrl",backdrop:"static",resolve:{token:function(){return b.token}}});d.result.then(function(){a.modalShown=!1},function(){a.modalShown=!1})["finally"](function(){a.modalInstance=void 0})}},l=function(){switch(b.permissions=[],b.manageUsers="SYS_ADMIN"==b.currentUser.user_type,b.useLetterhead=void 0!==b.currentUser.settings.Letterhead,b.currentUser.user_type){case"SYS_ADMIN":b.permissions={dashboard:{view:!0},students:{view:!0,add:!0,edit:!0,"import":!0},staff:{view:!0,add:!0,edit:!0,"import":!0},fees:{dashboard:{view:!0,add:!0,edit:!0},opening_balances:{view:!0,add:!0,edit:!0},invoices:{view:!0,add:!0,edit:!0,"delete":!0},payments_received:{view:!0,add:!0,edit:!0,"delete":!0},fee_structure:{view:!0,add:!0,edit:!0}},school:{school_settings:{view:!0,add:!0,edit:!0},school_dates:{view:!0,add:!0,edit:!0},grading:{view:!0,add:!0,edit:!0},subjects:{view:!0,add:!0,edit:!0},departments:{view:!0,add:!0,edit:!0},classes:{view:!0,add:!0,edit:!0}},exams:{exams:{view:!0,add:!0,edit:!0,"import":!0},exam_types:{view:!0,add:!0,edit:!0},report_cards:{view:!0,add:!0,edit:!0},class_analysis:{view:!0}},communications:{send_email:{view:!0,add:!0,edit:!0}}};break;case"TEACHER":b.permissions={dashboard:{view:!0},students:{alt_label:"my_students",view:!0},school:{alt_label:"my_classes",subjects:{view:!0,add:!1,edit:!0},classes:{view:!0,add:!1,edit:!0}},exams:{exams:{view:!0,add:!0,edit:!0,"import":!0},exam_types:{view:!0,add:!0,edit:!0},report_cards:{view:!0,add:!0,edit:!0},class_analysis:{view:!0}},communications:{blog_posts:{view:!0,add:!0,edit:!0},homework:{view:!0,add:!0,edit:!0},send_email:{view:!0,add:!0,edit:!0}}};break;default:b.permissions={dashboard:{view:!0}}}a.navItems=[],a.subOptions=[];var c=0;angular.forEach(b.permissions,function(b,d){if(void 0===b.view){var e={};angular.forEach(b,function(a,f){var g=void 0!==b.alt_label?h("titlecase")(b.alt_label.split("_").join(" ")):h("titlecase")(d.split("_").join(" "));"alt_label"!=f&&(0==c&&(e={id:d+"/"+f,label:g,section:d,subnav:[]}),e.subnav.push({id:d+"/"+f,label:h("titlecase")(f.split("_").join(" ")),section:d+"/"+f,subSection:f}),c++)}),a.navItems.push(e)}else if(b.view){var f=void 0!==b.alt_label?h("titlecase")(b.alt_label.split("_").join(" ")):h("titlecase")(d.split("_").join(" "));a.navItems.push({id:d,label:f,section:d})}c=0}),b.navItems=a.navItems;var d=b.currentPage;d=d.split("/");var e=d[0];d[1];angular.forEach(b.navItems,function(a,c){var d=a.section;d.toUpperCase()==e.toUpperCase()&&(b.mainSubNavItems=a.subnav)})},m=function(a){b.$broadcast("displayLoginError",a)},n=function(){b.$broadcast("displayLoginError"),b.updatePwd=!0;var a=d.create("updatePwd.html","updatePwdCtrl",{user:b.currentUser},{size:"md",backdrop:"static"});a.result.then(function(a){b.$broadcast("pwdUpdatedMsg")},function(){})},o=function(){b.loggedIn=!1,i.go("index")};a.userRoles=g,a.isAuthorized=e.isAuthorized,b.$on(f.notAuthorized,k),b.$on(f.notAuthenticated,k),b.$on(f.sessionTimeout,k),b.$on(f.logoutSuccess,o),b.$on(f.loginSuccess,l),b.$on(f.loginFailed,function(a,b){m(b)}),b.$on(f.updatePwd,n),a.openModal=function(c,e,f,g){if($("#filterLinks").hasClass("in")&&$("#subnav").trigger("click"),!a.modalShown){a.modalShown=!0;var h=e+"Ctrl";void 0===f&&(f="lg");var i=d.create("app/"+c+"/"+e+".html",h,g,{keyboard:!0,backdrop:"static",size:f});i.result.then(function(c){a.modalShown=!1,b.isSearchModal=!1,b.printModal=!1},function(){a.modalShown=!1,b.isSearchModal=!1,b.printModal=!1}),b.theModal=i}},b.chartColors=["rgba(151,187,205,1)","rgba(220,220,220,1)","rgba(247,70,74,1)","rgba(70,191,189,1)","rgba(253,180,92,1)","rgba(148,159,177,1)","rgba(77,83,96,1)","rgba(181,221,56,1)","rgba(218,150,240,1)"]}]),angular.module("eduwebApp").controller("landingCtrl",["$scope","$rootScope","$state","$window","Auth","apiService",function(a,b,c,d,e,f,g){a.credentials={},a.loginForm={},a.error=!1,a.loggingIn=!1;if(a.hitEnter=function(b){a.submit()},a.submit=function(){return a.submitted=!0,a.loggingIn=!0,a.loginForm.$invalid?(a.error=!0,a.errorMsg="You must enter your login credentials below.",void(a.loggingIn=!1)):void a.login(a.credentials)},a.cancel=function(){},a.login=function(d){a.error=!1,e.login(d,function(d){a.loggingIn=!1,a.loggedIn=!0,"PARENT"==b.currentUser.user_type?c.go("portal_dashboard"):void 0===b.currentUser.settings["School Name"]?c.go("school/school_settings"):c.go("dashboard")},function(b){a.credentials.user_pwd="",a.error=!0,a.loggingIn=!1})},b.$on("displayLoginError",function(b,c){a.errorMsg=c.errorMsg,a.credentials.user_pwd="",a.error=!0,a.loggingIn=!1}),b.$on("pwdUpdatedMsg",function(b,c){a.credentials.user_pwd="",a.submitted=!1,a.error=!1,a.pwdupdated=!0,a.loggingIn=!1,a.loginForm.user_pwd.$dirty=!1,a.loginForm.user_pwd.$invalid=!1,$("input[name=user_pwd]").focus()}),d.sessionStorage.userInfo){var h=JSON.parse(d.sessionStorage.userInfo);a.login(h)}}]),angular.module("eduwebApp").controller("dashboardCtrl",["$scope","$rootScope","apiService",function(a,b,c){a.studentsLoading=!0,a.staffLoading=!0,a.examsLoading=!0,a.fees1Loading=!0,a.fees2Loading=!0,a.fees3Loading=!0,a.newsLoading=!0,a.isTeacher="TEACHER"==b.currentUser.user_type;var d=function(){c.getClassCatsSummary(status,function(b){var c=angular.fromJson(b);"success"==c.response?(a.classCats=c.data,a.studentsLoading=!1):(a.error=!0,a.errMsg=c.data,a.studentsLoading=!1)},function(){})},e=function(){var d=b.currentUser.emp_id+"/true";c.getTeacherClasses(d,function(b){var c=angular.fromJson(b);"success"==c.response?(a.myClasses=void 0!==c.nodata?[]:c.data,a.studentsLoading=!1):(a.error=!0,a.errMsg=c.data,a.studentsLoading=!1)},function(){})},f=function(){var d=b.currentUser.emp_id+"/true";c.getTeacherSubjects(d,function(b){var c=angular.fromJson(b);"success"==c.response?(a.subjects=void 0!==c.nodata?[]:c.data,a.studentsLoading=!1):(a.error=!0,a.errMsg=c.data,a.studentsLoading=!1)},function(){})},g=function(){c.getDeptSummary(status,function(b){var c=angular.fromJson(b);"success"==c.response?(a.deptCats=c.data,a.staffLoading=!1):(a.error=!0,a.errMsg=c.data,a.staffLoading=!1)},function(){})},h=function(){c.getCurrentTerm({},function(b){var c=angular.fromJson(b);if("success"==c.response)if(a.currentTerm=c.data||void 0,void 0!==a.currentTerm){a.currentTermTitle=a.currentTerm.term_name+" "+a.currentTerm.year;var d=moment().add(1,"day").format("YYYY-MM-DD");a.date={startDate:a.currentTerm.start_date,endDate:d},i(a.currentTerm.start_date,d)}else a.fees1Loading=!1,a.numPaymentsReceived=0},function(){});var b=moment().startOf("month").format("YYYY-MM-DD"),d=moment().endOf("month").format("YYYY-MM-DD");k(b,d),m()},i=function(a,b){var d=a+"/"+b+"/false";c.getPaymentsReceived(d,j,q)},j=function(b,c){var d=angular.fromJson(b);"success"==d.response?(a.numPaymentsReceived=void 0!==d.nodata?0:d.data.length,a.fees1Loading=!1):(a.prError=!0,a.prErrMsg=d.data,a.fees1Loading=!1)},k=function(a,b){var d=a+"/"+b;c.getPaymentsDue(d,l,q)},l=function(b,c){var d=angular.fromJson(b);"success"==d.response?(a.numPaymentsDue=void 0!==d.nodata?0:d.data.length,a.fees2Loading=!1):(a.prError=!0,a.prErrMsg=d.data,a.fees2Loading=!1)},m=function(){c.getPaymentsPastDue({},n,q)},n=function(b,c){var d=angular.fromJson(b);"success"==d.response?(a.numPaymentsPastDue=void 0!==d.nodata?0:d.data.length,a.fees3Loading=!1):(a.prError=!0,a.prErrMsg=d.data,a.fees3Loading=!1)},o=function(){a.isTeacher?c.getTeacherTopStudents(b.currentUser.emp_id,p,q):c.getTopStudents(void 0,p,q)},p=function(b,c){var d=angular.fromJson(b);if("success"==d.response){a.examsLoading=!1;var e=void 0!==d.nodata?[]:d.data;a.classes=[];var f="",g=[],h=0;angular.forEach(e,function(b,c){b.class_id!=f&&(h>0&&(a.classes[h-1].students=g),a.classes.push({class_id:b.class_id,class_name:b.class_name,students:[]}),g=[],h++),g.push({student_name:b.student_name,student_id:b.student_id,total_mark:b.total_mark,total_grade_weight:b.total_grade_weight,position:b.rank,position_out_of:b.position_out_of,grade:b.grade}),f=b.class_id}),a.classes[h-1]&&(a.classes[h-1].students=g)}else a.prError=!0,a.prErrMsg=d.data,a.examsLoading=!1},q=function(b,c){var d=angular.fromJson(b);a.error=!0,a.errMsg=d.data},r=function(){a.isTeacher?(e(),f(),o()):(d(),g(),h(),o())};setTimeout(r(),10),a.$on("$destroy",function(){a.dataGrid&&($(".fixedHeader-floating").remove(),a.dataGrid.fixedHeader.destroy(),a.dataGrid.clear(),a.dataGrid.destroy()),b.isModal=!1})}]),angular.module("eduwebApp").controller("LoginCtrl",["$scope","$rootScope","$state","$uibModalInstance","$window","Auth","apiService",function(a,b,c,d,e,f,g,h){a.credentials={},a.loginForm={},a.error=!1,a.loggingIn=!1;if(a.hitEnter=function(b){a.submit()},a.submit=function(){return a.submitted=!0,a.loggingIn=!0,a.loginForm.$invalid?(a.error=!0,a.errorMsg="You must enter your login credentials below.",void(a.loggingIn=!1)):void a.login(a.credentials)},a.cancel=function(){d.dismiss("canceled")},a.login=function(e){a.error=!1,f.login(e,function(e){a.loggingIn=!1,setTimeout(function(){d.dismiss("cancel")},100),"PARENT"==b.currentUser.user_type?c.go("portal_dashboard"):c.go("dashboard")},function(b){a.credentials.user_pwd="",a.error=!0,a.loggingIn=!1})},b.$on("displayLoginError",function(b,c){a.errorMsg=c.errorMsg,a.credentials.user_pwd="",a.error=!0,a.loggingIn=!1}),b.$on("pwdUpdatedMsg",function(b,c){a.credentials.user_pwd="",a.submitted=!1,a.error=!1,a.pwdupdated=!0,a.loggingIn=!1,a.loginForm.user_pwd.$dirty=!1,a.loginForm.user_pwd.$invalid=!1,$("input[name=user_pwd]").focus()}),e.sessionStorage.userInfo){var i=JSON.parse(e.sessionStorage.userInfo);a.login(i)}}]).controller("updatePwdCtrl",["$scope","$uibModalInstance","data","$timeout","apiService",function(a,b,c,d,e){a.user=c.user,a.user.old_pwd=a.user.user_pwd,a.user.user_pwd="",a.cancel=function(){b.dismiss("Canceled")},a.updatePwd=function(c){if(a.user.old_pwd==a.user.user_pwd)c.user_pwd.$error.pwdnotnew=!0;else{var d={api_action:"update_pwd",user_name:a.user.user_name,new_user_pwd:a.user.user_pwd,user_id:a.user.user_id};e.postUserRequest(angular.toJson(d),function(c,d){b.close(a.user)},function(b,c){var d=angular.fromJson(b);a.error=!0,a.notificationMsg=d.data})}},a.hitEnter=function(b){angular.equals(b.keyCode,13)&&a.updatePwd();
}}]).run(["$templateCache",function(a){a.put("updatePwd.html",'<div class="modal-header modal-warning dialog-header-form"><h4 class="modal-title"><span class="fa fa-exclamation-triangle"></span> Password is Expired</h4></div><div class="modal-body"><ng-form name="updatePwdDialog" novalidate role="form" class="form-horizontal" method="post"><div class="notification alert alert-danger" ng-show="error">{{notificationMsg}}</div><p>Your password has expired, please create a new password below.</p><div><label for="user_pwd">Password</label><div ng-class="{ \'has-error\' : updatePwdDialog.user_pwd.$dirty && updatePwdDialog.user_pwd.$error.pwdnotnew && (updatePwdDialog.user_pwd.$touched || updatePwdDialog.$submitted) }"><input type="password" class="form-control immediate-help" name="user_pwd" ng-model="user.user_pwd" password-validate="{{user.old_pwd}}" required id="inputPassword"><div class="input-help"><h4>Password must meet the following requirements:</h4><ul><li ng-class="pwdHasLetter">At least <strong>one letter</strong></li><li ng-class="pwdHasNumber">At least <strong>one number</strong></li> <li ng-class="pwdValidLength">At least <strong>8 characters long</strong></li></ul></div><p ng-show="updatePwdDialog.user_pwd.$dirty && updatePwdDialog.user_pwd.$error.pwdnotnew && (updatePwdDialog.user_pwd.$touched || updatePwdDialog.$submitted)" class="help-block"><i class="fa fa-exclamation-triangle"></i> You must enter a new password.</p></div></div><div ng-class="{ \'has-error\' : updatePwdDialog.verify_password.$dirty && updatePwdDialog.verify_password.$error.pwmatch && (updatePwdDialog.verify_password.$touched || updatePwdDialog.$submitted) }"><label for="verify_password">Verify Password</label><div><input type="password" class="form-control" name="verify_password" ng-model="user.verify_password" pw-check="inputPassword" required><p ng-show="updatePwdDialog.verify_password.$dirty && updatePwdDialog.verify_password.$error.pwmatch && (updatePwdDialog.verify_password.$touched || updatePwdDialog.$submitted)" class="help-block"><i class="fa fa-exclamation-triangle"></i> Password does not match.</span></div></div></ng-form></div><div class="modal-footer"><div class="pull-left alert alert-danger col-sm-8" ng-show="error">{{msg}}</div><button type="button" class="btn btn-default" ng-click="cancel()">Cancel</button><button type="button" class="btn btn-primary" ng-click="updatePwd(updatePwdDialog)">Update</button></div>')}]),angular.module("eduwebApp").controller("listEmailsCtrl",["$scope","$rootScope","apiService","$timeout","$window","$filter","$state",function(a,b,c,d,e,f,g){a.filters={},a.filters.audience_id=null,a.filters.com_type_id=null,a.filters.post_status_id=null,a.alert={},a.loading=!0,a.isTeacher="TEACHER"==b.currentUser.user_type,a.gridFilter={},a.gridFilter.filterValue="";var h=function(){return'<div class="clickable">  <div ng-if="row.entity.merge">{{row.entity.title}}</div>  <div ng-if="!row.entity.merge" ng-repeat="(colRenderIndex, col) in colContainer.renderedColumns track by col.colDef.name" class="ui-grid-cell" ng-class="{ \'ui-grid-row-header-cell\': col.isRowHeader }"  ui-grid-cell></div></div>'};a.gridOptions={enableSorting:!0,rowTemplate:h(),rowHeight:24,columnDefs:[{name:"Date",field:"creation_date",type:"date",enableColumnMenu:!1,sort:{direction:"asc"},cellTemplate:'<div class="ui-grid-cell-contents" ng-click="grid.appScope.viewEmail(row.entity)">{{row.entity.creation_date|date:"MMM d yyyy, h:mm a"}}</div>'},{name:"Type",field:"com_type",enableColumnMenu:!1,cellTemplate:'<div class="ui-grid-cell-contents" ng-click="grid.appScope.viewEmail(row.entity)">{{row.entity.com_type}}</div>'},{name:"Recipient",field:"audience",enableColumnMenu:!1,cellTemplate:'<div class="ui-grid-cell-contents" ng-click="grid.appScope.viewEmail(row.entity)">{{row.entity.audience}}</div>'},{name:"Subject",field:"subject",enableColumnMenu:!1,cellTemplate:'<div class="ui-grid-cell-contents" ng-click="grid.appScope.viewEmail(row.entity)">{{row.entity.subject}}</div>'},{name:"Message",field:"message",enableColumnMenu:!1,width:"40%",cellTemplate:'<div class="ui-grid-cell-contents" ng-click="grid.appScope.viewEmail(row.entity)" ng-bind-html="row.entity.message"></div>'},{name:"Status",field:"post_status",width:75,enableColumnMenu:!1,cellTemplate:'<div class="ui-grid-cell-contents" ng-click="grid.appScope.viewEmail(row.entity)">{{row.entity.post_status}}</div>'},{name:"View",field:"",cellClass:"center",width:40,headerCellClass:"center",enableColumnMenu:!1,cellTemplate:'<div class="ui-grid-cell-contents" ng-click="grid.appScope.preview(row.entity)"><i class="fa fa-eye"></i></div>'}],exporterCsvFilename:"school-departments.csv",onRegisterApi:function(b){a.gridApi=b,a.gridApi.grid.registerRowsProcessor(a.singleFilter,200),d(function(){a.gridApi.core.handleWindowResize()})}};var i=function(){setTimeout(function(){var b=$(".full-height.datagrid").height();$("#grid1").css("height",b),a.gridApi.core.handleWindowResize()},100),void 0===b.postStatuses?c.getBlogPostStatuses({},function(c){var d=angular.fromJson(c);"success"==d.response&&(a.postStatuses=d.data,b.postStatuses=a.postStatuses)},m):a.postStatuses=b.postStatuses,void 0===b.comTypes?c.getCommunicationOptions({},function(c){var d=angular.fromJson(c);"success"==d.response&&(b.comTypes=a.comTypes=d.data.com_types,b.comAudience=a.comAudience=d.data.audiences)},m):(a.comTypes=b.comTypes,a.comAudience=b.comAudience),j()};d(i,1);var j=function(d){if(a.isTeacher){var e=b.currentUser.emp_id;c.getTeacherCommunications(e,k,m,{filters:d})}else c.getSchoolCommunications({},k,m,{filters:d})},k=function(b,c,d){var e=angular.fromJson(b);"success"==e.response?(a.emails=e.nodata?[]:e.data,a.emails=a.emails.map(function(a){return a.creation_date=new Date(a.creation_date),a.send_method=a.send_as_sms?"sms":"email",a.message_truncated=a.message.length>100?a.message.substring(0,100)+"...":a.message,a.body=a.message,a.title=a.subject,a}),a.allResults=a.emails,d.filters?a.loadFilter():l(a.emails)):(a.error=!0,a.errMsg=e.data),a.loading=!1};a.loadFilter=function(){a.loading=!0;var b=a.allResults;null!==a.filters.audience_id&&(b=b.reduce(function(b,c){return c.audience_id.toString()==a.filters.audience_id.toString()&&b.push(c),b},[])),null!==a.filters.com_type_id&&(b=b.reduce(function(b,c){return c.com_type_id.toString()==a.filters.com_type_id.toString()&&b.push(c),b},[])),null!==a.filters.post_status_id&&(b=b.reduce(function(b,c){return c.post_status_id.toString()==a.filters.post_status_id.toString()&&b.push(c),b},[])),a.emails=b,l(a.emails)};var l=function(c){a.gridOptions.data=c,a.loading=!1,b.loading=!1};a.filterDataTable=function(){a.gridApi.grid.refresh()},a.clearFilterDataTable=function(){a.gridFilter.filterValue="",a.gridApi.grid.refresh()},a.singleFilter=function(b){var c=new RegExp(a.gridFilter.filterValue,"i");return b.forEach(function(a){var b=!1;["com_type","audience","subject","message","post_status"].forEach(function(d){a.entity[d].match(c)&&(b=!0)}),b||(a.visible=!1)}),b};var m=function(b,c){var d=angular.fromJson(b);a.error=!0,a.errMsg=d.data};a.preview=function(b){var c={type:"communication",post:b};a.openModal("communications","previewPost","md",c)},a.addPost=function(){g.go("communications/add_post",{class_id:a.filters.class_id,post_type:"post"})},a.addHomework=function(){g.go("communications/add_post",{class_id:a.filters.class_id,post_type:"homework"})},a.addEmail=function(){g.go("communications/add_post",{post_type:"communication"})},a.viewEmail=function(a){g.go("communications/edit_post",{post:a,post_id:a.post_id,post_type:"communication"})},a.$on("refreshPosts",function(c,e){a.loading=!0,b.loading=!0,void 0!==e&&(a.updated=!0,a.notificationMsg=e.msg),a.refresh(),d(function(){a.alert.expired=!0},2e3),d(function(){a.updated=!1,a.notificationMsg="",a.alert.expired=!1},3e3)}),a.refresh=function(){a.loading=!0,b.loading=!0,j(angular.copy(a.filters))},a.$on("$destroy",function(){b.isModal=!1})}]),angular.module("eduwebApp").controller("listHomeworkCtrl",["$scope","$rootScope","apiService","$timeout","$window","$filter","$state",function(a,b,c,d,e,f,g){a.filters={},a.filters.post_status_id=null,a.filters.class_id=""!==g.params.class_id?g.params.class_id:null,a.filters.subject_id=""!==g.params.subject_id?g.params.subject_id:null,a.filterClass=""!==g.params.class_id,a.alert={},a.loading=!0,a.gridFilter={},a.gridFilter.filterValue="";var h=function(){return'<div class="clickable">  <div ng-if="row.entity.merge">{{row.entity.title}}</div>  <div ng-if="!row.entity.merge" ng-repeat="(colRenderIndex, col) in colContainer.renderedColumns track by col.colDef.name" class="ui-grid-cell" ng-class="{ \'ui-grid-row-header-cell\': col.isRowHeader }"  ui-grid-cell></div></div>'};a.gridOptions={enableSorting:!0,rowTemplate:h(),rowHeight:24,columnDefs:[{name:"Class",field:"class_name",enableColumnMenu:!1,sort:{direction:"asc"},cellTemplate:'<div class="ui-grid-cell-contents" ng-click="grid.appScope.viewPost(row.entity)">{{row.entity.class_name}}</div>'},{name:"Subject",field:"subject_name",enableColumnMenu:!1,cellTemplate:'<div class="ui-grid-cell-contents" ng-click="grid.appScope.viewPost(row.entity)">{{row.entity.subject_name}}</div>'},{name:"Title",field:"title",enableColumnMenu:!1,cellTemplate:'<div class="ui-grid-cell-contents" ng-click="grid.appScope.viewPost(row.entity)">{{row.entity.title}}</div>'},{name:"Assigned Date",field:"assigned_date2",type:"date",enableColumnMenu:!1,cellTemplate:'<div class="ui-grid-cell-contents" ng-click="grid.appScope.viewPost(row.entity)">{{row.entity.assigned_date2|date:"MMM d yyyy, h:mm a}}</div>'},{name:"Due Date",field:"due_date2",type:"date",cellFilter:"date",enableColumnMenu:!1,cellTemplate:'<div class="ui-grid-cell-contents" ng-click="grid.appScope.viewPost(row.entity)">{{row.entity.due_date2}}</div>'},{name:"Status",field:"post_status",width:75,enableColumnMenu:!1,cellTemplate:'<div class="ui-grid-cell-contents" ng-click="grid.appScope.viewPost(row.entity)">{{row.entity.post_status}}</div>'},{name:"View",field:"",cellClass:"center",width:40,headerCellClass:"center",enableColumnMenu:!1,cellTemplate:'<div class="ui-grid-cell-contents" ng-click="grid.appScope.preview(row.entity)"><i class="fa fa-eye"></i></div>'}],onRegisterApi:function(b){a.gridApi=b,a.gridApi.grid.registerRowsProcessor(a.singleFilter,200),d(function(){a.gridApi.core.handleWindowResize()})}};var i=function(){setTimeout(function(){var b=$(".full-height.datagrid").height();$("#grid1").css("height",b),a.gridApi.core.handleWindowResize()},100),void 0===b.postStatuses?c.getBlogPostStatuses({},function(c){var d=angular.fromJson(c);"success"==d.response&&(a.postStatuses=d.data,b.postStatuses=a.postStatuses)},o):a.postStatuses=b.postStatuses,j()};d(i,1),a.$watch("filters.class_id",function(b,c){b!=c&&(a.classSubjects=a.allClassSubjects.reduce(function(a,c){return c.class_id==b&&a.push(c),a},[]),d(n,10))});var j=function(){var d=b.currentUser.emp_id;c.getTeacherClassSubjects(d,function(b,c){var d=angular.fromJson(b);if("success"==d.response)if(a.allClassSubjects=d.nodata?[]:d.data,a.allClassSubjects.length>0){if(a.classes=a.allClassSubjects.reduce(function(a,b){var c={class_id:b.class_id,class_name:b.class_name};return k(c,a)||a.push(c),a},[]),null!==a.filters.subject_id){a.classSubjects=a.allClassSubjects.reduce(function(b,c){return c.class_id==a.filters.class_id&&b.push(c),b},[]);var e=a.allClassSubjects.filter(function(b){return b.class_id==a.filters.class_id&&b.subject_id==a.filters.subject_id?b:void 0})[0];a.filters.class_subject_id=e.class_subject_id}l(angular.copy(a.filters))}else a.noHomework=!0;else a.error=!0,a.errMsg=d.data},o)},k=function(a,b){var c;for(c=0;c<b.length;c++)if(b[c].class_id==a.class_id)return!0;return!1},l=function(d){var e=(d.post_status_id||"All")+"/"+(d.class_subject_id||"All")+"/"+(d.class_id||"All");e+="TEACHER"==b.currentUser.user_type?"/"+b.currentUser.emp_id:"/0",c.getHomeworkPosts(e,function(b,c){var d=angular.fromJson(b);"success"==d.response?(a.homework=d.nodata?[]:d.data,a.homework=a.homework.map(function(a){return a.assigned_date2=new Date(a.assigned_date),a.due_date2=moment(a.due_date).format("MMM Do YYYY, h:mm a"),a}),m(a.homework)):(a.error=!0,a.errMsg=d.data),a.loading=!1},o)};a.loadFilter=function(){a.loading=!0,l(angular.copy(a.filters))};var m=function(c){a.gridOptions.data=c,a.loading=!1,b.loading=!1};a.filterDataTable=function(){a.gridApi.grid.refresh()},a.clearFilterDataTable=function(){a.gridFilter.filterValue="",a.gridApi.grid.refresh()},a.singleFilter=function(b){var c=new RegExp(a.gridFilter.filterValue,"i");return b.forEach(function(a){var b=!1;["class_name","subject_name","title","post_status"].forEach(function(d){a.entity[d].match(c)&&(b=!0)}),b||(a.visible=!1)}),b};var n=function(){if(!b.isSmallScreen){var a=$(".dataFilterForm form").width();$("#resultsTable_filter").css("left",a+55)}},o=function(b,c){var d=angular.fromJson(b);a.error=!0,a.errMsg=d.data};a.preview=function(b){var c={type:"homework",post:b};a.openModal("communications","previewPost","md",c)},a.addPost=function(){g.go("communications/add_post",{class_subject_id:a.filters.class_subject_id,post_type:"post"})},a.addHomework=function(){g.go("communications/add_post",{class_subject_id:a.filters.class_subject_id,post_type:"homework"})},a.addEmail=function(){g.go("communications/add_post",{post_type:"communication"})},a.viewPost=function(a){g.go("communications/edit_post",{post:a,post_id:a.homework_id,post_type:"homework"})},a.$on("refreshPosts",function(c,e){a.loading=!0,b.loading=!0,void 0!==e&&(a.updated=!0,a.notificationMsg=e.msg),a.refresh(),d(function(){a.alert.expired=!0},2e3),d(function(){a.updated=!1,a.notificationMsg="",a.alert.expired=!1},3e3)}),a.refresh=function(){a.loading=!0,b.loading=!0,l(angular.copy(a.filters))},a.$on("$destroy",function(){b.isModal=!1})}]),angular.module("eduwebApp").controller("listPostsCtrl",["$scope","$rootScope","apiService","$timeout","$window","$filter","$state",function(a,b,c,d,e,f,g){a.filters={},a.filters.post_status_id="All",a.filters.class_id=""!==g.params.class_id?g.params.class_id:null,a.filterClass=""!==g.params.class_id,a.alert={},a.loading=!0,a.gridFilter={},a.gridFilter.filterValue="";var h=function(){return'<div class="clickable">  <div ng-if="row.entity.merge">{{row.entity.title}}</div>  <div ng-if="!row.entity.merge" ng-repeat="(colRenderIndex, col) in colContainer.renderedColumns track by col.colDef.name" class="ui-grid-cell" ng-class="{ \'ui-grid-row-header-cell\': col.isRowHeader }"  ui-grid-cell></div></div>'};a.gridOptions={enableSorting:!0,rowTemplate:h(),rowHeight:24,columnDefs:[{name:"Title",field:"title",enableColumnMenu:!1,sort:{direction:"asc"},cellTemplate:'<div class="ui-grid-cell-contents" ng-click="grid.appScope.viewPost(row.entity)">{{row.entity.title}}</div>'},{name:"Class",field:"class_name",enableColumnMenu:!1,cellTemplate:'<div class="ui-grid-cell-contents" ng-click="grid.appScope.viewPost(row.entity)">{{row.entity.class_name}}</div>'},{name:"Date",field:"creation_date",type:"date",enableColumnMenu:!1,cellTemplate:'<div class="ui-grid-cell-contents" ng-click="grid.appScope.viewPost(row.entity)">{{row.entity.creation_date|date:"MMM d yyyy, h:mm a}}</div>'},{name:"Status",field:"post_status",width:75,enableColumnMenu:!1,cellTemplate:'<div class="ui-grid-cell-contents" ng-click="grid.appScope.viewPost(row.entity)">{{row.entity.post_status}}</div>'},{name:"View",field:"",cellClass:"center",width:40,headerCellClass:"center",enableColumnMenu:!1,cellTemplate:'<div class="ui-grid-cell-contents" ng-click="grid.appScope.preview(row.entity)"><i class="fa fa-eye"></i></div>'}],onRegisterApi:function(b){a.gridApi=b,a.gridApi.grid.registerRowsProcessor(a.singleFilter,200),d(function(){a.gridApi.core.handleWindowResize()})}};var i=function(){setTimeout(function(){var b=$(".full-height.datagrid").height();$("#grid1").css("height",b),a.gridApi.core.handleWindowResize()},100),void 0===b.postStatuses?c.getBlogPostStatuses({},function(c){var d=angular.fromJson(c);"success"==d.response&&(a.postStatuses=d.data,b.postStatuses=a.postStatuses)},m):a.postStatuses=b.postStatuses,void 0===b.classes?j():(a.classes=b.classes,null===a.filters.class_id&&(a.filters.class_id=a.classes[0].class_id),k(angular.copy(a.filters)))};d(i,1);var j=function(){var d=b.currentUser.emp_id+"/true";c.getTeacherClasses(d,function(c,d){var e=angular.fromJson(c);"success"==e.response?(b.classes=a.classes=e.nodata?[]:e.data,a.classes.length>0?(null===a.filters.class_id&&(a.filters.class_id=a.classes[0].class_id),k(angular.copy(a.filters))):a.noClasses=!0):(a.error=!0,a.errMsg=e.data)},m)},k=function(b){var d=b.class_id+"/"+(b.post_status_id||"All");c.getClassPosts(d,function(b,c){var d=angular.fromJson(b);"success"==d.response?(a.posts=d.nodata?[]:d.data,a.posts=a.posts.map(function(a){return a.creation_date=new Date(a.creation_date),a}),l(a.posts)):(a.error=!0,a.errMsg=d.data),a.loading=!1},m)};a.loadFilter=function(){a.loading=!0,k(angular.copy(a.filters))};var l=function(c){a.gridOptions.data=c,a.loading=!1,b.loading=!1};a.filterDataTable=function(){a.gridApi.grid.refresh()},a.clearFilterDataTable=function(){a.gridFilter.filterValue="",a.gridApi.grid.refresh()},a.singleFilter=function(b){var c=new RegExp(a.gridFilter.filterValue,"i");return b.forEach(function(a){var b=!1;["class_name","title","post_status"].forEach(function(d){a.entity[d].match(c)&&(b=!0)}),b||(a.visible=!1)}),b};var m=function(b,c){var d=angular.fromJson(b);a.error=!0,a.errMsg=d.data};a.preview=function(b){var c={type:"post",post:b};a.openModal("communications","previewPost","md",c)},a.addPost=function(){g.go("communications/add_post",{class_id:a.filters.class_id,post_type:"post"})},a.addHomework=function(){g.go("communications/add_post",{class_id:a.filters.class_id,post_type:"homework"})},a.addEmail=function(){g.go("communications/add_post",{post_type:"communication"})},a.viewPost=function(a){g.go("communications/edit_post",{post:a,post_id:a.post_id,post_type:"post"})},a.$on("refreshPosts",function(c,e){a.loading=!0,b.loading=!0,void 0!==e&&(a.updated=!0,a.notificationMsg=e.msg),a.refresh(),d(function(){a.alert.expired=!0},2e3),d(function(){a.updated=!1,a.notificationMsg="",a.alert.expired=!1},3e3)}),a.refresh=function(){a.loading=!0,b.loading=!0,k(angular.copy(a.filters))},a.$on("$destroy",function(){b.isModal=!1})}]),angular.module("eduwebApp").controller("postFormCtrl",["$scope","$rootScope","apiService","dialogs","FileUploader","$timeout","$state",function(a,b,c,d,e,f,g){a.loadingPost=!0,a.editingBlogName=!1,a.filters={},a.alert={},a.theparent={},a.theemployee={},a.edit=void 0!==g.params.action&&"edit"==g.params.action,a.post=void 0!==g.params.post?g.params.post:{},a.post_type=void 0!==g.params.post_type?g.params.post_type:"post",a.isPost="post"==a.post_type,a.isHomework="homework"==a.post_type,a.isEmail="communication"==a.post_type,a.pageTitle=a.isHomework?"Homework Post":a.isEmail?"Communication":"Blog Post",a.filters.send_method="email",a.isTeacher="TEACHER"==b.currentUser.user_type,a.noEmpId=null===b.currentUser.emp_id,a.isAdmin="SYS_ADMIN"==b.currentUser.user_type,a.isHomework&&(a.dates={},a.dates.assigned_date={startDate:moment().format("YYYY-MM-DD")},a.dates.due_date={startDate:null});var h=function(){null===g.params.post&&void 0!==g.params.post_id?a.isHomework?c.getHomeworkPost(g.params.post_id,function(b,c){var d=angular.fromJson(b);"success"==d.response?(d.nodata?(a.post={},a.notFound=!0,a.loadingPost=!1):(a.post=d.data,a.dates.assigned_date={startDate:moment(a.post.assigned_date).format("YYYY-MM-DD")},a.dates.due_date={startDate:moment(a.post.due_date).format("YYYY-MM-DD")},a.optionsSelected=!0,a.selectedClassSubject={subject_name:a.post.subject_name,class_id:a.post.class_id,class_name:a.post.class_name,subject_id:a.post.subject_id,class_subject_id:a.post.class_subject_id},a.setupBlog=!1,a.loadingPost=!1),j()):(a.error=!0,a.errMsg=d.data)},s):a.isEmail?c.getCommunication(g.params.post_id,function(b,d){var e=angular.fromJson(b);"success"==e.response?(e.nodata?(a.post={},a.notFound=!0,a.loadingPost=!1):(a.post=e.data,a.post.title=e.data.subject,a.post.body=e.data.message,a.optionsSelected=!0,a.selectedType=a.post.com_type,a.selectedAudience=a.post.audience,a.selectedParent=a.post.full_parent_name,a.post.send_method=a.post.send_as_sms?"sms":"email",a.selectedMethod=a.post.send_method.toUpperCase(),a.setupBlog=!1,a.loadingPost=!1,"sms"==a.post.send_method&&(a.post.title=a.post.message),(a.noEmpId||a.isAdmin)&&c.getAllEmployees(!0,o,s)),k()):(a.error=!0,a.errMsg=e.data)},s):c.getPost(g.params.post_id,function(b,c){var d=angular.fromJson(b);"success"==d.response?(d.nodata?(a.post={},a.notFound=!0,a.loadingPost=!1):(a.post=d.data,a.optionsSelected=!0,a.setupBlog=!1,a.loadingPost=!1),i()):(a.error=!0,a.errMsg=d.data)},s):void 0!==a.post.post_id?(a.isEmail?(a.post.title=a.post.subject,a.post.body=a.post.message,a.selectedType=a.post.com_type,a.selectedAudience=a.post.audience,a.selectedParent=a.post.full_parent_name,a.post.send_method=a.post.send_as_sms?"sms":"email",a.selectedMethod=a.post.send_method.toUpperCase(),"sms"==a.post.send_method&&(a.post.title=a.post.message),k(),a.noEmpId&&c.getAllEmployees(!0,o,s)):a.isHomework?(a.dates.assigned_date={startDate:moment(a.post.assigned_date).format("YYYY-MM-DD")},a.dates.due_date={startDate:moment(a.post.due_date).format("YYYY-MM-DD")},j()):i(),a.optionsSelected=!0,a.setupBlog=!1,a.loadingPost=!1):(a.optionsSelected=!1,a.isEmail?k():a.isHomework?j():i())};f(h,100);var i=function(){if(a.loadingPost=!1,void 0!==b.classes)a.classes=b.classes,l(),a.loadingPost=!1;else{var d=b.currentUser.emp_id+"/true";c.getTeacherClasses(d,function(c,d){var e=angular.fromJson(c);"success"==e.response?(b.classes=a.classes=e.nodata?[]:e.data,a.classes.length>0?l():a.noClasses=!0):(a.error=!0,a.errMsg=e.data),a.loadingPost=!1},s)}},j=function(){a.loadingPost=!1,void 0!==b.classSubjects?(a.classSubjects=b.classSubjects,m(),a.loadingPost=!1):c.getTeacherClassSubjects(b.currentUser.emp_id,function(c,d){var e=angular.fromJson(c);"success"==e.response?(b.classSubjects=a.classSubjects=e.nodata?[]:e.data,a.classSubjects.length>0?m():a.noClassSubjects=!0):(a.error=!0,a.errMsg=e.data),a.loadingPost=!1},s)},k=function(){a.loadingPost=!1,void 0===b.comTypes?c.getCommunicationOptions({},function(c){var d=angular.fromJson(c);"success"==d.response&&(b.comTypes=a.comTypes=d.data.com_types,b.comAudience=a.comAudience=d.data.audiences)},s):(a.comTypes=b.comTypes,a.comAudience=b.comAudience)},l=function(){null!==a.post.post_id&&void 0!==a.post.post_id?(a.filters["class"]=a.classes.filter(function(b){return b.class_id==a.post.class_id?b:void 0})[0],a.setClass()):a.filters["class"]=a.classes[0]},m=function(){null!==a.post.post_id&&void 0!==a.post.post_id?(a.filters.subject=a.classSubjects.filter(function(b){return b.class_subject_id==a.post.class_subject_id?b:void 0})[0],a.setClassSubject()):a.filters.subject=a.classSubjects[0]};a.cancel=function(){a.isHomework&&g.go("communications/homework",{class_subject_id:a.selectedClassSubject.class_subject_id}),a.isEmail?g.go("communications/send_email"):g.go("communications/blog_posts",{class_id:a.selectedClass.class_id})},a.$watch("filters.com_type",function(d,e){if(d!=e&&(a.theparent.selected=void 0,void 0===a.post.post_id&&(a.filters.audience=void 0),a.isParent=!1,a.isClassSpecific=!1,a.filters.audience_id=null,a.isStudentFeedback="Student Feedback"==d.com_type,a.isStudentFeedback&&(a.filters.audience=a.comAudience.filter(function(a){return"Parent"==a.audience?a:void 0})[0]),a.isStudentFeedback&&void 0==a.parents))if("TEACHER"==b.currentUser.user_type){var f=b.currentUser.emp_id;c.getTeacherParents(f,n,s)}else c.getAllParents({},n,s)}),a.$watch("filters.audience",function(d,e){if(d!=e&&!a.isStudentFeedback){if(a.theparent.selected=void 0,a.isParent="Parent"==d.audience,a.isClassSpecific="Class Specific"==d.audience,a.isParent&&void 0===a.parents)if("TEACHER"==b.currentUser.user_type){var f=b.currentUser.emp_id;c.getTeacherParents(f,n,s)}else c.getAllParents({},n,s);if(a.isClassSpecific&&void 0===a.classes)if("TEACHER"==b.currentUser.user_type){var f=b.currentUser.emp_id;c.getTeacherClasses(f,p,s)}else c.getAllClasses({},p,s)}});var n=function(b){var c=angular.fromJson(b);"success"==c.response?a.parents=c.nodata?{}:c.data:(a.error=!0,a.errMsg=c.data)},o=function(b){var c=angular.fromJson(b);"success"==c.response?(a.employees=c.nodata?{}:c.data,null!==a.post.post_id&&void 0!==a.post.post_id&&(a.theemployee.selected=a.employees.filter(function(b){return b.emp_id==a.post.message_from?b:void 0})[0])):(a.error=!0,a.errMsg=c.data)},p=function(b){var c=angular.fromJson(b);"success"==c.response?a.classes=c.nodata?{}:c.data:(a.error=!0,a.errMsg=c.data)};a.setClass=function(){a.isHomework?a.setClassSubject():(a.optionsSelected=!0,a.selectedClass=angular.copy(a.filters["class"]),a.setupBlog=null===a.selectedClass.blog_id,a.setupBlog&&(a.blog={}))},a.setClassSubject=function(){a.optionsSelected=!0,a.classSubjectSelected=!0,a.selectedClassSubject=angular.copy(a.filters.subject)},a.setEmailType=function(b){b.$setSubmitted(),b.$invalid||(a.optionsSelected=!0,a.selectedClass=void 0,a.setupBlog=!1,a.selectedAudience=angular.copy(a.filters.audience.audience),a.selectedType=angular.copy(a.filters.com_type.com_type),a.selectedParent=void 0!==a.theparent.selected?angular.copy(a.theparent.selected.parent_full_name):void 0,a.selectedClassName=void 0!==a.filters["class"]?angular.copy(a.filters["class"].class_name):void 0,a.selectedMethod=angular.copy(a.filters.send_method).toUpperCase(),a.post.student_id=void 0!==a.theparent.selected?angular.copy(a.theparent.selected.student_id):void 0,a.post.guardian_id=void 0!==a.theparent.selected?angular.copy(a.theparent.selected.guardian_id):void 0,a.post.class_id=void 0!==a.filters["class"]?angular.copy(a.filters["class"].class_id):void 0,a.post.audience_id=angular.copy(a.filters.audience.audience_id),a.post.com_type_id=angular.copy(a.filters.com_type.com_type_id),a.post.send_method=angular.copy(a.filters.send_method),a.noEmpId&&c.getAllEmployees(!0,o,s))},a.updateBlogName=function(){a.editingBlogName=!0,void 0===a.blog&&(a.blog={}),a.blog.blog_name=angular.copy(a.selectedClass.blog_name)},a.addPost=function(){var b=a.selectedClass?a.selectedClass.class_id:null;g.go("communications/add_post",{class_id:b,post_type:"post"})},a.addHomework=function(){var b=a.selectedClassSubject?a.selectedClassSubject.class_subject_id:null;g.go("communications/add_post",{class_subject_id:b,post_type:"homework"})},a.addEmail=function(){g.go("communications/add_post",{post_type:"communication"})},a.saveBlogName=function(){var d={user_id:b.currentUser.user_id,blog_id:a.post.blog_id,blog_name:a.blog.blog_name};c.updateBlog(d,function(b){var c=angular.fromJson(b);"success"==c.response&&(a.editingBlogName=!1,a.selectedClass.blog_name=angular.copy(a.blog.blog_name))},s)},a.preview=function(){a.isEmail&&(a.post.details={com_type:a.selectedMethod,audience:a.selectedAudience,class_name:a.selectedClassName,parent_full_name:a.selectedParent,posted_by:a.isTeacher?b.currentUser.full_name:void 0!==a.theemployee.selected?a.theemployee.selected.employee_name:""});var c={type:a.post_type,post:a.post};a.openModal("communications","previewPost","md",c)},a.saveDraft=function(b){a.postForm.$setSubmitted(),a.post.post_status_id=2,a.save(b)},a.publish=function(b){a.postForm.$setSubmitted(),a.post.post_status_id=1,a.edit?a.updatePost(b):a.save(b)},a.updatePost=function(d){if(a.postForm.$setSubmitted(),a.saving=!0,void 0!==q.queue[0]&&(q.queue[0].file.name=moment()+"_"+q.queue[0].file.name,q.uploadAll(),a.isHomework?a.post.attachment=void 0!==q.queue[0]?q.queue[0].file.name:null:a.post.feature_image=void 0!==q.queue[0]?q.queue[0].file.name:null),a.isHomework){a.post.due_date=void 0!==a.dates.due_date.startDate?moment(a.dates.due_date.startDate).format("YYYY-MM-DD"):null,a.post.assigned_date=void 0!==a.dates.assigned_date.startDate?moment(a.dates.assigned_date.startDate).format("YYYY-MM-DD"):null;var e={user_id:b.currentUser.user_id,post:a.post};c.updateHomework(e,r,s)}else if(a.isEmail){a.post.send_as_email="email"==a.filters.send_method?"t":"f",a.post.send_as_sms="sms"==a.filters.send_method?"t":"f",a.isTeacher?a.post.message_from=b.currentUser.emp_id:a.post.message_from=a.theemployee.selected.emp_id,"sms"==a.post.send_method&&(a.post.body=a.post.title);var e={user_id:b.currentUser.user_id,post:a.post};c.updateCommunication(e,r,s)}else{var e={user_id:b.currentUser.user_id,post:a.post};c.updatePost(e,r,s)}},a.deletePost=function(){var b=d.confirm("Please Confirm","Are you sure you want to delete this post? <b>This can not be undone</b>.",{size:"sm"});b.result.then(function(b){a.isHomework&&c.deleteHomework(a.post.post_id,r,s),a.isEmail?c.deleteCommunication(a.post.post_id,r,s):c.deletePost(a.post.post_id,r,s)})},a.save=function(d){if(a.error=!1,a.errMsg="",!d.$invalid)if(a.saving=!0,a.setupBlog){var e={teacher_id:b.currentUser.emp_id,blog_name:a.blog.blog_name,class_id:a.selectedClass.class_id};c.addBlog(e,function(b,c){var d=angular.fromJson(b);"success"==d.response?(a.setupBlog=!1,a.post.blog_id=d.data,a.selectedClass.blog_id=d.data,a.selectedClass.blog_name=a.blog.blog_name):(a.error=!0,a.errMsg=d.data),a.saving=!1},s)}else if(void 0!==q.queue[0]&&(q.queue[0].file.name=moment()+"_"+q.queue[0].file.name,q.uploadAll(),a.isHomework||a.isEmail?a.post.attachment=void 0!==q.queue[0]?q.queue[0].file.name:null:a.post.feature_image=void 0!==q.queue[0]?q.queue[0].file.name:null),a.isHomework){a.post.due_date=void 0!==a.dates.due_date.startDate?moment(a.dates.due_date.startDate).format("YYYY-MM-DD"):null,a.post.assigned_date=void 0!==a.dates.assigned_date.startDate?moment(a.dates.assigned_date.startDate).format("YYYY-MM-DD"):null,a.isTeacher?a.post.posted_by=b.currentUser.emp_id:a.post.posted_by=a.theemployee.selected.emp_id;var e={user_id:b.currentUser.user_id,class_subject_id:a.selectedClassSubject.class_subject_id,post:a.post};c.addHomework(e,r,s)}else if(a.isEmail){a.post.send_as_email="email"==a.filters.send_method?"t":"f",a.post.send_as_sms="sms"==a.filters.send_method?"t":"f",a.isTeacher?a.post.message_from=b.currentUser.emp_id:a.post.message_from=a.theemployee.selected.emp_id,"sms"==a.post.send_method&&(a.post.body=a.post.title);var e={user_id:b.currentUser.user_id,post:a.post};c.addCommunication(e,r,s)}else{a.post.post_type_id=1,a.isTeacher?a.post.posted_by=b.currentUser.emp_id:a.post.posted_by=a.theemployee.selected.emp_id;var e={user_id:b.currentUser.user_id,blog_id:a.selectedClass.blog_id,post:a.post};c.addPost(e,r,s)}};var q=a.uploader=new e({url:"upload.php",formData:[{dir:"posts"}]}),r=function(b,c,d){var e=angular.fromJson(b);"success"==e.response?(a.updated=!0,f(function(){a.alert.expired=!0},1e3),f(function(){a.updated=!1,a.notificationMsg="",a.alert.expired=!1,a.isHomework&&g.go("communications/homework",{class_subject_id:a.selectedClassSubject.class_subject_id}),a.isEmail?g.go("communications/send_email"):g.go("communications/blog_posts",{class_id:a.selectedClass.class_id})},1500)):(a.error=!0,a.errMsg=e.data)},s=function(b,c){var d=angular.fromJson(b);a.error=!0,a.errMsg=d.data,a.loadingPost=!1,a.saving=!1}}]),angular.module("eduwebApp").controller("postFormCtrl",["$scope","$rootScope","$uibModalInstance","apiService","dialogs","FileUploader","$timeout","data",function(a,b,c,d,e,f,g,h){a.edit=void 0!==h.edit?h.edit:!1,a.classes=h.classes,a.selectedClass=h.selectedClass,a.post=void 0!==h.post?h.post:{};var i=function(){a.bodyContent="test"};g(i,100),a.cancel=function(){c.dismiss("canceled")},a.setClass=function(){a.classSelected=!0,a.setupBlog=null===a.selectedClass.blog_id},a.preview=function(){},a.saveDraft=function(b){a.post.post_status_id=2,a.save(b)},a.publish=function(b){a.post.post_status_id=1,a.save(b)},a.save=function(b){if(!b.$invalid)if(a.setupBlog)d.addBlog(c,function(b,c){var d=angular.fromJson(b);"success"==d.response?(a.setupBlog=!1,
a.post.blog_id=d.data):(a.error=!0,a.errMsg=d.data)},l);else{void 0!==j.queue[0]&&(j.queue[0].file.name=moment()+"_"+j.queue[0].file.name,j.uploadAll(),a.post.feature_image=void 0!==j.queue[0]?j.queue[0].file.name:null),a.post.body=a.bodyContent;var c={user_id:a.currentUser.user_id,blog_id:a.selectedClass.blog_id,post:a.post};a.edit?d.updatePost(c,k,l):d.addPost(c,k,l)}};var j=a.uploader=new f({url:"upload.php",formData:[{dir:"students"}]}),k=function(d,e,f){var g=angular.fromJson(d);if("success"==g.response){c.close();var h=a.edit?"Post was updated.":"Post was added.";b.$emit("postAdded",{msg:h,clear:!0})}else a.error=!0,a.errMsg=g.data},l=function(b,c){var d=angular.fromJson(b);a.error=!0,a.errMsg=d.data}}]),angular.module("eduwebApp").controller("previewPostCtrl",["$scope","$rootScope","$uibModalInstance","data",function(a,b,c,d){a.type=d.type,a.post=angular.copy(d.post),void 0===a.post.details&&(a.post.details=d.post),a.cancel=function(){c.dismiss("canceled")}}]),angular.module("eduwebApp").controller("addExamMarksCtrl",["$scope","$rootScope","$uibModalInstance","apiService","dialogs","data","$timeout","$window",function(a,b,c,d,e,f,g,h){a.classes=f.classes,a.terms=f.terms,a.examTypes=f.examTypes,a.filters=f.filters;a.isTeacher="TEACHER"==b.currentUser.user_type;var i=function(){};setTimeout(i,1),a.$watch("filters.class",function(b,c){b!=c&&(a.filters.class_id=b.class_id,d.getExamTypes(b.class_cat_id,function(b){var c=angular.fromJson(b);"success"==c.response&&(a.examTypes=c.data)},l))}),a.cancel=function(){c.dismiss("canceled")},a.getStudentExams=function(c){if(c.$submitted=!0,!c.$invalid){a.examMarks={},a.marksNotFound=!1,void 0!==a.dataGrid&&(a.dataGrid.destroy(),a.dataGrid=void 0);var e=a.filters.class_id+"/"+a.filters.exam_type_id;e+=a.isTeacher?"/"+b.currentUser.emp_id:"/0",d.getAllClassExams(e,function(c){a.loading=!1;var e=angular.fromJson(c);if("success"==e.response)if(void 0!==e.nodata)a.marksNotFound=!0,a.errMsg="The selected exam is not set up for this class.";else{a.subjects=e.data;var f=a.filters.class_id+"/"+a.filters.term_id+"/"+a.filters.exam_type_id;a.isTeacher&&(f+="/"+b.currentUser.emp_id),d.getClassExamMarks(f,j,l)}},l)}};var j=function(b,c){a.loading=!1;var d=angular.fromJson(b);if("success"==d.response)if(d.nodata)a.marksNotFound=!0,a.errMsg="There are no students in the selected classes.";else{a.students=d.data,a.currentFilters=angular.copy(a.filters),a.examMarks=[];var e="",f={},g=0;angular.forEach(a.students,function(b,c){b.student_id!=e&&(g>0&&(a.examMarks[g-1].marks=f),a.examMarks.push({student_name:b.student_name,student_id:b.student_id,marks:{}}),f={},g++);var d=a.subjects.filter(function(a){return a.subject_name==b.subject_name?a:void 0})[0];f[d.subject_name]={mark:b.mark,class_sub_exam_id:b.class_sub_exam_id,grade_weight:b.grade_weight,is_parent:b.is_parent,parent_subject_id:b.parent_subject_id||void 0,subject_id:b.subject_id},e=b.student_id}),a.examMarks[g-1].marks=f}else a.marksNotFound=!0,a.errMsg=d.data};a.calculateParentSubject=function(a,b){var c=b.parent_subject_id;if(void 0!==c){var d=[],e=null;angular.forEach(a,function(a,b){a.parent_subject_id==c?d.push(a):a.subject_id==c&&(e=a)});var f=d.reduce(function(a,b){return a+=parseFloat(b.mark)||0},0),g=d.reduce(function(a,b){return a+=parseFloat(b.grade_weight)||0},0);e.mark=Math.round(f/g*100)}};a.save=function(c){if(!c.$invalid){var e=[];angular.forEach(a.examMarks,function(b,c){angular.forEach(b.marks,function(c,d){e.push({student_id:b.student_id,class_sub_exam_id:c.class_sub_exam_id,term_id:a.currentFilters.term_id,mark:c.mark,parent_subject_id:c.parent_subject_id||void 0})})});var f={user_id:b.currentUser.user_id,exam_marks:e};d.addExamMarks(f,k,l)}};var k=function(d,e,g){var h=angular.fromJson(d);if("success"==h.response){c.close();var i=a.edit?"Exam mark was updated.":"Exam marks were added.";void 0!==f.viewing&&"report"==f.viewing?b.$emit("examMarksAdded2",{msg:i,clear:!0}):b.$emit("examMarksAdded",{msg:i,clear:!0})}else a.error=!0,a.errMsg=h.data},l=function(b,c){var d=angular.fromJson(b);a.error=!0,a.errMsg=d.data}}]),angular.module("eduwebApp").controller("classAnalysisReportCtrl",["$scope","$rootScope","apiService","$timeout","$window","$q","$parse",function(a,b,c,d,e,f,g){var h=!0;a.filters={},a.filters.status="true",a.students=[],a.filterShowing=!1,a.toolsShowing=!1;b.modalLoading=!1,a.alert={},a.refreshing=!1,a.getReport="examsTable";var i=function(){var d=[],e=f.defer();d.push(e.promise),void 0===b.allClasses?"TEACHER"==b.currentUser.user_type?c.getTeacherClasses(b.currentUser.emp_id,function(b){var c=angular.fromJson(b);"success"==c.response?(a.classes=c.data||[],a.filters["class"]=a.classes[0],a.filters.class_id=a.classes[0]?a.classes[0].class_id:null,e.resolve()):e.reject()},function(){e.reject()}):c.getAllClasses({},function(b){var c=angular.fromJson(b);"success"==c.response?(a.classes=c.data||[],a.filters["class"]=a.classes[0],a.filters.class_id=a.classes[0]?a.classes[0].class_id:null,a.filters.class_cat_id=a.classes[0]?a.classes[0].class_cat_id:null,e.resolve()):e.reject()},function(){e.reject()}):(a.classes=b.allClasses,a.filters["class"]=a.classes[0],a.filters.class_id=a.classes[0].class_id,a.filters.class_cat_id=a.classes[0].class_cat_id,e.resolve());var g=f.defer();if(d.push(g.promise),void 0===b.terms)c.getTerms(void 0,function(c,d){var e=angular.fromJson(c);if("success"==e.response){a.terms=e.data,b.terms=e.data;var f=a.terms.filter(function(a){return a.current_term?a:void 0})[0];a.filters.term_id=f.term_id,g.resolve()}else g.reject()},function(){g.reject()});else{a.terms=b.terms;var h=a.terms.filter(function(a){return a.current_term?a:void 0})[0];a.filters.term_id=h.term_id,g.resolve()}};d(i,1),a.$watch("filters.class",function(b,e){b!=e&&(a.filters.class_id=b.class_id,a.selectedClass=b.class_name,c.getExamTypes(b.class_cat_id,function(b){var c=angular.fromJson(b);"success"!=c.response||c.nodata||(a.examTypes=c.data,a.filters.exam_type_id=a.examTypes[0].exam_type_id,d(m,10))},o))}),a.getStudentExams=function(){a.examMarks={},a.totalMarks={},a.meanScores={},a.tableHeader=[],a.marksNotFound=!1,a.getReport="";var d=a.filters.class_id+"/"+a.filters.term_id+"/"+a.filters.exam_type_id;"TEACHER"==b.currentUser.user_type&&(d+="/"+b.currentUser.emp_id),c.getAllStudentExamMarks(d,j,o)};var j=function(b,c){a.loading=!1;var e=angular.fromJson(b);if("success"==e.response)if(e.nodata)a.marksNotFound=!0,a.errMsg="There are currently no exam marks entered for this search criteria.";else{void 0!==a.dataGrid&&($(".fixedHeader-floating").remove(),a.dataGrid.clear(),a.dataGrid.destroy()),a.examMarks=e.data,a.totalStudents=e.data.length,a.tableHeader=[];var f=["student_id","student_name","rank","exam_type"],g={},h={};angular.forEach(a.examMarks[0],function(a,b){if(-1===f.indexOf(b)){var c=b.replace(/["']/g,""),d=c.split(", "),e=d[1],i=d[2];d[3];""==e?(g[i]=100,void 0===h[i]&&(h[i]={isParent:!0,subjectName:i,children:[]})):(g[e]=100,void 0===h[e]&&(h[e]={isParent:!0,subjectName:e,children:[]}),h[e].children.push({subjectName:i}))}}),angular.forEach(a.examMarks[0],function(b,c){if(-1===f.indexOf(c)){var d=c.replace(/["']/g,""),e=d.split(", "),g=e[1],i=e[2],j=""==g&&h[i].children.length>0;a.tableHeader.push({title:j?"Kiswahili"==i?"Juml":"TOT":k(i),key:c,isParent:""==g})}}),a.totalGradeWeight=0;for(var i in g)g.hasOwnProperty(i)&&(a.totalGradeWeight+=g[i]);a.totalMarks={},a.grandTotal=0,angular.forEach(a.examMarks,function(b){var c=0;angular.forEach(b,function(b,d){if(-1===f.indexOf(d)){var e=d.replace(/["']/g,""),g=e.split(", "),h=g[1];""==h&&(c+=b),void 0===a.totalMarks[d]&&(a.totalMarks[d]=0),a.totalMarks[d]=a.totalMarks[d]+b}}),b.total=Math.round(c),a.grandTotal+=b.total}),a.getReport="examsTable",d(l,100)}else a.marksNotFound=!0,a.errMsg=e.data},k=function(a){var b=a.split(" "),c=b.length,d=0,e=[];for(d=0;c>d;d++){var f=b[d].length>9?b[d].substr(0,9)+"...":b[d];"-"!==f&&e.push(f)}return e.join(" ")};a.displayMark=function(b,c){return a.examMarks[b][c]||"-"},a.displayTotalMark=function(b){return a.totalMarks[b]||"-"},a.displayMeanScore=function(b){return Math.round(a.totalMarks[b]/a.totalStudents,1)||"-"};var l=function(){var c=$("#resultsTable");a.dataGrid=c.DataTable({paging:!1,destroy:!0,filter:!0,info:!1,sorting:[],initComplete:function(c,d){a.loading=!1,b.loading=!1,a.$apply()},language:{search:"Search Results<br>",searchPlaceholder:"Filter",lengthMenu:"Display _MENU_",emptyTable:"No students found."}}),c.DataTable().columns(-1).order("asc").draw();var d=$(".navbar-fixed-top").height(),e=$("#body-content .content-fixed-header").height(),f=b.isSmallScreen?22:13;new $.fn.dataTable.FixedHeader(a.dataGrid,{header:!0,headerOffset:d+e+f}),m(),h&&n()},m=function(){if(!b.isSmallScreen){var a=$(".dataFilterForm form").width();$("#resultsTable_filter").css("left",a+55)}},n=function(){h=!1,e.addEventListener("resize",function(){if(b.isSmallScreen=window.innerWidth<768,b.isSmallScreen)$("#resultsTable_filter").css("left",0);else{var a=$(".dataFilterForm form").width();$("#resultsTable_filter").css("left",a-30)}},!1)};a.toggleFilter=function(){a.filterShowing=!a.filterShowing,a.filterShowing||a.toolsShowing?$("#resultsTable_filter").hide():d(function(){$("#resultsTable_filter").show()},500)},a.toggleTools=function(){a.toolsShowing=!a.toolsShowing,a.filterShowing||a.toolsShowing?$("#resultsTable_filter").hide():d(function(){$("#resultsTable_filter").show()},500)},a.addExamMarks=function(){var b={classes:a.classes,terms:a.terms,examTypes:a.examTypes,filters:a.filters,viewing:"report"};a.openModal("exams","addExamMarks","lg",b)},a.importExamMarks=function(){b.wipNotice()},a.exportData=function(){b.wipNotice()},a.printReport=function(){var b=a.terms.filter(function(b){return b.term_id==a.filters.term_id?b:void 0})[0],c=a.examTypes.filter(function(b){return b.exam_type_id==a.filters.exam_type_id?b:void 0})[0],d={criteria:{class_name:a.selectedClass,term:b.term_name,exam_type:c.exam_type},tableHeader:a.tableHeader,examMarks:a.examMarks,totalMarks:a.totalMarks},e=window.location.host,f=window.open("http://"+e+"/#/exams/analysis/print");f.printCriteria=d},a.$on("refreshExamMarks2",function(c,e){a.loading=!0,b.loading=!0,void 0!==e&&(a.updated=!0,a.notificationMsg=e.msg),a.refresh(),d(function(){a.alert.expired=!0},2e3),d(function(){a.updated=!1,a.notificationMsg="",a.alert.expired=!1},3e3)}),a.refresh=function(){a.loading=!0,a.refreshing=!0,b.loading=!0,a.getStudentExams()};var o=function(b,c){var d=angular.fromJson(b);a.error=!0,a.errMsg=d.data};a.$on("$destroy",function(){a.dataGrid&&($(".fixedHeader-floating").remove(),a.dataGrid.fixedHeader.destroy(),a.dataGrid.clear(),a.dataGrid.destroy()),b.isModal=!1})}]),angular.module("eduwebApp").controller("classAnalysisReportCtrl2",["$scope","$rootScope","apiService","$timeout","$window","$q","$parse","uiGridConstants",function(a,b,c,d,e,f,g,h){a.filters={},a.filters.status="true",a.students=[],a.filterShowing=!1,a.toolsShowing=!1;b.modalLoading=!1,a.alert={},a.refreshing=!1,a.getReport="examsTable";a.gridOptions={enableSorting:!0,rowHeight:24,columnFooterHeight:40,showColumnFooter:!0,exporterCsvFilename:"class-analysis.csv",onRegisterApi:function(b){a.gridApi=b,d(function(){a.gridApi.core.handleWindowResize()})}};var i=function(){var d=[],e=f.defer();d.push(e.promise),void 0===b.allClasses?"TEACHER"==b.currentUser.user_type?c.getTeacherClasses(b.currentUser.emp_id,function(b){var c=angular.fromJson(b);"success"==c.response?(a.classes=c.data||[],a.filters["class"]=a.classes[0],a.filters.class_id=a.classes[0]?a.classes[0].class_id:null,e.resolve()):e.reject()},function(){e.reject()}):c.getAllClasses({},function(b){var c=angular.fromJson(b);"success"==c.response?(a.classes=c.data||[],a.filters["class"]=a.classes[0],a.filters.class_id=a.classes[0]?a.classes[0].class_id:null,a.filters.class_cat_id=a.classes[0]?a.classes[0].class_cat_id:null,e.resolve()):e.reject()},function(){e.reject()}):(a.classes=b.allClasses,a.filters["class"]=a.classes[0],a.filters.class_id=a.classes[0].class_id,a.filters.class_cat_id=a.classes[0].class_cat_id,e.resolve());var g=f.defer();if(d.push(g.promise),void 0===b.terms)c.getTerms(void 0,function(c,d){var e=angular.fromJson(c);if("success"==e.response){a.terms=e.data,b.terms=e.data;var f=a.terms.filter(function(a){return a.current_term?a:void 0})[0];a.filters.term_id=f.term_id,g.resolve()}else g.reject()},function(){g.reject()});else{a.terms=b.terms;var h=a.terms.filter(function(a){return a.current_term?a:void 0})[0];a.filters.term_id=h.term_id,g.resolve()}};d(i,1),a.$watch("filters.class",function(b,e){b!=e&&(a.filters.class_id=b.class_id,c.getExamTypes(b.class_cat_id,function(b){var c=angular.fromJson(b);"success"!=c.response||c.nodata||(a.examTypes=c.data,a.filters.exam_type_id=a.examTypes[0].exam_type_id,d(l,10))},m))}),a.getStudentExams=function(){a.examMarks={},a.totalMarks={},a.meanScores={},a.tableHeader=[],a.marksNotFound=!1,a.getReport="";var d=a.filters.class_id+"/"+a.filters.term_id+"/"+a.filters.exam_type_id;"TEACHER"==b.currentUser.user_type&&(d+="/"+b.currentUser.emp_id),c.getAllStudentExamMarks(d,j,m)};var j=function(b,c){a.loading=!1;var d=angular.fromJson(b);if("success"==d.response)if(d.nodata)a.marksNotFound=!0,a.errMsg="There are currently no exam marks entered for this search criteria.";else{a.gridOptions.columnDefs=[{name:"Student",field:"student_name",enableColumnMenu:!1,pinnedLeft:!0,footerCellFilter:'<div class="ui-grid-cell-contents right">TOTAL MARKS<br>MEAN SCORE</div>'}],a.examMarks=d.data,a.totalStudents=d.data.length,a.tableHeader=[];var e=["student_id","student_name","rank","exam_type"],f={},g={};angular.forEach(a.examMarks[0],function(a,b){if(-1===e.indexOf(b)){var c=b.replace(/["']/g,""),d=c.split(", "),h=d[1],i=d[2];d[3];""==h?(f[i]=100,void 0===g[i]&&(g[i]={isParent:!0,subjectName:i,children:[]})):(f[h]=100,void 0===g[h]&&(g[h]={isParent:!0,subjectName:h,children:[]}),g[h].children.push({subjectName:i}))}}),angular.forEach(a.examMarks[0],function(b,c){if(-1===e.indexOf(c)){var d=c.replace(/["']/g,""),f=d.split(", "),h=f[1],i=f[2],j=""==h&&g[i].children.length>0,l=""==h?"strong":"text-muted";a.gridOptions.columnDefs.push({name:j?"Kiswahili"==i?"Juml":"TOT":i,field:c,enableColumnMenu:!1,cellClass:l,aggregationType:k,footerCellFilter:'<div class="ui-grid-cell-contents">{{col.getAggregationValue()[1]}}<br>{{col.getAggregationValue()[0] | number : 1}}</div>'})}});angular.forEach(a.examMarks,function(a){var b=0;angular.forEach(a,function(a,c){if(-1===e.indexOf(c)){var d=c.replace(/["']/g,""),f=d.split(", "),g=f[1];""==g&&(b+=a)}}),a.total=Math.round(b)}),a.gridOptions.columnDefs.push({name:"G.TOT",field:"total",enableColumnMenu:!1,cellClass:"strong",pinnedRight:!0},{name:"Pos",field:"rank",enableColumnMenu:!1,cellClass:"strong",sort:{direction:"asc"},pinnedRight:!0}),a.getReport="examsTable",a.gridOptions.data=a.examMarks}else a.marksNotFound=!0,a.errMsg=d.data};Array.prototype.avg=function(a){if(0==this.length)return 0;for(var b=0,c=0;c<this.length;c++)b+=this[c].entity[a]/this.length;return b},Array.prototype.total=function(a){if(0==this.length)return 0;for(var b=0,c=0;c<this.length;c++)b+=this[c].entity[a];return b};var k=function(a,b){var c=a.avg(b.field),d=a.total(b.field,c);return[c,d]};a.displayMark=function(b,c){return a.examMarks[b][c]||"-"},a.displayTotalMark=function(b){return a.totalMarks[b]||"-"},a.displayMeanScore=function(b){return Math.round(a.totalMarks[b]/a.totalStudents,1)||"-"};var l=function(){if(!b.isSmallScreen){var a=$(".dataFilterForm form").width();$("#resultsTable_filter").css("left",a+55)}};a.toggleFilter=function(){a.filterShowing=!a.filterShowing,a.filterShowing||a.toolsShowing?$("#resultsTable_filter").hide():d(function(){$("#resultsTable_filter").show()},500)},a.toggleTools=function(){a.toolsShowing=!a.toolsShowing,a.filterShowing||a.toolsShowing?$("#resultsTable_filter").hide():d(function(){$("#resultsTable_filter").show()},500)},a.addExamMarks=function(){var b={classes:a.classes,terms:a.terms,examTypes:a.examTypes,filters:a.filters,viewing:"report"};a.openModal("exams","addExamMarks","lg",b)},a.importExamMarks=function(){b.wipNotice()},a.exportData=function(){b.wipNotice()},a.$on("refreshExamMarks3",function(c,e){a.loading=!0,b.loading=!0,void 0!==e&&(a.updated=!0,a.notificationMsg=e.msg),a.refresh(),d(function(){a.alert.expired=!0},2e3),d(function(){a.updated=!1,a.notificationMsg="",a.alert.expired=!1},3e3)}),a.refresh=function(){a.loading=!0,a.refreshing=!0,b.loading=!0,a.getStudentExams()};var m=function(b,c){var d=angular.fromJson(b);a.error=!0,a.errMsg=d.data};a.$on("$destroy",function(){a.dataGrid&&($(".fixedHeader-floating").remove(),a.dataGrid.fixedHeader.destroy(),a.dataGrid.clear(),a.dataGrid.destroy()),b.isModal=!1})}]),angular.module("eduwebApp").controller("examTypesCtrl",["$scope","$rootScope","apiService","$timeout","$window","$filter","dialogs",function(a,b,c,d,e,f,g){a.alert={},a.filters={},a.loading=!0;var h=function(){if(void 0===b.classCats){var d="TEACHER"==b.currentUser.user_type?b.currentUser.emp_id:void 0;c.getClassCats(d,function(c){var d=angular.fromJson(c);"success"==d.response&&(b.classCats=a.classCats=d.data)},function(){})}else a.classCats=b.classCats};d(h,1),a.$watch("classCats",function(c,d){a.filters.class_cat_id=b.classCats[0].class_cat_id,i(b.classCats[0].class_cat_id)});var i=function(b){void 0!==a.dataGrid&&(a.dataGrid.destroy(),a.dataGrid=void 0),c.getExamTypes(b,function(b,c,e){var f=angular.fromJson(b);"success"==f.response?(a.examTypes=f.nodata?[]:f.data,d(j,10)):(a.error=!0,a.errMsg=f.data)},l)};a.loadFilter=function(){a.loading=!0,i(a.filters.class_cat_id)};var j=function(){var c=$("#resultsTable");a.dataGrid=c.DataTable({rowReorder:!0,columnDefs:[{orderable:!0,className:"reorder",targets:0},{orderable:!1,targets:"_all"}],paging:!1,destroy:!0,filter:!0,info:!1,initComplete:function(c,d){a.loading=!1,b.loading=!1,a.$apply()},language:{search:"Search Results<br>",searchPlaceholder:"Filter",lengthMenu:"Display _MENU_",emptyTable:"No exam type entries found."}});var d=$(".navbar-fixed-top").height(),f=$("#body-content .content-fixed-header").height(),g=b.isSmallScreen?22:13;if(new $.fn.dataTable.FixedHeader(a.dataGrid,{header:!0,headerOffset:d+f+g}),a.dataGrid.on("row-reordered",function(a,b,c){k()}),!b.isSmallScreen){var h=$(".dataFilterForm form").width();$("#resultsTable_filter").css("left",h+55)}e.addEventListener("resize",function(){if(b.isSmallScreen=window.innerWidth<768,b.isSmallScreen)$("#resultsTable_filter").css("left",0);else{var a=$(".dataFilterForm form").width();$("#resultsTable_filter").css("left",a-30)}},!1)},k=function(){var d={user_id:b.currentUser.user_id,data:[]};a.dataGrid.rows().every(function(a,b,c){var e={exam_type_id:this.id(),sort_order:this.data()[0]};d.data.push(e)}),d.data.length>0&&c.setExamTypeSortOrder(d,function(){},l)},l=function(b,c){var d=angular.fromJson(b);a.error=!0,a.errMsg=d.data};a.addExamType=function(){var b=g.create("addExamType.html","addExamTypeCtrl",{},{size:"sm",backdrop:"static"});b.result.then(function(b){a.filters.class_cat_id=b.class_cat_id,i(a.filters.class_cat_id)},function(){})},a.deleteExamType=function(b){var d=g.confirm("Delete Exam Type","You are deleting exam type <strong>"+b.exam_type+"</strong>, this <strong>can not be undone</strong>, do you wish to continue?",{size:"sm"});d.result.then(function(d){c.deleteExamType(b.exam_type_id,function(b,c){var d=angular.fromJson(b);"success"==d.response?i(a.filters.class_cat_id):(a.error=!0,a.errMsg=d.data)},l)})},a.$on("refreshExamTypes",function(c,e){a.loading=!0,b.loading=!0,void 0!==e&&(a.updated=!0,a.notificationMsg=e.msg),a.refresh(),d(function(){a.alert.expired=!0},2e3),d(function(){a.updated=!1,a.notificationMsg="",a.alert.expired=!1},3e3)}),a.refresh=function(){a.loading=!0,b.loading=!0,i(a.filters.class_cat_id)},a.$on("$destroy",function(){a.dataGrid&&(a.dataGrid.off("row-reordered"),$(".fixedHeader-floating").remove(),a.dataGrid.fixedHeader.destroy(),a.dataGrid.clear(),a.dataGrid.destroy()),b.isModal=!1})}]),angular.module("eduwebApp").controller("listExamsCtrl",["$scope","$rootScope","apiService","$timeout","$window","$q","$parse",function(a,b,c,d,e,f,g){var h=!0;a.filters={},a.filters.status="true",a.students=[],a.filterShowing=!1,a.toolsShowing=!1;b.modalLoading=!1,a.alert={},a.refreshing=!1,a.getReport="examsTable";var i=function(){var d=[],e=f.defer();d.push(e.promise),void 0===b.allClasses?"TEACHER"==b.currentUser.user_type?c.getTeacherClasses(b.currentUser.emp_id,function(b){var c=angular.fromJson(b);"success"==c.response?(a.classes=c.data||[],a.filters["class"]=a.classes[0],a.filters.class_id=a.classes[0]?a.classes[0].class_id:null,e.resolve()):e.reject()},function(){e.reject()}):c.getAllClasses({},function(b){var c=angular.fromJson(b);"success"==c.response?(a.classes=c.data||[],a.filters["class"]=a.classes[0],a.filters.class_id=a.classes[0]?a.classes[0].class_id:null,a.filters.class_cat_id=a.classes[0]?a.classes[0].class_cat_id:null,e.resolve()):e.reject()},function(){e.reject()}):(a.classes=b.allClasses,a.filters["class"]=a.classes[0],a.filters.class_id=a.classes[0].class_id,a.filters.class_cat_id=a.classes[0].class_cat_id,e.resolve());var g=f.defer();if(d.push(g.promise),void 0===b.terms)c.getTerms(void 0,function(c,d){var e=angular.fromJson(c);if("success"==e.response){a.terms=e.data,b.terms=e.data;var f=a.terms.filter(function(a){return a.current_term?a:void 0})[0];a.filters.term_id=f.term_id,g.resolve()}else g.reject()},function(){g.reject()});else{a.terms=b.terms;var h=a.terms.filter(function(a){return a.current_term?a:void 0})[0];a.filters.term_id=h.term_id,g.resolve()}};d(i,1),a.$watch("filters.class",function(b,e){b!=e&&(a.filters.class_id=b.class_id,c.getExamTypes(b.class_cat_id,function(b){var c=angular.fromJson(b);"success"!=c.response||c.nodata||(a.examTypes=c.data,a.filters.exam_type_id=a.examTypes[0].exam_type_id,d(l,10))},n))}),a.getStudentExams=function(){a.examMarks={},a.tableHeader=[],a.marksNotFound=!1,a.getReport="";var d=a.filters.class_id+"/"+a.filters.term_id+"/"+a.filters.exam_type_id;"TEACHER"==b.currentUser.user_type&&(d+="/"+b.currentUser.emp_id),c.getAllStudentExamMarks(d,j,n)};var j=function(b,c){a.loading=!1;var e=angular.fromJson(b);if("success"==e.response)if(e.nodata)a.marksNotFound=!0,a.errMsg="There are currently no exam marks entered for this search criteria.";else{void 0!==a.dataGrid&&($(".fixedHeader-floating").remove(),a.dataGrid.clear(),a.dataGrid.destroy()),a.examMarks=e.data,a.tableHeader=[];var f=["student_id","student_name","rank","exam_type"],g={};angular.forEach(a.examMarks[0],function(b,c){if(-1===f.indexOf(c)){var d=c.replace(/["']/g,""),e=d.split(", "),h=e[1],i=e[2],j=e[3];""==h?g[i]=100:g[h]=100,a.tableHeader.push({title:i,weight:j,key:c,isParent:""==h})}}),a.totalGradeWeight=0;for(var h in g)if(g.hasOwnProperty(h)){g[h];a.totalGradeWeight+=g[h]}angular.forEach(a.examMarks,function(a){var b=0;angular.forEach(a,function(a,c){if(-1===f.indexOf(c)){var d=c.replace(/["']/g,""),e=d.split(", "),g=e[1];e[2],e[3];""==g&&(b+=a)}}),a.total=Math.round(b)}),a.getReport="examsTable",d(k,100)}else a.marksNotFound=!0,a.errMsg=e.data};a.displayMark=function(b,c){return g("examMarks["+b+']["'+c+'"]')(a)||"-"};var k=function(){var c=$("#resultsTable");a.dataGrid=c.DataTable({responsive:{details:{type:"column"}},columnDefs:[{className:"control",orderable:!1,targets:0}],paging:!1,destroy:!0,order:[2,"asc"],filter:!0,info:!1,sorting:[],initComplete:function(c,d){a.loading=!1,b.loading=!1,a.$apply()},language:{search:"Search Results<br>",searchPlaceholder:"Filter",lengthMenu:"Display _MENU_",emptyTable:"No students found."}});var d=$(".navbar-fixed-top").height(),e=$("#body-content .content-fixed-header").height(),f=b.isSmallScreen?22:13;new $.fn.dataTable.FixedHeader(a.dataGrid,{header:!0,headerOffset:d+e+f}),l(),h&&m()},l=function(){if(!b.isSmallScreen){var a=$(".dataFilterForm form").width();$("#resultsTable_filter").css("left",a+55)}},m=function(){h=!1,e.addEventListener("resize",function(){if(b.isSmallScreen=window.innerWidth<768,b.isSmallScreen)$("#resultsTable_filter").css("left",0);else{var a=$(".dataFilterForm form").width();$("#resultsTable_filter").css("left",a-30)}},!1)};a.toggleFilter=function(){a.filterShowing=!a.filterShowing,a.filterShowing||a.toolsShowing?$("#resultsTable_filter").hide():d(function(){$("#resultsTable_filter").show()},500)},a.toggleTools=function(){a.toolsShowing=!a.toolsShowing,a.filterShowing||a.toolsShowing?$("#resultsTable_filter").hide():d(function(){$("#resultsTable_filter").show()},500)},a.addExamMarks=function(){var b={classes:a.classes,terms:a.terms,examTypes:a.examTypes,filters:a.filters};a.openModal("exams","addExamMarks","lg",b)},a.importExamMarks=function(){b.wipNotice()},a.exportData=function(){b.wipNotice()},a.$on("refreshExamMarks",function(c,e){a.loading=!0,b.loading=!0,void 0!==e&&(a.updated=!0,a.notificationMsg=e.msg),a.refresh(),d(function(){a.alert.expired=!0},2e3),d(function(){a.updated=!1,a.notificationMsg="",a.alert.expired=!1},3e3)}),a.refresh=function(){a.loading=!0,a.refreshing=!0,b.loading=!0,a.getStudentExams()};var n=function(b,c){var d=angular.fromJson(b);a.error=!0,a.errMsg=d.data};a.$on("$destroy",function(){a.dataGrid&&($(".fixedHeader-floating").remove(),a.dataGrid.fixedHeader.destroy(),a.dataGrid.clear(),a.dataGrid.destroy()),b.isModal=!1})}]),angular.module("eduwebApp").controller("listReportCardsCtrl",["$scope","$rootScope","apiService","$timeout","$window","$q","$parse",function(a,b,c,d,e,f,g){var h=!0;a.filters={},a.filters.status="true",a.students=[],a.filterShowing=!1,a.toolsShowing=!1;b.modalLoading=!1,a.alert={},a.refreshing=!1,a.getReport="reportTable",a.loading=!0;var i=function(){var d=moment().format("YYYY");c.getTerms(d,function(b){var c=angular.fromJson(b);"success"==c.response&&(a.terms=c.data)},n),void 0===b.allClasses?"TEACHER"==b.currentUser.user_type?c.getTeacherClasses(b.currentUser.emp_id,function(b){var c=angular.fromJson(b);"success"==c.response&&(a.classes=c.data||[],a.filters["class"]=a.classes[0],a.filters.class_id=a.classes[0]?a.classes[0].class_id:null,a.getStudentReportCards())},n):c.getAllClasses({},function(b){var c=angular.fromJson(b);"success"==c.response&&(a.classes=c.data||[],a.filters["class"]=a.classes[0],a.filters.class_id=a.classes[0]?a.classes[0].class_id:null,a.getStudentReportCards())},n):(a.classes=b.allClasses,a.filters["class"]=a.classes[0],a.filters.class_id=a.classes[0].class_id,a.getStudentReportCards())};d(i,1),a.getStudentReportCards=function(){a.reportCards={},a.tableHeader=[],a.reportsNotFound=!1,a.getReport="";var b=a.filters["class"].class_id;c.getAllStudentReportCards(b,j,n)};var j=function(b,c){a.loading=!1;var e=angular.fromJson(b);if("success"==e.response)if(e.nodata)a.reportsNotFound=!0,a.errMsg="There are currently no report cards entered for this class.";else{a.rawReportCards=e.data,a.reportCards={},a.reportCards.students=[];var f="",g={},h=0;angular.forEach(a.rawReportCards,function(b,c){b.student_id!=f&&(h>0&&(a.reportCards.students[h-1].reports=g),a.reportCards.students.push({student_name:b.student_name,student_id:b.student_id,class_id:b.class_id,class_cat_id:b.class_cat_id,report_card_id:b.report_card_id,report_card_type:b.report_card_type,teacher_id:b.teacher_id,teacher_name:b.teacher_name,class_name:b.class_name,term_id:b.term_id,date:b.date,year:b.year,admission_number:b.admission_number,published:b.published}),g={},h++),g[b.term_name]={term_id:b.term_id,year:b.year,published:b.published,report_card_id:b.report_card_id,report_card_type:b.report_card_type,class_name:b.class_name,class_id:b.class_id,teacher_id:b.teacher_id,teacher_name:b.teacher_name,date:b.date,data:b.report_data},f=b.student_id}),a.reportCards.students[h-1].reports=g,a.getReport="reportTable",d(k,100)}else a.reportsNotFound=!0,a.errMsg=e.data};a.getReportCard=function(b,c,d){var e={student_id:b.student_id,student_name:b.student_name,admission_number:b.admission_number,class_teacher_id:b.teacher_id,report_card_type:b.report_card_type},f={student:e,report_card_id:d.report_card_id,class_name:d.class_name,class_id:d.class_id,published:d.published,term_id:d.term_id,term_name:c,year:d.year,report_card_type:d.report_card_type,teacher_id:d.teacher_id,teacher_name:d.teacher_name,date:d.date,reportData:d.data,adding:!1,filters:{term:{term_name:c,term_id:b.term_id},"class":{class_id:b.class_id,class_cat_id:b.class_cat_id}}};a.openModal("exams","reportCard","lg",f)};var k=function(){var c=$("#resultsTable");a.dataGrid=c.DataTable({responsive:{details:{type:"column"}},columnDefs:[{className:"control",orderable:!1,targets:0}],paging:!1,destroy:!0,order:[1,"asc"],filter:!0,info:!1,sorting:[],initComplete:function(c,d){a.loading=!1,b.loading=!1,a.$apply()},language:{search:"Search Results<br>",searchPlaceholder:"Filter",lengthMenu:"Display _MENU_",emptyTable:"No report cards found."}});var d=$(".navbar-fixed-top").height(),e=$("#body-content .content-fixed-header").height(),f=b.isSmallScreen?22:13;new $.fn.dataTable.FixedHeader(a.dataGrid,{header:!0,headerOffset:d+e+f}),l(),h&&m()},l=function(){if(!b.isSmallScreen){var a=$(".dataFilterForm form").width();$("#resultsTable_filter").css("left",a+55)}},m=function(){h=!1,e.addEventListener("resize",function(){if(b.isSmallScreen=window.innerWidth<768,b.isSmallScreen)$("#resultsTable_filter").css("left",0);else{var a=$(".dataFilterForm form").width();$("#resultsTable_filter").css("left",a-30)}},!1)};a.toggleFilter=function(){a.filterShowing=!a.filterShowing,a.filterShowing||a.toolsShowing?$("#resultsTable_filter").hide():d(function(){$("#resultsTable_filter").show()},500)},a.toggleTools=function(){a.toolsShowing=!a.toolsShowing,a.filterShowing||a.toolsShowing?$("#resultsTable_filter").hide():d(function(){$("#resultsTable_filter").show()},500)},a.addReportCard=function(){var b={classes:a.classes,terms:a.terms,filters:a.filters,adding:!0};a.openModal("exams","reportCard","lg",b)},a.$on("refreshReportCards",function(c,e){a.loading=!0,b.loading=!0,void 0!==e&&(a.updated=!0,a.notificationMsg=e.msg),a.refresh(),d(function(){a.alert.expired=!0},2e3),d(function(){a.updated=!1,a.notificationMsg="",a.alert.expired=!1},3e3)}),a.refresh=function(){a.loading=!0,a.refreshing=!0,b.loading=!0,a.getStudentReportCards()};var n=function(b,c){var d=angular.fromJson(b);a.error=!0,a.errMsg=d.data};a.$on("$destroy",function(){a.dataGrid&&($(".fixedHeader-floating").remove(),a.dataGrid.fixedHeader.destroy(),a.dataGrid.clear(),a.dataGrid.destroy()),b.isModal=!1})}]),angular.module("eduwebApp").controller("printClassAnalysisCtrl",["$scope","$rootScope",function(a,b){var c=function(){var c=window.printCriteria,d=angular.fromJson(c.criteria);a.title=d.class_name+" "+d.term+" "+d.exam_type,a.tableHeader=angular.fromJson(c.tableHeader),a.examMarks=angular.fromJson(c.examMarks),a.totalMarks=angular.fromJson(c.totalMarks),a.totalStudents=a.examMarks.length,setTimeout(function(){window.print(),setTimeout(function(){b.isPrinting=!1,window.close()},100)},100)};setTimeout(c,1),a.displayMeanScore=function(b){return Math.round(a.totalMarks[b]/a.totalStudents,1)||"-"}}]),angular.module("eduwebApp").controller("printReportCardCtrl",["$scope","$rootScope",function(a,b){var c=function(){a.isAdmin="SYS_ADMIN"==b.currentUser.user_type;var c=window.printCriteria;b.isPrinting=!0,a.showReportCard=!0,a.student=angular.fromJson(c.student),a.report=angular.fromJson(c.report),a.overall=angular.fromJson(c.overall),a.overallLastTerm=angular.fromJson(c.overallLastTerm),a.examTypes=angular.fromJson(c.examTypes),a.reportData=angular.fromJson(c.reportData),a.totals=angular.fromJson(c.totals),a.comments=angular.fromJson(c.comments),a.nextTermStartDate=c.nextTermStartDate,a.currentTermEndDate=c.currentTermEndDate,a.reportCardType=c.report_card_type,a.loading=!1,setTimeout(function(){window.print(),setTimeout(function(){b.isPrinting=!1,window.close()},100)},500)};setTimeout(c,1),a.$on("$destroy",function(){
b.isPrinting=!1})}]),angular.module("eduwebApp").controller("reportCardCtrl",["$scope","$rootScope","$uibModalInstance","apiService","dialogs","data","$timeout","$window","$parse",function(a,b,c,d,e,f,g,h,i){b.isPrinting=!1,a.student=f.student||void 0,a.reportCardType=void 0!==a.student?a.student.report_card_type:void 0,a.showSelect=void 0===a.student,a.classes=f.classes||[],a.terms=f.terms||[],a.filters=f.filters||[],a.adding=f.adding,a.thestudent={},a.examTypes={},a.comments={},a.parentPortalAcitve=!(!b.currentUser.settings["Parent Portal"]||"Yes"!=b.currentUser.settings["Parent Portal"]),a.canPrint=!1,a.report={},a.report.published=!1,a.showReportCard=!1,a.isTeacher="TEACHER"==b.currentUser.user_type,a.isAdmin="SYS_ADMIN"==b.currentUser.user_type;var j=function(){if("Standard"==a.reportCardType?d.getExamTypes(a.filters["class"].class_cat_id,function(b){var c=angular.fromJson(b);"success"==c.response&&(a.rawExamTypes=c.data,void 0===a.reportCardType&&(a.reportCardType=a.filters["class"].report_card_type),k())},u):k(),void 0===a.student)if("TEACHER"==b.currentUser.user_type){var c=b.currentUser.emp_id+"/"+!0;d.getTeacherStudents(c,l,u)}else d.getAllStudents(!0,l,u)};g(j,1);var k=function(){if(void 0!==f.reportData){a.savedReportData=angular.fromJson(f.reportData),a.originalData=angular.copy(a.savedReportData),a.report.report_card_id=f.report_card_id,a.report.class_name=f.class_name,a.report.class_id=f.class_id;var c=f.term_name;c=c.split(" "),a.report.term=c[1],a.report.term_id=f.term_id,a.report.year=f.year,a.report.published=f.published,a.reportCardType=f.report_card_type,a.report.teacher_id=f.teacher_id,a.report.teacher_name=f.teacher_name,a.comments.teacher_name=f.teacher_name,a.report.date=f.date,a.nextTermStartDate=a.savedReportData.nextTerm,a.currentTermEndDate=a.savedReportData.closingDate,a.overallLastTerm=f.overallLastTerm,a.savedReport=!0,a.canPrint=!0,a.canDelete=!a.isTeacher,a.filters=f.filters,a.isClassTeacher=a.student.class_teacher_id==b.currentUser.emp_id,m()}},l=function(c){var d=angular.fromJson(c);"success"==d.response?a.students=d.nodata?{}:b.formatStudentData(d.data):(a.error=!0,a.errMsg=d.data)};a.$watch("thestudent.selected",function(c,d){c!=d&&(a.showReportCard=!1,a.student=a.thestudent.selected,a.reportCardType=a.student.report_card_type,a.isClassTeacher=a.student.class_teacher_id==b.currentUser.emp_id)}),a.$watch("filters.class",function(b,c){b!=c&&(a.reportCardType=b.report_card_type,"Standard"==a.reportCardType&&d.getExamTypes(b.class_cat_id,function(b){var c=angular.fromJson(b);"success"==c.response&&(a.rawExamTypes=c.data)},u))}),a.$watch("filters.term",function(b,c){b!=c&&(a.currentTermEndDate=b.end_date,d.getNextTerm(b.end_date,function(b,c){var d=angular.fromJson(b);"success"==d.response&&(a.nextTermStartDate=void 0!==d.nodata?"":d.data.start_date)},u))}),a.clearSelect=function(b){b.stopPropagation(),a.thestudent.selected=void 0,a.showReportCard=!1,a.report={},a.overall={},a.overallLastTerm={},a.reportData=void 0},a.getProgressReport=function(c){a.showReportCard=!1,a.report={},a.overall={},a.overallLastTerm={},a.reportData=void 0,a.comments={},a.recreated=!1,a.savedReport=!1,a.currentFilters=angular.copy(a.filters),a.report.class_name=a.currentFilters["class"].class_name,a.report.class_id=a.currentFilters["class"].class_id;var e=a.currentFilters.term.term_name;if(e=e.split(" "),a.report.term=e[1],a.report.term_id=a.currentFilters.term.term_id,a.report.year=a.currentFilters.term.year,a.report.published=!1,a.report.teacher_id=a.currentFilters["class"].teacher_id,a.report.teacher_name=a.currentFilters["class"].teacher_name,a.comments.teacher_name=a.currentFilters["class"].teacher_name,c){a.savedReport=!1,a.recreated=!0;var f=a.student.student_id+"/"+a.report.class_id+"/"+a.report.term_id;a.isTeacher&&!a.isClassTeacher&&(f+="/"+b.currentUser.emp_id),d.getExamMarksforReportCard(f,o,u)}else m()};var m=function(){if("Standard"==a.reportCardType){var c=a.student.student_id+"/"+a.report.class_id+"/"+a.report.term_id;a.isTeacher&&!a.isClassTeacher&&(c+="/"+b.currentUser.emp_id),d.getExamMarksforReportCard(c,o,u)}else{a.report.date=moment().format("YYYY-MM-DD");var c="";c=a.isTeacher&&!a.isClassTeacher?a.filters["class"].class_cat_id+"/true/"+b.currentUser.emp_id:a.filters["class"].class_cat_id+"/true/0",d.getAllSubjects(c,n,u)}},n=function(b,c){var e=angular.fromJson(b);if("success"==e.response)if(void 0!==e.nodata)a.error=!0,a.errMsg="There are no subjects assigned to this students class.";else if(a.showReportCard=!0,a.reportData={},a.reportData.subjects=e.data,void 0===a.savedReportData){var f=a.student.student_id+"/"+a.report.class_id+"/"+a.report.term_id;d.getStudentReportCard(f,r,u)}else a.comments=angular.copy(a.savedReportData.comments)||{},angular.forEach(a.reportData.subjects,function(b,c){var d=a.savedReportData.subjects.filter(function(a){return a.subject_name==b.subject_name?a:void 0})[0];void 0!==d&&("Kindergarten"==a.reportCardType?b.remarks=angular.copy(d.remarks):b.skill_level=angular.copy(d.skill_level))})},o=function(b,c){var e=angular.fromJson(b);if("success"==e.response)if(e.details===!1)a.error=!0,a.errMsg="No data found.";else if(a.showReportCard=!0,p(e.data),void 0===a.savedReportData){var f=a.student.student_id+"/"+a.report.class_id+"/"+a.report.term_id;d.getStudentReportCard(f,r,u)}else s(a.latestExamMarks,a.savedReportData)},p=function(b){a.examMarks=b.details,a.overallSubjectMarks=b.subjectOverall,a.overall=b.overall,a.overallLastTerm=b.overallLastTerm,a.examTypes=a.rawExamTypes.filter(function(b){var c=a.examMarks.filter(function(a){return b.exam_type==a.exam_type?a:void 0})[0];return void 0!==c?b:void 0}),a.reportData={},a.reportData.subjects=q(a.examMarks),a.latestExamMarks=angular.copy(a.reportData);var c=0,d=0;angular.forEach(a.reportData.subjects,function(b,e){if(b.use_for_grading){var f=a.overallSubjectMarks.filter(function(a){return b.subject_name==a.subject_name?a:void 0})[0];f&&(b.overall_mark=f.percentage,b.overall_grade=f.grade,c+=parseInt(f.total_mark),d+=parseInt(f.total_grade_weight))}}),a.totals={},angular.forEach(a.reportData.subjects,function(b,c){b.use_for_grading&&angular.forEach(b.marks,function(c,d){void 0===a.totals[d]&&(a.totals[d]={total_mark:0,total_grade_weight:0}),null==b.parent_subject_name&&(a.totals[d].total_mark+=c.mark),null==b.parent_subject_name&&(a.totals[d].total_grade_weight+=c.grade_weight)})}),void 0!==a.originalData&&(a.comments=angular.copy(a.originalData.comments)||{},angular.forEach(a.reportData.subjects,function(b,c){var d=a.originalData.subjects.filter(function(a){return a.subject_name==b.subject_name?a:void 0})[0];void 0!==d&&(b.remarks=angular.copy(d.remarks))}))},q=function(a){var b={};b.subjects=[];var c="",d={},e=0;return angular.forEach(a,function(a,f){a.subject_name!=c&&(e>0&&(b.subjects[e-1].marks=d),b.subjects.push({subject_name:a.subject_name,parent_subject_name:a.parent_subject_name,teacher_id:a.teacher_id,initials:a.initials,use_for_grading:a.use_for_grading}),d={},e++),d[a.exam_type]={mark:a.mark,grade_weight:a.grade_weight,grade:a.grade},c=a.subject_name}),void 0!==b.subjects[e-1]&&(b.subjects[e-1].marks=d),b.subjects},r=function(b,c){var d=angular.fromJson(b);if("success"==d.response)if(void 0===d.nodata){a.canPrint=!0,a.showReportCard=!0,a.savedReport=!0,a.canDelete=!a.isTeacher,a.report=d.data;var e=a.report.term_name;e=e.split(" "),a.report.term=e[1],a.savedReportData=null!==d.data.report_data?angular.fromJson(d.data.report_data):[],a.originalData=angular.copy(a.savedReportData),a.setReportCardData(a.savedReportData),"Standard"==a.reportCardType&&s(a.latestExamMarks,a.savedReportData)}else a.savedReport=!1},s=function(b,c){a.currentReportData={},a.currentReportData.subjects=q(b),a.differences=[],angular.forEach(c.subjects,function(b,c){var d=a.currentReportData.subjects.filter(function(a){return a.subject_name==b.subject_name?a:void 0})[0];void 0!==d&&angular.forEach(b.marks,function(c,e){d.marks[e].mark!=c.mark&&a.differences.push({subject_name:b.subject_name,exam_type:e,change:"Mark has changed from "+c.mark+" to "+d.marks[e].mark}),d.marks[e].position!=c.position&&a.differences.push({subject_name:b.subject_name,exam_type:e,change:"Position has changed from "+c.position+" to "+d.marks[e].position}),d.marks[e].grade_weight!=c.grade_weight&&a.differences.push({subject_name:b.subject_name,exam_type:e,change:"Grade Weight has changed from "+c.grade_weight+" to "+d.marks[e].grade_weight})})})};a.recreateReport=function(){a.canPrint=!1,a.modified=!0,a.getProgressReport(!0)},a.revertReport=function(){a.canPrint=!0,a.modified=!1,a.recreated=!1,a.savedReport=!0,a.getProgressReport()},a.setReportCardData=function(c){a.canPrint=!0,a.showReportCard=!0,a.comments=angular.copy(c.comments)||{},a.nextTermStartDate=angular.copy(c.nextTerm),a.currentTermEndDate=angular.copy(c.closingDate),a.isTeacher&&!a.isClassTeacher&&(a.reportData.subjects=a.reportData.subjects.filter(function(a){return a.teacher_id==b.currentUser.emp_id?a:void 0})),a.reportData.subjects=a.reportData.subjects.map(function(a){var b=c.subjects.filter(function(b){return a.subject_name==b.subject_name?b:void 0})[0];return void 0!==b&&(a=b,a.updated=!0),a})},a.updateReport=function(){a.canPrint=!1,a.modified=!0},a.print=function(){var b={student:a.student,report:a.report,overall:a.overall,overallLastTerm:a.overallLastTerm,examTypes:a.examTypes,reportData:a.reportData,totals:a.totals,comments:a.comments,nextTermStartDate:a.nextTermStartDate,currentTermEndDate:a.currentTermEndDate,report_card_type:a.reportCardType},c=window.location.host,d=window.open("http://"+c+"/#/exams/report_card/print");d.printCriteria=b},a.deleteReportCard=function(){var b=e.confirm("Please Confirm","Are you sure you want to delete this report card? <br><br><b><i>(THIS CAN NOT BE UNDONE)</i></b>",{size:"sm"});b.result.then(function(b){d.deleteReportCard(a.report.report_card_id,function(b,d,e){var f=angular.fromJson(b);"success"==f.response?a.adding?(a.showReportCard=!1,a.report={},a.overall={},a.overallLastTerm={},a.reportData=void 0,a.comments={},a.recreated=!1,a.canDelete=!1):c.dismiss("canceled"):(a.error=!0,a.errMsg=f.data)},u)})},a.cancel=function(){c.dismiss("canceled")},a.save=function(){if(a.reportData.position=a.overall,a.reportData.position_last_term=a.overallLastTerm,a.reportData.totals=a.totals,a.reportData.comments=a.comments,a.reportData.nextTerm=a.nextTermStartDate,a.reportData.closingDate=a.currentTermEndDate,a.isTeacher&&!a.isClassTeacher){var c=angular.copy(a.reportData),e=!1;angular.forEach(a.originalData.subjects,function(a,b){angular.forEach(c.subjects,function(b,c){e=a.subject_name!=b.subject_name}),e&&c.subjects.push(a)})}else var c=angular.copy(a.reportData);var f={user_id:b.currentUser.user_id,student_id:a.student.student_id,term_id:a.report.term_id,class_id:a.report.class_id,report_card_type:a.reportCardType,teacher_id:a.report.teacher_id,report_data:JSON.stringify(c),published:a.report.published||"f"};d.addReportCard(f,t,u)};var t=function(c,d,e){var f=angular.fromJson(c);if("success"==f.response){a.originalData=angular.copy(a.reportData),a.canPrint=!0,a.saved=!0,a.modified=!1;var g=a.edit?"Report Card was updated.":"Report Card was added.";b.$emit("reportCardAdded",{msg:g,clear:!0})}else a.error=!0,a.errMsg=f.data},u=function(b,c){var d=angular.fromJson(b);a.error=!0,a.errMsg=d.data}}]),angular.module("eduwebApp").controller("feeItemFormCtrl",["$scope","$rootScope","$uibModalInstance","apiService","dialogs","data",function(a,b,c,d,e,f){a.classCatSelection=[],a.edit=void 0!==f,a.item=void 0!==f?f:{},a.deleted=!1,a.initializeController=function(){var c=b.currentUser.settings.Frequencies;a.frequencies=c.split(","),a.edit?(a.item.default_amount=parseFloat(f.default_amount_raw),a.classCatSelection=f.class_cats_restriction||[],a.isTransport="Transport"==f.fee_item,a.isTransport&&d.getTansportRoutes({},function(b){var c=angular.fromJson(b);"success"==c.response&&(void 0!==c.nodata?a.transportRoutes=[]:a.transportRoutes=c.data.map(function(a){return a.amount=parseFloat(a.amount),a}))},function(){})):(a.item.optional=!1,a.item.new_student_only=!1,a.item.replaceable=!1)},a.initializeController(),a.cancel=function(){c.dismiss("canceled")},a.toggleClassCat=function(b){var c=a.classCatSelection.indexOf(b);c>-1?a.classCatSelection.splice(c,1):a.classCatSelection.push(b)},a.save=function(c){if(!c.$invalid){var e=a.item;if(e.new_student_only=e.new_student_only?"t":"f",e.optional=e.optional?"t":"f",e.replaceable=e.replaceable?"t":"f",e.class_cats_restriction=a.classCatSelection,e.user_id=b.currentUser.user_id,a.edit)if(a.isTransport){var f={user_id:b.currentUser.user_id,routes:a.transportRoutes};d.updateRoutes(f,function(b,c){var f=angular.fromJson(b);"success"==f.response?d.updateFeeItem(e,g,h):(a.error=!0,a.errMsg=f.data)},h)}else d.updateFeeItem(e,g,h);else d.addFeeItem(e,g,h)}};var g=function(d,e,f){var g=angular.fromJson(d);if("success"==g.response){c.close(g.data);var h=a.deleted?"Fee Item was deleted.":a.edit?"Fee Item was updated":"Fee Item was added.";b.$emit("feeItemAdded",{msg:h,clear:!0,data:g.data})}else a.error=!0,a.errMsg=g.data},h=function(b,c){var d=angular.fromJson(b);a.error=!0;var e=d.data.indexOf('"U_route"')>-1?"Duplicate route name.":d.data;a.errMsg=e};a.deleteFeeItem=function(){a.error=!1,d.checkFeeItem(a.item.fee_item_id,function(c,f){var i=angular.fromJson(c);if("success"==i.response){var j=0==parseInt(i.data.num_students);if(j){var k=e.confirm("Delete Subject","Are you sure you want to permanently delete fee item <strong>"+a.item.fee_item+"</strong>? ",{size:"sm"});k.result.then(function(b){a.deleted=!0,d.deleteFeeItem(a.item.fee_item_id,g,h)})}else{var k=e.confirm("Please Confirm","Fee Item <strong>"+a.item.fee_item+"</strong> is associated with <b>"+i.data.num_students+"</b> students. Are you sure you want to mark this fee item as in-active? ",{size:"sm"});k.result.then(function(c){var e={user_id:b.currentUser.user_id,fee_item_id:a.item.fee_item_id,status:"f"};d.setFeeItemStatus(e,g,h)})}}else a.error=!0,a.errMsg=i.data},h)},a.activateFeeItem=function(){var c={user_id:b.currentUser.user_id,fee_item_id:a.item.fee_item_id,status:"t"};d.setFeeItemStatus(c,g,h)},a.addRoute=function(){a.transportRoutes.push({transport_id:void 0,route:void 0,amount:void 0})},a.removeRoute=function(b){a.transportRoutes.splice(b,1)}}]),angular.module("eduwebApp").controller("feeStructureCtrl",["$scope","$rootScope","apiService","$timeout","$window","$filter",function(a,b,c,d,e,f){a.filters={},a.filters.status="true",a.alert={},a.currency=b.currentUser.settings.Currency,a.loading=!0,a.gridFilter={},a.gridFilter.filterValue="";var g=function(){return'<div class="clickable" ng-class="{\'alert-warning\': row.entity.replacement_payment}" ng-click="grid.appScope.viewFeeItem(row.entity)">  <div ng-if="row.entity.merge">{{row.entity.title}}</div>  <div ng-if="!row.entity.merge" ng-repeat="(colRenderIndex, col) in colContainer.renderedColumns track by col.colDef.name" class="ui-grid-cell" ng-class="{ \'ui-grid-row-header-cell\': col.isRowHeader }"  ui-grid-cell></div></div>'},h=["Default Fee ( "+a.currency+" )"];a.gridOptions={enableSorting:!0,rowTemplate:g(),rowHeight:24,columnDefs:[{name:"Item Name",field:"fee_item",enableColumnMenu:!1},{name:h[0],field:"default_amount",enableColumnMenu:!1},{name:"Frequency",field:"frequency",enableColumnMenu:!1},{name:"Class Categories",field:"class_categories",cellFilter:"arrayToList",enableColumnMenu:!1},{name:"New Student Only",field:"new_student",enableColumnMenu:!1}],exporterCsvFilename:"fee-structure.csv",onRegisterApi:function(b){a.gridApi=b,a.gridApi.grid.registerRowsProcessor(a.singleFilter,200),d(function(){a.gridApi.core.handleWindowResize()})}};var i=function(){setTimeout(function(){var b=$(".full-height.datagrid").height();$("#grid1").css("height",b),a.gridApi.core.handleWindowResize()},100),j()};d(i,1);var j=function(){c.getFeeItems(a.filters.status,function(c,d,e){var g=angular.fromJson(c);"success"==g.response?(a.items=g.nodata?[]:g.data.required_items.concat(g.data.optional_items),a.items.length>0&&(a.items=a.items.map(function(a){if(null!==a.class_cats_restriction&&"{}"!=a.class_cats_restriction){var c=a.class_cats_restriction.slice(1,-1);a.class_cats_restriction=c.split(","),a.class_categories=[],angular.forEach(a.class_cats_restriction,function(c,d){angular.forEach(b.classCats,function(b,d){c==b.class_cat_id&&a.class_categories.push(b.class_cat_name)}),a.class_cats_restriction[d]=parseInt(c)})}else a.class_categories="All",a.class_cats_restriction=[];return a.new_student=a.new_student_only?"Yes":"-",a.default_amount_raw=a.default_amount,"Transport"==a.fee_item?a.default_amount=a.range:a.default_amount=f("currency")(a.default_amount,""),a})),k(a.items)):(a.error=!0,a.errMsg=g.data)},l)},k=function(c){a.gridOptions.data=c,a.loading=!1,b.loading=!1};a.filterDataTable=function(){a.gridApi.grid.refresh()},a.clearFilterDataTable=function(){a.gridFilter.filterValue="",a.gridApi.grid.refresh()},a.singleFilter=function(b){var c=new RegExp(a.gridFilter.filterValue,"i");return b.forEach(function(a){var b=!1;["fee_item","frequency"].forEach(function(d){a.entity[d].match(c)&&(b=!0)}),b||(a.visible=!1)}),b};var l=function(b,c){var d=angular.fromJson(b);a.error=!0,a.errMsg=d.data};a.loadFilter=function(){a.loading=!0,j()},a.addFeeItem=function(){a.openModal("fees","feeItemForm","md")},a.viewFeeItem=function(b){a.openModal("fees","feeItemForm","md",b)},a.exportItems=function(){a.gridApi.exporter.csvExport("visible","visible")},a.$on("refreshItems",function(c,e){a.loading=!0,b.loading=!0,void 0!==e&&(a.updated=!0,a.notificationMsg=e.msg),a.refresh(),d(function(){a.alert.expired=!0},2e3),d(function(){a.updated=!1,a.notificationMsg="",a.alert.expired=!1},3e3)}),a.refresh=function(){a.loading=!0,b.loading=!0,j()},a.$on("$destroy",function(){b.isModal=!1})}]),angular.module("eduwebApp").controller("feesDashboardCtrl",["$scope","$rootScope","apiService","$timeout","$window",function(a,b,c,d,e){a.currency=b.currentUser.settings.Currency,a.paymentsLoading=!0,a.invoicesLoading=!0,a.pastDueLoading=!0,a.gridFilter={},a.gridFilter.filterValue1="",a.gridFilter.filterValue2="",a.gridFilter.filterValue3="";var f=function(){return'<div class="clickable" ng-click="grid.appScope.viewPayment(row.entity)">  <div ng-if="row.entity.merge">{{row.entity.title}}</div>  <div ng-if="!row.entity.merge" ng-repeat="(colRenderIndex, col) in colContainer.renderedColumns track by col.colDef.name" class="ui-grid-cell" ng-class="{ \'ui-grid-row-header-cell\': col.isRowHeader }"  ui-grid-cell></div></div>'},g=function(){return'<div class="clickable" ng-click="grid.appScope.viewStudent(row.entity)">  <div ng-if="row.entity.merge">{{row.entity.title}}</div>  <div ng-if="!row.entity.merge" ng-repeat="(colRenderIndex, col) in colContainer.renderedColumns track by col.colDef.name" class="ui-grid-cell" ng-class="{ \'ui-grid-row-header-cell\': col.isRowHeader }"  ui-grid-cell></div></div>'},h=["Amt ( "+a.currency+" )","Balance ( "+a.currency+" )"];a.gridOptions1={enableSorting:!0,rowTemplate:f(),rowHeight:24,columnDefs:[{name:"Student",field:"student_name",enableColumnMenu:!1,sort:{direction:"asc"}},{name:h[0],field:"amount",cellFilter:'currency:""',enableColumnMenu:!1},{name:"Date",field:"payment_date",type:"date",cellFilter:"date",enableColumnMenu:!1}],onRegisterApi:function(b){a.gridApi1=b,a.gridApi1.grid.registerRowsProcessor(a.singleFilter1,200)}},a.gridOptions2={enableSorting:!0,rowTemplate:g(),rowHeight:24,columnDefs:[{name:"Student",field:"student_name",enableColumnMenu:!1,sort:{direction:"asc"}},{name:h[1],field:"balance",cellFilter:"numeric",enableColumnMenu:!1},{name:"Due Date",field:"due_date",type:"date",cellFilter:"date",enableColumnMenu:!1}],onRegisterApi:function(b){a.gridApi2=b,a.gridApi2.grid.registerRowsProcessor(a.singleFilter2,200)}},a.gridOptions3={enableSorting:!0,rowTemplate:g(),rowHeight:24,columnDefs:[{name:"Student",field:"student_name",enableColumnMenu:!1,sort:{direction:"asc"}},{name:h[1],field:"balance",cellFilter:"numeric",enableColumnMenu:!1},{name:"Due Date",field:"due_date",type:"date",cellFilter:"date",enableColumnMenu:!1}],onRegisterApi:function(b){a.gridApi3=b,a.gridApi3.grid.registerRowsProcessor(a.singleFilter3,200)}};var i=function(){if(void 0===b.terms){var d=moment().format("YYYY");c.getTerms(d,function(a){var c=angular.fromJson(a);"success"==c.response&&(b.terms=c.data,b.setTermRanges(c.data))},function(){})}void 0===b.termRange&&c.getTermRange({},function(c){var d=angular.fromJson(c);"success"==d.response&&(b.termRange=d.data,a.currentTerm=d.data.current,a.currentTermTitle=a.currentTerm.term_name+" "+a.currentTerm.year,a.date={startDate:a.currentTerm.start_date,endDate:a.currentTerm.end_date},j(a.currentTerm.start_date,a.currentTerm.end_date))},r);var e=moment().startOf("month").format("YYYY-MM-DD"),f=moment().endOf("month").format("YYYY-MM-DD");l(e,f),n(),p()};d(i,1);var j=function(a,b){var d=a+"/"+b+"/false";c.getPaymentsReceived(d,k,r)},k=function(b,c){var d=angular.fromJson(b);"success"==d.response?(a.paymentsReceived=d.data,a.paymentsReceivedTotal=0,a.paymentsLoading=!1,d.data instanceof Array&&(a.paymentsReceivedTotal=d.data.reduce(function(a,b){return a+=parseFloat(b.amount)},0)),a.gridOptions1.data=a.paymentsReceived):(a.prError=!0,a.prErrMsg=d.data)},l=function(a,b){var d=a+"/"+b;c.getPaymentsDue(d,m,r)},m=function(b,c){var d=angular.fromJson(b);"success"==d.response?(a.paymentsDue=d.data,a.paymentsDueTotal=0,a.invoicesLoading=!1,d.data instanceof Array&&(a.paymentsDueTotal=d.data.reduce(function(a,b){return a+=parseFloat(b.balance)},0)),a.gridOptions2.data=a.paymentsDue):(a.prError=!0,a.prErrMsg=d.data)},n=function(){c.getPaymentsPastDue({},o,r)},o=function(b,c){var d=angular.fromJson(b);"success"==d.response?(a.paymentsPastDue=d.data,a.paymentsPastDueTotal=0,a.pastDueLoading=!1,d.data instanceof Array&&(a.paymentsPastDueTotal=d.data.reduce(function(a,b){return a+=parseFloat(b.balance)},0)),a.gridOptions3.data=a.paymentsPastDue):(a.prError=!0,a.prErrMsg=d.data)},p=function(){c.getTotalsForTerm({},q,r)},q=function(b,c){var d=angular.fromJson(b);"success"==d.response?a.totals=d.data:(a.prError=!0,a.prErrMsg=d.data)};a.filterDataTable=function(b){switch(b){case"1":a.gridApi1.grid.refresh();break;case"2":a.gridApi2.grid.refresh();break;case"3":a.gridApi3.grid.refresh()}},a.clearFilterDataTable=function(b){switch(b){case"1":a.gridFilter.filterValue1="",a.gridApi1.grid.refresh();break;case"2":a.gridFilter.filterValue2="",a.gridApi2.grid.refresh();break;case"3":a.gridFilter.filterValue3="",a.gridApi3.grid.refresh()}},a.singleFilter1=function(b){var c=new RegExp(a.gridFilter.filterValue1,"i");return b.forEach(function(a){var b=!1;["student_name"].forEach(function(d){a.entity[d].match(c)&&(b=!0)}),b||(a.visible=!1)}),b},a.singleFilter2=function(b){var c=new RegExp(a.gridFilter.filterValue2,"i");return b.forEach(function(a){var b=!1;["student_name"].forEach(function(d){a.entity[d].match(c)&&(b=!0)}),b||(a.visible=!1)}),b},a.singleFilter3=function(b){var c=new RegExp(a.gridFilter.filterValue3,"i");return b.forEach(function(a){var b=!1;["student_name"].forEach(function(d){a.entity[d].match(c)&&(b=!0)}),b||(a.visible=!1)}),b},a.viewPayment=function(b){a.openModal("fees","paymentDetails","lg",b)},a.viewStudent=function(b){a.openModal("students","viewStudent","lg",b)},a.addPayment=function(){a.openModal("fees","paymentForm","lg",{})},a.adjustPayment=function(){a.openModal("fees","paymentDetails","lg",{})};var r=function(b,c){var d=angular.fromJson(b);a.error=!0,a.errMsg=d.data}}]),angular.module("eduwebApp").controller("invoiceCtrl",["$scope","$rootScope","$uibModalInstance","apiService","data",function(a,b,c,d,e){a.invoice=e.invoice,a.student=e.student,a.currency=b.currentUser.settings.Currency;var f=a.invoice.term_name;f=f.split(" "),a.invoice.term_name=f[1];var g=function(){var b=a.invoice.student_id+"/"+moment(a.invoice.inv_date).format("YYYY-MM-DD");d.getStudentArrears(b,function(b){var c=angular.fromJson(b);"success"==c.response&&void 0===c.nodata&&(a.arrears=c.data.balance,a.hasArrears=!0)},i),d.getStudentCredits(a.invoice.student_id,function(b,c){a.loading=!1;var d=angular.fromJson(b);"success"==d.response&&void 0===d.nodata&&(a.availableCredits=d.data,a.hasCredit=!0,a.credit=a.availableCredits.reduce(function(a,b){return a+=parseFloat(b.amount)},0))},i),d.getInvoiceDetails(a.invoice.inv_id,h,i)};setTimeout(g,1),a.cancel=function(){c.dismiss("canceled")};var h=function(b,c){var d=angular.fromJson(b);if("success"==d.response){a.invoiceLineItems=d.nodata?{}:d.data,a.lineItems=[];var e,f=0;angular.forEach(a.invoiceLineItems,function(b,c){e=b.amount.split("."),a.lineItems[b.fee_item]={ksh:e[0],cts:e[1]},f+=parseFloat(b.amount)});var e=String(f).indexOf(".")>-1?String(f).split("."):[f,"00"];a.totalAmtKsh=e[0],a.totalAmtCts=e[1]}else a.error=!0,a.errMsg=d.data},i=function(b,c){var d=angular.fromJson(b);a.error=!0,a.errMsg=d.data};a.print=function(){var b={student:a.student,invoice:a.invoice,invoiceLineItems:a.invoiceLineItems,totals:{totalAmtKsh:a.totalAmtKsh,totalAmtCts:a.totalAmtCts},lineItems:a.lineItems},c=window.location.host,d=window.open("http://"+c+"/#/fees/invoice/print");d.printCriteria=b}}]),angular.module("eduwebApp").controller("invoiceDetailsCtrl",["$scope","$rootScope","$uibModalInstance","apiService","dialogs","data","$parse",function(a,b,c,d,e,f,g){a.invoice=f,a.date={startDate:a.invoice.inv_date},a.due_date={startDate:a.invoice.due_date},a.currency=b.currentUser.settings.Currency,a.edit=void 0!==a.permissions.fees.invoices.edit?a.permissions.fees.invoices.edit:!1;var h=void 0;a.totals={},a.creditApplied=!1,0==a.invoice.balance&&a.invoice.total_paid>0&&(a.edit=!1),a.$watch("invoice.newItem",function(b,c){if(b!=c){var d=a.invoiceLineItems.length-1;b.adding=!0,a.invoiceLineItems[d]=b,a.sumInvoice()}}),a.initializeController=function(){d.getInvoiceDetails(a.invoice.inv_id,function(b){var c=angular.fromJson(b);"success"==c.response?(a.invoiceLineItems=c.nodata?{}:c.data,a.invoiceLineItems=a.invoiceLineItems.map(function(a){return a.adding=!1,a}),h=angular.copy(a.invoiceLineItems),a.totals.balance=angular.copy(a.invoice.balance),a.totals.total_due=angular.copy(a.invoice.total_due)):(a.error=!0,a.errMsg=c.data)},k);var b=a.invoice.student_id+"/"+moment(a.invoice.inv_date).format("YYYY-MM-DD");d.getStudentArrears(b,function(b){var c=angular.fromJson(b);"success"==c.response&&void 0===c.nodata&&(a.arrears=c.data.balance,a.hasArrears=!0)},k),d.getStudentCredits(a.invoice.student_id,function(b,c){a.loading=!1;var d=angular.fromJson(b);"success"==d.response&&void 0===d.nodata&&(a.availableCredits=d.data,a.hasCredit=!0,a.credit=a.availableCredits.reduce(function(a,b){return a+=parseFloat(b.amount)},0))},k),d.getTerms(void 0,function(b,c){var d=angular.fromJson(b);"success"!=d.response||d.nodata||(a.terms=d.data)},k)},a.initializeController(),a.applyCredit=function(){a.creditApplied=!a.creditApplied;var b=angular.copy(a.totals.total_due);a.creditApplied?b<a.credit?(a.appliedCreditAmt=b,a.creditAvailable=a.credit-b,a.totals.balance=b-a.appliedCreditAmt):(a.appliedCreditAmt=a.credit,a.creditAvailable=0,a.totals.balance=b-a.credit):(a.totals.balance=b,a.creditAvailable=a.credit,a.appliedCreditAmt=0)},a.cancel=function(){c.dismiss("canceled")},a.cancelInvoice=function(){var c=e.confirm("Cancel Invoice","Are you sure you want to mark this invoice as <strong>canceled</strong>?",{size:"sm"});c.result.then(function(c){var e={user_id:a.currentUser.user_id,inv_id:a.invoice.inv_id};d.cancelInvoice(e,function(c){var d=angular.fromJson(c);"success"==d.response&&(a.invoice.canceled=!0,b.$emit("invoiceAdded",{msg:"Invoice canceled.",clear:!0}))},k)})},a.reactivateInvoice=function(){var c=e.confirm("Activate Invoice","Are you sure you want to mark this invoice as <strong>active</strong>?",{size:"sm"});c.result.then(function(c){var e={user_id:a.currentUser.user_id,inv_id:a.invoice.inv_id};d.reactivateInvoice(e,function(c){var d=angular.fromJson(c);"success"==d.response&&(a.invoice.canceled=!1,b.$emit("invoiceAdded",{msg:"Invoice activated.",clear:!0}))},k)})},a.deleteInvoice=function(){var f=e.confirm("Delete Invoice","Are you sure you want to <strong>DELETE</strong> this invoice? (This CAN NOT be undone)",{size:"sm"});f.result.then(function(e){d.deleteInvoice(a.invoice.inv_id,function(a){var d=angular.fromJson(a);"success"==d.response&&(b.$emit("invoiceAdded",{msg:"Invoice deleted.",clear:!0}),c.close())},k)})},a.removeLineItem=function(b){a.invoiceLineItems.splice(b,1),a.sumInvoice(),a.changes=!0},a.revertInvoice=function(b){a.invoiceLineItems=h,a.sumInvoice(),a.changes=!1},a.sumInvoice=function(){a.changes=!0,a.totals.total_due=a.invoiceLineItems.reduce(function(a,b){return""==b.amount&&(b.amount=0),a+=parseFloat(b.amount)},0),a.totals.balance=a.invoice.total_paid-a.totals.total_due,a.invoice.balance=angular.copy(a.totals.balance),a.creditApplied&&(a.totals.balance=a.totals.balance-a.credit)},a.addRow=function(b){(void 0===a.studentFeeItems||b)&&d.getStudentFeeItems(a.invoice.student_id,function(b,c){var d=angular.fromJson(b);"success"==d.response&&(a.studentFeeItems=angular.copy(d.data))},k),a.invoiceLineItems.push({fee_item:void 0,amount:void 0,notselected:!0})},a.viewStudent=function(b,c){a.removeLineItem(c);var d=window.location.host,f=e.create("http://"+d+"/app/students/viewStudent.html","viewStudentCtrl",b,{size:"lg",backdrop:"static"});f.result.then(function(b){a.addRow(!0)},function(){a.addRow(!0)})},a.printInvoice=function(){d.getStudentDetails(a.invoice.student_id,function(c){var d=angular.fromJson(c);if("success"==d.response){var f=b.formatStudentData([d.data]),g=b.allClasses.filter(function(a){return a.class_id==f[0].class_id?a:void 0});f[0].current_class=g[0],a.student=f[0];var h={student:a.student,invoice:a.invoice};e.create("/app/fees/invoice.html","invoiceCtrl",h,{size:"md",backdrop:"static"})}})},a.save=function(){a.error=!1,a.errMsg="";var b=[];angular.forEach(a.invoiceLineItems,function(a,c){b.push({student_fee_item_id:a.student_fee_item_id,inv_item_id:a.inv_item_id,amount:a.amount})});var c={user_id:a.currentUser.user_id,inv_id:a.invoice.inv_id,total_amount:a.totals.total_due,inv_date:moment(a.date.startDate).format("YYYY-MM-DD"),due_date:moment(a.due_date.startDate).format("YYYY-MM-DD"),line_items:b,term_id:a.invoice.term_id};d.updateInvoice(c,i,k)};var i=function(d,e){var f=angular.fromJson(d);"success"==f.response?a.creditApplied?j(f.data):(c.close(),b.$emit("invoiceAdded",{msg:"Invoice updated.",clear:!0})):(a.error=!0,a.errMsg=f.data)},j=function(d){var d=(a.appliedCreditAmt,{selectedStudent:d,invoiceData:d,appliedCreditAmt:a.appliedCreditAmt,payments:a.availableCredits}),f=a.availableCredits>1?"lg":"md",g=e.create("applyCredit.html","applyCreditCtrl",d,{size:f,backdrop:"static"});g.result.then(function(a){c.close(),b.$emit("invoiceAdded",{msg:"Invoice updated.",clear:!0})},function(){var a=e.confirm("Cancel Credit?","Do you wish to cancel applying the credit to this invoice?",{size:"sm"});a.result.then(function(a){c.close(),b.$emit("invoiceAdded",{msg:"Invoice updated.",clear:!0})},function(a){j(d)})})},k=function(b,c){var d=angular.fromJson(b);a.error=!0,a.errMsg=d.data}}]),angular.module("eduwebApp").controller("invoiceFormCtrl",["$scope","$rootScope","$uibModalInstance","apiService","dialogs","data","$parse",function(a,b,c,d,e,f,g){a.student={},a.selectedStudent=void 0!==f.selectedStudent?f.selectedStudent:void 0,a.selectStudent=void 0===f.selectedStudent,a.student.selected=a.selectedStudent,a.invoice={},a.currency=b.currentUser.settings.Currency,a.invoice.date={startDate:moment().format("YYYY-MM-DD")},a.invoice.due_date={startDate:moment().add(1,"months").format("YYYY-MM-DD")},a.invoiceLineItems=[],a.totals={},a.alert={},a.filters={},a.filters.method="system",a.creditApplied=!1,a.initializeController=function(){void 0===a.selectedStudent&&d.getAllStudents(!0,function(c){var d=angular.fromJson(c);
"success"==d.response?a.students=d.nodata?{}:b.formatStudentData(d.data):(a.error=!0,a.errMsg=d.data)},function(){}),d.getTerms(void 0,function(c,d){var e=angular.fromJson(c);if("success"==e.response&&!e.nodata){a.terms=e.data,b.terms=e.data;var f=a.terms.filter(function(a){return a.current_term?a:void 0})[0];a.filters.term_id=f.term_id}},l)},a.initializeController(),a.cancel=function(){c.dismiss("canceled")},a.clearSelect=function(b,c){c.stopPropagation();var b=g(b+".selected");b.assign(a,void 0)},a.$watch("student.selected",function(b,c){b!=c&&(a.selectedStudent=a.student.selected)}),a.viewStudent=function(b){var c=window.location.host,d=e.create("http://"+c+"/app/students/viewStudent.html","viewStudentCtrl",b,{size:"lg",backdrop:"static"});d.result.then(function(b){a.generateInvoice()},function(){a.generateInvoice()})},a.generateInvoice=function(){if(void 0===a.selectedStudent||void 0===a.selectedStudent.student_id)a.studentError=!0;else{a.studentError=!1,a.error=!1,a.errMsg="",a.hasCredit=void 0,a.credit=void 0,a.hasArrears=void 0,a.arrears=void 0,a.loadManual=!1,a.loadSystem=!1,a.termId=angular.copy(a.filters.term_id),d.getStudentCredits(a.selectedStudent.student_id,function(b,c){a.loading=!1;var e=angular.fromJson(b);if("success"==e.response&&void 0===e.nodata&&(a.availableCredits=e.data,a.hasCredit=!0,a.credit=a.availableCredits.reduce(function(a,b){return a+=parseFloat(b.amount)},0)),"manual"==a.filters.method)void 0!==a.selectedStudent&&void 0===a.studentFeeItems&&d.getStudentFeeItems(a.selectedStudent.student_id,function(b,c){var d=angular.fromJson(b);"success"==d.response&&(a.studentFeeItems=angular.copy(d.data))},l),a.loadManual=!0;else{var f=a.termId+"/"+a.selectedStudent.student_id;d.generateInvoices(f,h,l)}},l);var b=a.selectedStudent.student_id+"/"+moment().format("YYYY-MM-DD");d.getStudentArrears(b,function(b){var c=angular.fromJson(b);"success"==c.response&&void 0===c.nodata&&(a.arrears=c.data.balance,a.hasArrears=!0)},l)}};var h=function(b,c){var d=angular.fromJson(b);"success"==d.response?(a.results=d.nodata?[]:d.data,a.invoices=[],a.invoices=a.results.reduce(function(a,b){var c=angular.copy(b.inv_date);return b.amount=b.invoice_amount,b.inv_date={startDate:moment(c).format("YYYY-MM-DD")},b.due_date={startDate:moment(c).add(1,"month").format("YYYY-MM-DD")},void 0===a[c]&&(a[c]=[]),a[c].push(b),a},{}),a.activeInvoice=Object.keys(a.invoices)[0],a.invoiceTotal={},angular.forEach(a.invoices,function(b,c){a.invoiceTotal[c]=b.reduce(function(a,b){return a+=parseFloat(b.amount)},0)}),a.invoiceLineItems=a.invoices[a.activeInvoice],a.totals.balance=angular.copy(a.invoiceTotal[a.activeInvoice]),a.totals.invoice=angular.copy(a.totals.balance),a.loadSystem=!0):(a.error=!0,a.errMsg=d.data)};a.getInvoice=function(b){a.activeInvoice=b,a.invoiceLineItems=a.invoices[b],a.totals.balance=angular.copy(a.invoiceTotal[b]),a.sumInvoice()},a.$watch("invoice.newItem",function(b,c){if(b!=c){var d=a.invoiceLineItems.length-1;a.invoiceLineItems[d]=b,a.sumInvoice()}}),a.removeLineItem=function(b){a.invoiceLineItems.splice(b,1),a.sumInvoice()},a.sumInvoice=function(){a.totals.balance=a.invoiceLineItems.reduce(function(a,b){return""==b.amount&&(b.amount=0),a+=parseFloat(b.amount)},0),a.totals.invoice=angular.copy(a.totals.balance),"system"==a.filters.method&&(a.invoiceTotal={},angular.forEach(a.invoices,function(b,c){a.invoiceTotal[c]=b.reduce(function(a,b){return""==b.amount&&(b.amount=0),a+=parseFloat(b.amount)},0)})),a.creditApplied&&(a.totals.balance=a.totals.balance-a.credit)},a.addRow=function(){void 0===a.studentFeeItems&&d.getStudentFeeItems(a.student.selected.student_id,function(b,c){var d=angular.fromJson(b);"success"==d.response&&(a.studentFeeItems=angular.copy(d.data))},l),a.invoiceLineItems.push({fee_item:void 0,amount:void 0})},a.applyCredit=function(){a.creditApplied=!a.creditApplied;var b=angular.copy(a.totals.invoice);a.creditApplied?b<a.credit?(a.appliedCreditAmt=b,a.creditAvailable=a.credit-b,a.totals.balance=b-a.appliedCreditAmt):(a.appliedCreditAmt=a.credit,a.creditAvailable=0,a.totals.balance=b-a.credit):(a.totals.balance=b,a.creditAvailable=a.credit,a.appliedCreditAmt=0)},a.save=function(){a.error=!1,a.errMsg="";var b={user_id:a.currentUser.user_id,invoices:[]},c=[];"system"==a.filters.method?angular.forEach(a.invoices,function(d,e){c=[],angular.forEach(d,function(a,b){null!==a&&c.push({student_fee_item_id:a.student_fee_item_id,amount:a.amount})}),b.invoices.push({inv_date:moment(d[0].inv_date.startDate).format("YYYY-MM-DD"),student_id:a.selectedStudent.student_id,due_date:moment(d[0].due_date.startDate).format("YYYY-MM-DD"),total_amount:a.invoiceTotal[e],line_items:c,term_id:a.termId})}):(angular.forEach(a.invoiceLineItems,function(a,b){null!==a&&c.push({student_fee_item_id:a.student_fee_item_id,amount:a.amount})}),b.invoices.push({inv_date:a.invoice.date.startDate,student_id:a.selectedStudent.student_id,due_date:a.invoice.due_date.startDate,total_amount:a.totals.balance,line_items:c,term_id:a.termId})),d.createInvoice(b,i,l)};var i=function(d,e){var f=angular.fromJson(d);"success"==f.response?a.creditApplied?j(f.data):(c.close(),b.$emit("invoiceAdded",{msg:"Invoice(s) created.",clear:!0})):(a.error=!0,a.errMsg=f.data)},j=function(b){var c=b;a.appliedCreditAmt;k(c)},k=function(d){var f={selectedStudent:a.selectedStudent,invoiceData:d,appliedCreditAmt:a.appliedCreditAmt,payments:a.availableCredits},g=e.create("applyCredit.html","applyCreditCtrl",f,{size:"lg",backdrop:"static"});g.result.then(function(a){c.close(),b.$emit("invoiceAdded",{msg:"Invoice(s) created.",clear:!0})},function(){var a=e.confirm("Cancel Credit?","Do you wish to cancel applying the credit to this invoice?",{size:"sm"});a.result.then(function(a){c.close(),b.$emit("invoiceAdded",{msg:"Invoice(s) created.",clear:!0})},function(a){j(f)})})},l=function(b,c){var d=angular.fromJson(b);a.error=!0,a.errMsg=d.data}}]).controller("applyCreditCtrl",["$scope","$rootScope","$uibModalInstance","dialogs","$filter","apiService","data",function(a,b,c,d,e,f,g){a.student=g.selectedStudent,a.invoiceData=g.invoiceData,a.appliedCreditAmt=g.appliedCreditAmt,a.payments=g.payments,a.feeItemsSelection={},a.apply_to_all={},a.totalApplied={},a.totalCredit={},angular.forEach(a.payments,function(b,c){b.invoiceItems=angular.copy(a.invoiceData),angular.forEach(b.invoiceItems,function(b,c){a.feeItemsSelection[c]=[],b.amount=void 0}),a.apply_to_all[c]=!1,a.totalApplied[c]=0,a.totalCredit[c]=b.amount}),a.cancel=function(){c.dismiss("Canceled")},a.selectAllItems=function(b,c){a.apply_to_all[b]=!a.apply_to_all[b],a.apply_to_all[b]?angular.forEach(c.invoiceItems,function(c,d){c.amount=Math.abs(c.balance),a.totalApplied[b]+=parseInt(c.amount),a.feeItemsSelection[b].push(c)}):angular.forEach(c.invoiceItems,function(c,d){c.amount=void 0,a.totalApplied[b]=0,a.feeItemsSelection[b]=[]}),a.totalCredit[b]=c.amount-a.totalApplied[b]>0?c.amount-a.totalApplied[b]:0},a.toggleFeeItems=function(b,c,d){var e=a.feeItemsSelection[b].indexOf(c);e>-1?(a.totalApplied[b]=a.totalApplied[b]-c.amount,a.totalApplied[b]<0&&(a.totalApplied[b]=0),c.amount=void 0,a.feeItemsSelection[b].splice(e,1)):(a.appliedCreditAmt<Math.abs(c.balance)?c.amount=a.appliedCreditAmt:c.amount=Math.abs(c.balance),a.totalApplied[b]+=parseFloat(c.amount),a.feeItemsSelection[b].push(c)),a.totalCredit[b]=d.amount-a.totalApplied[b]>0?d.amount-a.totalApplied[b]:0},a.done=function(b){var c=0;if(angular.forEach(a.totalApplied,function(a){c+=a}),c>a.appliedCreditAmt)d.error("Amount Inconsistency","<p>You have entered <strong>"+e("number")(c)+" Ksh</strong> towards fee items, however to total credit amount entered was <strong>"+e("number")(a.appliedCreditAmt)+" Ksh</strong>.</p><p>Please correct, the total amount applied to fee items can not exceed the total credit amount.</p>",{size:"sm"});else if(c<a.appliedCreditAmt){var f=d.error("Credit Remaining","<p>You have entered <strong>"+e("number")(c)+" Ksh</strong> towards fee items, however to total credit amount entered was <strong>"+e("number")(a.appliedCreditAmt)+" Ksh</strong>.</p><p>Did you want to reduce the credit applied to this invoice to "+e("number")(c)+" Ksh?</p>",{size:"sm"});f.result.then(function(a){h()})}else h()};var h=function(){angular.forEach(a.payments,function(c,d){if(a.feeItemsSelection[d].length>0){var e=[];angular.forEach(a.feeItemsSelection[d],function(a,b){e.push({payment_inv_item_id:a.payment_inv_item_id,inv_item_id:a.inv_item_id,inv_id:a.inv_id,amount:a.amount})});var g={user_id:b.currentUser.user_id,payment_id:c.payment_id,student_id:a.student.student_id,payment_date:moment(c.payment_date.startDate).format("YYYY-MM-DD"),amount:c.amount,payment_method:c.payment_method,slip_cheque_no:c.slip_cheque_no,replacement_payment:"true"==c.replacement_payment?"t":"f",line_items:e,hasCredit:!0,creditAmt:a.totalCredit[d],creditId:c.credit_id||null};f.updatePayment(g,i,j)}})},i=function(b){var d=angular.fromJson(b);"success"==d.response?c.close(d.data):(a.error=!0,a.errMsg=d.data)},j=function(b,c){var d=angular.fromJson(b);a.error=!0,a.errMsg=d.data};a.sumPayment=function(b){a.totalApplied[b]=a.payments[b].invoiceItems.reduce(function(a,b){return""==b.amount&&(b.amount=0),a+=parseFloat(b.amount)},0),a.totalCredit[b]=a.payments[b].amount-a.totalApplied[b]>0?a.payments[b].amount-a.totalApplied[b]:0}}]).run(["$templateCache",function(a){a.put("applyCredit.html",'<form name="applyCredit" class="form-horizontal modalForm" novalidate role="form" ng-submit="done(applyCredit)"><div class="modal-header"><h4 class="modal-title">Apply Credit</h4></div><div class="modal-body cleafix"><div class="alert alert-info">Select where you would like to apply the credit of <b>{{appliedCreditAmt|currency:""}}</b> Ksh.</div><div class="row"><div ng-class="{\'col-sm-6\': payments.length>1, \'col-sm-12\': payments.length<=1}" ng-repeat="payment in payments track by $index"><div class="well"><div class="row"><div class="col-sm-4"><label>Payment No.</label><p>{{payment.payment_id}} </p></div><div class="col-sm-4"><label>Payment Date</label><p>{{payment.payment_date|date}} </p></div><div class="col-sm-4"><label>Payment Method</label><p>{{payment.payment_method}} </p></div><div class="col-sm-4"><label>Amount</label><p class="nowrap">{{payment.amount|numeric}} Ksh </p></div><div class="col-sm-4"><label>Applied</label><p class="nowrap" ng-class="{\'text-danger\': totalApplied[$index]>payment.amount}">{{totalApplied[$index]|numeric}} Ksh </p></div><div class="col-sm-4"><label>Remaining</label><p class="nowrap" ng-class="{\'text-success\': totalCredit[$index]>0}">{{totalCredit[$index]|numeric}} Ksh </p></div></div><table class="display dataTable" cellspacing="0" width="100%"><thead><tr><th class="center"><input type="checkbox" name="apply_to_all" ng-model="payment.apply_to_all[$index]" ng-click="selectAllItems($index,payment)" ng-value="true"  /></th><th>Fee Item</th><th>Balance</th><th>Paying</th></tr></thead><tbody><tr ng-repeat="feeitem in payment.invoiceItems track by $index"><td class="center"><input type="checkbox" name="selected_invoices[$parent.$index][]" value="{{item.inv_item_id}}" ng-checked="feeItemsSelection[$parent.$index].indexOf(feeitem) > -1" ng-click="toggleFeeItems($parent.$index,feeitem,payment)" ></td><td ng-click="toggleFeeItems($parent.$index,feeitem,payment)">{{feeitem.fee_item}}</td><td ng-click="toggleFeeItems($parent.$index,feeitem,payment)">{{feeitem.balance|numeric}}</td><td><input type="text" name="fee_item_amount[$parent.$index][]" ng-model="feeitem.amount" class="form-control" placeholder="{{feeitem.balance|makePositive}}" ng-change="sumPayment($parent.$index)" /></td></tr></tbody></table></div></div></div></div><div class="modal-footer"><button type="button" class="btn btn-link" ng-click="cancel()">Cancel</button><button type="submit" class="btn btn-success">Save</button></div></form>')}]),angular.module("eduwebApp").controller("invoiceWizardCtrl",["$scope","$rootScope","$uibModalInstance","apiService","dialogs","data","$parse",function(a,b,c,d,e,f,g){a.currency=b.currentUser.settings.Currency,a.filters={},a.initializeController=function(){d.getTerms(void 0,function(c,d){var e=angular.fromJson(c);if("success"==e.response&&!e.nodata){a.terms=e.data,b.terms=e.data;var f=a.terms.filter(function(a){return a.current_term?a:void 0})[0];a.filters.term_id=f.term_id}},j)},a.initializeController(),a.cancel=function(){c.dismiss("canceled")},a.viewStudent=function(b){var c=window.location.host,d=e.create("http://"+c+"/app/students/viewStudent.html","viewStudentCtrl",b,{size:"lg",backdrop:"static"});d.result.then(function(b){a.generateInvoice()},function(){a.generateInvoice()})},a.generateInvoice=function(){a.error=!1,a.errMsg="",a.showResults=!1,a.termId=angular.copy(a.filters.term_id),d.generateInvoices(a.termId,h,j)};var h=function(b,c){var d=angular.fromJson(b);if("success"==d.response){a.allResults=d.nodata?[]:d.data;var e="",f={};a.results=[];var g=0,h=[],i=[];angular.forEach(a.allResults,function(b,c){c>0&&e!=b.student_id+" "+b.inv_date&&(a.results.push({student_id:f.student_id,student_name:f.student_name,inv_date:f.inv_date,due_date:moment(f.inv_date).add(1,"month").format("YYYY-MM-DD"),fee_items:h,line_items:i,total_amount:g,payment_plan_name:f.payment_plan_name}),g=0,h=[],i=[]),g+=parseFloat(b.invoice_amount),h.push(b.fee_item),i.push(b),e=b.student_id+" "+b.inv_date,f=b}),a.results.push({student_id:f.student_id,student_name:f.student_name,inv_date:f.inv_date,due_date:moment(f.inv_date).add(1,"month").format("YYYY-MM-DD"),fee_items:h,line_items:i,total_amount:g,payment_plan_name:f.payment_plan_name}),a.invoices=a.results.reduce(function(a,b){var c=angular.copy(b.inv_date),d=moment(c).format("MMM");return b.inv_date={startDate:b.inv_date},b.due_date={startDate:b.due_date},void 0===a[d]&&(a[d]=[]),a[d].push(b),a},{}),a.activeMonth=Object.keys(a.invoices)[0],a.invoiceTotal={},angular.forEach(a.invoices,function(b,c){a.invoiceTotal[c]=b.reduce(function(a,b){return a=parseInt(a)+parseInt(b.total_amount)},0)}),a.showResults=!0}else a.error=!0,a.errMsg=d.data};a.getInvoice=function(b){a.activeMonth=b},a.save=function(){a.error=!1,a.errMsg="";var b={user_id:a.currentUser.user_id,invoices:[]},c=[];angular.forEach(a.invoices,function(d,e){angular.forEach(d,function(e,f){c=[],angular.forEach(e.line_items,function(a,b){null!==a&&c.push({student_fee_item_id:a.student_fee_item_id,amount:a.invoice_amount})}),b.invoices.push({inv_date:moment(d[0].inv_date.startDate).format("YYYY-MM-DD"),student_id:e.student_id,due_date:moment(d[0].inv_date.startDate).add(1,"month").format("YYYY-MM-DD"),total_amount:e.total_amount,line_items:c,term_id:a.termId,payment_plan_name:e.payment_plan_name})})}),d.createInvoice(b,i,j)};var i=function(d,e){var f=angular.fromJson(d);"success"==f.response?(c.close(),b.$emit("invoiceAdded",{msg:"Invoice(s) were created.",clear:!0})):(a.error=!0,a.errMsg=f.data)},j=function(b,c){var d=angular.fromJson(b);a.error=!0,a.errMsg=d.data}}]),angular.module("eduwebApp").controller("invoicesCtrl",["$scope","$rootScope","apiService","$timeout","$window","$state",function(a,b,c,d,e,f){a.filters={},a.filters.status="true",a.filters.balance_status=""!==f.params.balance_status?f.params.balance_status:null,a.filterBalStatus=""!==f.params.balance_status,a.invoices=[],a.filterShowing=!1,a.toolsShowing=!1;var g=!0,h=!1;b.modalLoading=!1,a.alert={},a.currency=b.currentUser.settings.Currency,a.totals={},a.balanceStatuses=["Balance Owing","Paid in Full","Due This Month","Past Due"],a.loading=!0,a.gridFilter={},a.gridFilter.filterValue="";var i=moment().format("YYYY-01-01"),j=moment().format("YYYY-12-31");a.date={startDate:i,endDate:j};var k=angular.copy(a.date),l=!1;a.filters.date=a.date;var m=function(){return'<div class="clickable" ng-class="{\'alert-danger\': row.entity.days_overdue > 0}">  <div ng-if="row.entity.merge">{{row.entity.title}}</div>  <div ng-if="!row.entity.merge" ng-repeat="(colRenderIndex, col) in colContainer.renderedColumns track by col.colDef.name" class="ui-grid-cell" ng-class="{ \'ui-grid-row-header-cell\': col.isRowHeader }"  ui-grid-cell></div></div>'},n=["Amount ( "+a.currency+" )","Paid ( "+a.currency+" )","Balance ( "+a.currency+" )"];a.gridOptions={enableSorting:!0,rowTemplate:m(),rowHeight:34,columnDefs:[{name:"Invoice",field:"inv_id",headerCellClass:"center",cellClass:"center",enableColumnMenu:!1,width:60,cellTemplate:'<div class="ui-grid-cell-contents" ng-click="grid.appScope.getInvoice(row.entity)"><i class="glyphicon glyphicon-file"></i><br>{{row.entity.inv_id}}</div>'},{name:"Name",field:"student_name",enableColumnMenu:!1,cellTemplate:'<div class="ui-grid-cell-contents" ng-click="grid.appScope.viewStudent(row.entity)">{{row.entity.student_name}}</div>'},{name:"Class",field:"class_name",enableColumnMenu:!1,cellTemplate:'<div class="ui-grid-cell-contents"  ng-click="grid.appScope.viewInvoice(row.entity)">{{row.entity.class_name}}</div>'},{name:"Invoice Date",field:"inv_date",type:"date",cellFilter:"date",enableColumnMenu:!1,cellTemplate:'<div class="ui-grid-cell-contents"  ng-click="grid.appScope.viewInvoice(row.entity)">{{row.entity.inv_date|date}}</div>'},{name:n[0],field:"total_due",enableColumnMenu:!1,type:"number",cellTemplate:'<div class="ui-grid-cell-contents" ng-click="grid.appScope.viewInvoice(row.entity)">{{row.entity.total_due|currency:""}}</div>'},{name:n[1],field:"total_paid",enableColumnMenu:!1,type:"number",cellTemplate:'<div class="ui-grid-cell-contents" ng-click="grid.appScope.viewInvoice(row.entity)">{{row.entity.total_paid|currency:""}}</div>'},{name:n[2],field:"balance",enableColumnMenu:!1,type:"number",cellTemplate:'<div class="ui-grid-cell-contents" ng-click="grid.appScope.viewInvoice(row.entity)">{{row.entity.balance|numeric}}</div>'},{name:"Due Date",field:"due_date",type:"date",enableColumnMenu:!1,cellFilter:"date",cellTemplate:'<div class="ui-grid-cell-contents" ng-click="grid.appScope.viewInvoice(row.entity)">{{row.entity.due_date|date}}</div>'},{name:"Days Over Due",field:"days_overdue",enableColumnMenu:!1,sort:{direction:"desc",priority:1},cellTemplate:'<div class="ui-grid-cell-contents" ng-click="grid.appScope.viewInvoice(row.entity)">{{row.entity.days_overdue}}</div>'}],exporterCsvFilename:"invoices.csv",onRegisterApi:function(b){a.gridApi=b,a.gridApi.grid.registerRowsProcessor(a.singleFilter,200),d(function(){a.gridApi.core.handleWindowResize()})}};var o=function(){if(void 0===b.allClasses?c.getAllClasses({},function(b){var c=angular.fromJson(b);"success"==c.response&&(a.classes=c.data)},function(){}):a.classes=b.allClasses,void 0===b.terms){var d=moment().format("YYYY");c.getTerms(d,function(c){var d=angular.fromJson(c);"success"==d.response&&(a.terms=d.data,b.terms=d.data,b.setTermRanges(d.data))},function(){})}else a.terms=b.terms,b.setTermRanges(a.terms);setTimeout(function(){var b=$(".full-height.datagrid").height();$("#grid1").css("height",b),a.gridApi.core.handleWindowResize()},100),p("true",a.filterBalStatus)};d(o,1);var p=function(b,d){a.gridOptions.data=[];var e=angular.copy(a.filters),f=moment(e.date.startDate).format("YYYY-MM-DD")+"/"+moment(e.date.endDate).format("YYYY-MM-DD")+"/false/"+b;c.getInvoices(f,function(b,c,e){var f=angular.fromJson(b);if("success"==f.response){if(void 0!==f.nodata)a.invoices=[];else{k=e.filters.date;var g=f.data;e.filters.status===!1?(a.formerStudents=g,a.invoices=s(g,e.filters)):(a.allStudents=g,a.invoices=d?s(g,e.filters):g)}r(a.invoices)}else a.error=!0,a.errMsg=f.data},function(){},{filters:e})};a.getInvoice=function(d){c.getStudentDetails(d.student_id,function(c){var e=angular.fromJson(c);if("success"==e.response){var f=b.formatStudentData([e.data]),g=b.allClasses.filter(function(a){return a.class_id==f[0].class_id?a:void 0});f[0].current_class=g[0],a.student=f[0];var h={student:a.student,invoice:d};a.openModal("fees","invoice","md",h)}})};var q=function(){a.totals.total_due=a.invoices.reduce(function(a,b){return a=parseInt(a)+parseInt(b.total_due)},0),a.totals.total_paid=a.invoices.reduce(function(a,b){return a=parseInt(a)+parseInt(b.total_paid)},0),a.totals.total_balance=a.invoices.reduce(function(a,b){return a=parseInt(a)+parseInt(b.balance)},0)},r=function(c){a.invoices.length>0&&q(),a.gridOptions.data=c,a.loading=!1,b.loading=!1};a.filterDataTable=function(){a.gridApi.grid.refresh()},a.clearFilterDataTable=function(){a.gridFilter.filterValue="",a.gridApi.grid.refresh()},a.singleFilter=function(b){var c=new RegExp(a.gridFilter.filterValue,"i");return b.forEach(function(a){var b=!1;["student_name","class_name","inv_date"].forEach(function(d){a.entity[d].match(c)&&(b=!0)}),b||(a.visible=!1)}),b},a.$watch("filters.class_cat_id",function(c,d){d!=c&&(void 0===c||""==c?a.classes=b.allClasses:a.classes=b.allClasses.reduce(function(a,b){return b.class_cat_id==c&&a.push(b),a},[]))}),a.$watch("filters.date",function(a,b){a!=b&&(l=a!==k)}),a.toggleFilter=function(){a.filterShowing=!a.filterShowing,a.filterShowing||a.toolsShowing?$("#resultsTable_filter").hide():d(function(){$("#resultsTable_filter").show()},500)},a.toggleTools=function(){a.toolsShowing=!a.toolsShowing,a.filterShowing||a.toolsShowing?$("#resultsTable_filter").hide():d(function(){$("#resultsTable_filter").show()},500)},a.loadFilter=function(){a.loading=!0,h=!0,"false"==a.filters.status&&void 0===a.formerStudents?p("false",!0):l?p(g,!0):(a.invoices=s("false"==a.filters.status?a.formerStudents:a.allStudents,a.filters),r(a.invoices)),g=a.filters.status};var s=function(a,b){if(void 0!==b.class_cat_id&&null!==b.class_cat_id&&""!==b.class_cat_id&&(a=a.reduce(function(a,c){return c.class_cat_id.toString()==b.class_cat_id.toString()&&a.push(c),a},[])),void 0!==b.class_id&&null!==b.class_id&&""!==b.class_id&&(a=a.reduce(function(a,c){return c.class_id.toString()==b.class_id.toString()&&a.push(c),a},[])),void 0!==b.balance_status&&null!==b.balance_status&&""!==b.balance_status)switch(b.balance_status){case"Balance Owing":a=a.reduce(function(a,b){return b.balance<0&&a.push(b),a},[]);break;case"Paid in Full":a=a.reduce(function(a,b){return b.balance>=0&&a.push(b),a},[]);break;case"Due This Month":var c=moment().startOf("month").format("YYYY-MM-DD"),d=moment().endOf("month").format("YYYY-MM-DD");a=a.reduce(function(a,b){var e=moment(b.due_date).format("YYYY-MM-DD");return e>=c&&d>=e&&a.push(b),a},[]);break;case"Past Due":a=a.reduce(function(a,b){return b.days_overdue>0&&a.push(b),a},[])}return a};a.addInvoice=function(){a.openModal("fees","invoiceForm","lg",{})},a.generateInvoices=function(){a.openModal("fees","invoiceWizard","lg")},a.exportInvoices=function(){a.gridApi.exporter.csvExport("visible","visible")},a.viewStudent=function(b){a.openModal("students","viewStudent","lg",b)},a.viewInvoice=function(b){a.openModal("fees","invoiceDetails","md",b)},a.$on("refreshInvoices",function(c,e){a.loading=!0,b.loading=!0,void 0!==e&&(a.updated=!0,a.notificationMsg=e.msg),a.refresh(),d(function(){a.alert.expired=!0},2e3),d(function(){a.updated=!1,a.notificationMsg="",a.alert.expired=!1},3e3)}),a.refresh=function(){a.loading=!0,b.loading=!0,p(g,h)},a.$on("$destroy",function(){b.isModal=!1})}]),angular.module("eduwebApp").controller("openingBalancesCtrl",["$scope","$rootScope","apiService","$timeout","$window",function(a,b,c,d,e){a.filters={},a.filters.status="true",a.students=[],a.filterShowing=!1,a.toolsShowing=!1;var f=!0,g=!1;b.modalLoading=!1,a.alert=null,a.currency=b.currentUser.settings.Currency,a.totals={},a.loading=!0,a.gridFilter={},a.gridFilter.filterValue="",a.years=[];for(var h=moment().format("YYYY"),i=void 0!==b.currentUser.settings["Initial Year"]?b.currentUser.settings["Initial Year"]:"2014",j=i;h>=j;j++)a.years.push(j);a.filters.year=h;var k=h,l=!1,m=function(){return'<div class="clickable" ng-class="{\'alert-danger\': row.entity.days_overdue > 0}" ng-click="grid.appScope.viewStudent(row.entity)">  <div ng-if="row.entity.merge">{{row.entity.title}}</div>  <div ng-if="!row.entity.merge" ng-repeat="(colRenderIndex, col) in colContainer.renderedColumns track by col.colDef.name" class="ui-grid-cell" ng-class="{ \'ui-grid-row-header-cell\': col.isRowHeader }"  ui-grid-cell></div></div>'},n=["Opening Balance ( "+a.currency+" )","Payments Received ( "+a.currency+" )","Balance ( "+a.currency+" )"];a.gridOptions={enableSorting:!0,rowTemplate:m(),rowHeight:24,columnDefs:[{name:"Name",field:"student_name",enableColumnMenu:!1},{name:"Class",field:"class_name",enableColumnMenu:!1},{name:n[0],field:"total_due",enableColumnMenu:!1,type:"number",cellTemplate:'<div class="ui-grid-cell-contents">{{row.entity.total_due|currency:""}}</div>'},{name:n[1],field:"total_paid",enableColumnMenu:!1,type:"number",cellTemplate:'<div class="ui-grid-cell-contents">{{row.entity.total_paid|currency:""}}</div>'},{name:n[2],field:"balance",enableColumnMenu:!1,type:"number",sort:{direction:"asc",priority:1},cellTemplate:'<div class="ui-grid-cell-contents">{{row.entity.balance|numeric}}</div>'},{name:"Last Payment",field:"last_payment",enableColumnMenu:!1},{name:"Next Payment Due",field:"next_payment",enableColumnMenu:!1}],exporterCsvFilename:"opening-balances.csv",onRegisterApi:function(b){a.gridApi=b,a.gridApi.grid.registerRowsProcessor(a.singleFilter,200),d(function(){a.gridApi.core.handleWindowResize()})}};var o=function(){void 0===b.allClasses?c.getAllClasses({},function(b){var c=angular.fromJson(b);"success"==c.response&&(a.classes=c.data)},function(){}):a.classes=b.allClasses,setTimeout(function(){var b=$(".full-height.datagrid").height();$("#grid1").css("height",b),a.gridApi.core.handleWindowResize()},100),p("true",!1)};d(o,1);var p=function(b,d){var e=angular.copy(a.filters.year),f=e+"/"+b;c.getStudentBalances(f,function(b,c,e){var f=angular.fromJson(b);if("success"==f.response){if(void 0!==f.nodata)a.students=[];else{k=e.year;var g=f.data;d?(a.formerStudents=g,s()):(a.allStudents=g,a.students=g)}r(a.students)}else a.error=!0,a.errMsg=f.data},function(){},{year:e})},q=function(){a.totals.total_due=a.students.reduce(function(a,b){return a+=parseFloat(b.total_due)},0),a.totals.total_paid=a.students.reduce(function(a,b){return a+=parseFloat(b.total_paid)},0),a.totals.total_balance=a.students.reduce(function(a,b){return a+=parseFloat(b.balance)},0)},r=function(c){q(),a.gridOptions.data=c,a.loading=!1,b.loading=!1};a.filterDataTable=function(){a.gridApi.grid.refresh()},a.clearFilterDataTable=function(){a.gridFilter.filterValue="",a.gridApi.grid.refresh()},a.singleFilter=function(b){var c=new RegExp(a.gridFilter.filterValue,"i");return b.forEach(function(a){var b=!1;["student_name","class_name"].forEach(function(d){a.entity[d].match(c)&&(b=!0)}),b||(a.visible=!1)}),b},a.$watch("filters.class_cat_id",function(c,d){d!=c&&(void 0===c||""==c?a.classes=b.allClasses:a.classes=b.allClasses.reduce(function(a,b){return b.class_cat_id==c&&a.push(b),a},[]))}),a.$watch("filters.year",function(a,b){a!=b&&(l=a!==k)}),a.toggleFilter=function(){a.filterShowing=!a.filterShowing,a.filterShowing||a.toolsShowing?$("#resultsTable_filter").hide():d(function(){$("#resultsTable_filter").show()},500)},a.toggleTools=function(){a.toolsShowing=!a.toolsShowing,a.filterShowing||a.toolsShowing?$("#resultsTable_filter").hide():d(function(){$("#resultsTable_filter").show()},500)},a.loadFilter=function(){a.loading=!0,g=!0,"false"==a.filters.status&&void 0===a.formerStudents?p("false",!0):l?p(f,!0):s(),f=a.filters.status};var s=function(){var b="false"==a.filters.status?a.formerStudents:a.allStudents;void 0!==a.filters.class_cat_id&&null!==a.filters.class_cat_id&&""!==a.filters.class_cat_id&&(b=b.reduce(function(b,c){return c.class_cat_id.toString()==a.filters.class_cat_id.toString()&&b.push(c),b},[])),void 0!==a.filters.class_id&&null!==a.filters.class_id&&""!==a.filters.class_id&&(b=b.reduce(function(b,c){return c.class_id.toString()==a.filters.class_id.toString()&&b.push(c),b},[])),a.students=b,r(a.students)};a.addPayment=function(){a.openModal("fees","paymentForm","lg",{})},a.adjustPayment=function(){a.openModal("fees","editPaymentForm","lg",{})},a.viewStudent=function(b){a.openModal("students","viewStudent","lg",b)},a.exportBalances=function(){a.gridApi.exporter.csvExport("visible","visible")},a.$on("refreshBalances",function(c,e){a.loading=!0,b.loading=!0,void 0!==e&&(a.updated=!0,a.notificationMsg=e.msg),a.refresh(),d(function(){a.alert.expired=!0},2e3),d(function(){a.updated=!1,a.notificationMsg="",a.alert.expired=!1},3e3)}),a.refresh=function(){a.loading=!0,b.loading=!0,p(f,g)},a.$on("$destroy",function(){b.isModal=!1})}]),angular.module("eduwebApp").controller("paymentDetailsCtrl",["$scope","$rootScope","$uibModalInstance","apiService","dialogs","data","$filter",function(a,b,c,d,e,f,g){a.edit=void 0!==a.permissions.fees.payments_received.edit?a.permissions.fees.payments_received.edit:!1,a.makeSelection=void 0===f.payment_id,a.student={},a.payment={},a.selectedPayment=f||void 0,a.editPayment="Credit"!=a.selectedPayment.payment_method&&!f.noEdit,a.dates={},a.dates.payment_date={startDate:a.selectedPayment.payment_date},a.currency=b.currentUser.settings.Currency,a.invoiceSelection=[],a.feeItemsSelection=[],a.feeItemsSelection2=[],a.apply_to_all=[],a.notice=void 0!==f.message,a.message=f.message,a.dateSelect={startDate:b.termRange.previous.start_date||b.termRange.current.start_date,endDate:b.termRange.next.end_date||b.termRange.current.end_date};var h=function(){var c=b.currentUser.settings["Payment Methods"];a.paymentMethods=c.split(","),a.paymentMethods.push("Credit"),void 0!==a.selectedPayment.payment_id?(a.student_name=angular.copy(a.selectedPayment.student_name),a.student_id=angular.copy(a.selectedPayment.student_id),d.getPaymentDetails(a.selectedPayment.payment_id,j,q),a.getStudentBalance()):d.getAllStudents(!0,function(c){var d=angular.fromJson(c);"success"==d.response?a.students=d.nodata?{}:b.formatStudentData(d.data):(a.error=!0,a.errMsg=d.data)},function(){})};setTimeout(h,1),a.cancel=function(){c.dismiss("canceled")},a.clearSelect=function(b,c){c.stopPropagation();var b=$parse(b+".selected");b.assign(a,void 0)},a.$watch("student.selected",function(b,c){b!=c&&(a.selectedStudent=a.student.selected,a.student_name=angular.copy(a.student.selected.student_name),a.student_id=angular.copy(a.student.selected.student_id),d.getStudentPayments(a.student_id,i,q),a.selectedPayment=void 0)}),a.$watch("payment.selected",function(b,c){b!=c&&(a.selectedPayment=a.payment.selected,d.getPaymentDetails(a.selectedPayment.payment_id,j,q),a.getStudentBalance())}),a.$watch("selectedPayment.amount",function(b,c){b!=c&&(a.totalCredit=b-a.totalApplied>0?b-a.totalApplied:0)}),a.$watch("selectedPayment.replacement_payment",function(a,b){a!=b&&a&&k()}),a.$watch("selectedPayment.invoice",function(b,c){b!=c&&(a.selectedNewInvoice=b)}),a.getStudentBalance=function(){var b=a.student_id;d.getStudentBalance(b,n,q)};var i=function(b,c){var d=angular.fromJson(b);"success"==d.response?a.payments=d.nodata?[]:angular.copy(d.data):(a.error=!0,a.errMsg=d.data)},j=function(b,c){var e=angular.fromJson(b);if("success"==e.response){var f=e.nodata?{}:e.data;a.selectedPayment=f.payment,a.isCredit=null!==a.selectedPayment.credit_id,a.selectedInvoice=f.invoice.length>0?m(f.invoice):void 0,a.paymentItems=f.paymentItems,d.getOpenInvoices(a.student_id,l,q),void 0!==a.selectedInvoice&&angular.forEach(a.selectedInvoice,function(b,c){angular.forEach(b.fee_items,function(b,c){angular.forEach(a.paymentItems,function(c,d){b.inv_item_id==c.inv_item_id&&(b.amount=c.line_item_amount,b.payment_inv_item_id=c.payment_inv_item_id,b.modifiable=!0,a.feeItemsSelection.push(b))})})}),a.selectedPayment.replacement_payment&&k(),a.sumPayment()}else a.error=!0,a.errMsg=e.data},k=function(){void 0===a.replaceableFeeItems&&d.getReplaceableFeeItems(a.student_id,function(b,c){var d=angular.fromJson(b);"success"==d.response&&(a.replaceableFeeItems=angular.copy(d.data),angular.forEach(a.replaceableFeeItems,function(b,c){angular.forEach(a.paymentItems,function(c,d){b.student_fee_item_id==c.inv_item_id&&(b.paying_amount=c.line_item_amount,
b.payment_replace_item_id=c.payment_inv_item_id,a.feeItemsSelection2.push(b))})}))},q)},l=function(b,c){a.loading=!1;var d=angular.fromJson(b);if("success"==d.response){var e=d.nodata?[]:m(angular.copy(d.data));a.invoices=e.filter(function(b){if(a.selectedInvoice)var c=a.selectedInvoice.filter(function(a){return b.inv_id==a.inv_id?a:void 0})[0];return void 0===c?b:void 0})}},m=function(a){var b={},c={},d=[],e=[],f=0;return angular.forEach(a,function(a,g){g>0&&b!=a.inv_id&&(d.push({inv_id:c.inv_id,inv_date:c.inv_date,due_date:c.due_date,balance:c.balance,overall_balance:f,total_due:c.total_due,fee_items:e}),e=[],f=0),e.push({fee_item_id:a.fee_item_id,fee_item:a.fee_item,balance:a.balance,inv_item_id:a.inv_item_id,inv_id:a.inv_id,payment_id:a.payment_id,amount:null,isPaid:0===parseInt(a.balance),modifiable:0!==parseInt(a.balance)}),f+=parseFloat(a.balance),b=a.inv_id,c=a}),d.push({inv_id:c.inv_id,inv_date:c.inv_date,due_date:c.due_date,balance:c.balance,overall_balance:f,total_due:c.total_due,fee_items:e}),d},n=function(b,c){a.loading=!1;var d=angular.fromJson(b);void 0!==a.dataGrid&&(a.dataGrid.clear(),a.dataGrid.destroy()),"success"==d.response&&(void 0===d.nodata?(a.feeSummary=angular.copy(d.data.fee_summary),a.fees=angular.copy(d.data.fees),a.nofeeSummary=!1):(a.feeSummary=[],a.fees=[],a.nofeeSummary=!0),setTimeout(o,50))},o=function(){var a={sortOrder:[4,"asc"],noResultsTxt:"This student has not been invoiced."};p(a)},p=function(c){var d=$("#resultsTable3");a.dataGrid=d.DataTable({responsive:{details:{type:"column"}},columnDefs:[{className:"control",orderable:!1,targets:0}],paging:!1,destroy:!0,order:c.sortOrder,filter:!1,info:!1,sorting:[],scrollY:"200px",initComplete:function(c,d){a.loading=!1,b.loading=!1,a.$apply()},language:{lengthMenu:"Display _MENU_",emptyTable:c.noResultsTxt}})};a.changeInvoice=function(b){a.changingInvoice=b,b||(a.selectedNewInvoice=void 0)},a.unapplyInvoice=function(){a.selectedPayment.inv_id=void 0,a.selectedInvoice=void 0,a.changeInvoice(!1)},a.viewStudent=function(b){var c=window.location.host,d=e.create("http://"+c+"/app/students/viewStudent.html","viewStudentCtrl",b,{size:"lg",backdrop:"static"});d.result.then(function(b){a.generateInvoice()},function(){a.generateInvoice()})};var q=function(b,c){var d=angular.fromJson(b);a.error=!0,a.errMsg=d.data};a.selectAllItems=function(b,c){a.apply_to_all[b]=!a.apply_to_all[b],a.apply_to_all[b]?angular.forEach(c.fee_items,function(b,c){b.amount=Math.abs(b.balance),a.totalApplied+=parseInt(b.amount),a.feeItemsSelection.push(b)}):angular.forEach(c.fee_items,function(b,c){b.amount=void 0,a.totalApplied=0,a.feeItemsSelection=[]}),a.totalCredit=a.selectedPayment.amount-a.totalApplied>0?a.selectedPayment.amount-a.totalApplied:0},a.toggleFeeItems=function(b){var c=a.feeItemsSelection.indexOf(b);c>-1?(a.totalApplied=a.totalApplied-b.amount,b.amount=void 0,a.feeItemsSelection.splice(c,1)):(b.amount=Math.abs(b.balance),a.totalApplied+=parseFloat(b.amount),a.feeItemsSelection.push(b)),a.totalCredit=a.selectedPayment.amount-a.totalApplied>0?a.selectedPayment.amount-a.totalApplied:0},a.toggleFeeItems2=function(b){var c=a.feeItemsSelection2.indexOf(b);c>-1?(b.paying_amount=void 0,a.feeItemsSelection2.splice(c,1)):(b.paying_amount=b.amount,a.feeItemsSelection2.push(b))},a.save=function(b){if(!b.$invalid){var c=a.feeItemsSelection.reduce(function(a,b){return a+=parseFloat(b.amount)},0);if(a.selectedPayment.replacement_payment!==!0)if(c>a.selectedPayment.amount)var d=e.error("Amount Inconsistency","<p>You have entered <strong>"+g("number")(c)+" Ksh</strong> towards fee items, however to total payment amount enterd was <strong>"+g("number")(a.selectedPayment.amount)+" Ksh</strong>.</p><p>Please correct, the total amount applied to fee items can not exceed the total payment amount.</p>",{size:"sm"});else if(c<a.selectedPayment.amount)if(a.isCredit)r();else{var d=e.confirm("Credit","<p>You have <strong>"+g("number")(a.selectedPayment.amount-c)+" Ksh</strong> that has not been applied to fee items, do you wish to add this as a credit?</p>",{size:"sm"});d.result.then(function(a){r()},function(a){})}else r();else r()}};var r=function(){if(a.error=!1,a.errMsg="",a.selectedPayment.replacement_payment){var b=[];angular.forEach(a.feeItemsSelection2,function(a,c){b.push({payment_replace_item_id:a.payment_replace_item_id,student_fee_item_id:a.student_fee_item_id,amount:a.paying_amount})});var c={user_id:a.currentUser.user_id,payment_id:a.selectedPayment.payment_id,student_id:a.student_id,payment_date:moment(a.dates.payment_date.startDate).format("YYYY-MM-DD"),amount:a.selectedPayment.amount,payment_method:a.selectedPayment.payment_method,slip_cheque_no:a.selectedPayment.slip_cheque_no,replacement_payment:a.selectedPayment.replacement_payment?"t":"f",inv_id:void 0!==a.selectedPayment.invoice?a.selectedPayment.invoice.inv_id:void 0!==a.selectedInvoice?a.selectedInvoice.inv_id:null,replacement_items:b}}else{var e=[];angular.forEach(a.feeItemsSelection,function(a,b){e.push({payment_inv_item_id:a.payment_inv_item_id,inv_item_id:a.inv_item_id,inv_id:a.inv_id,amount:a.amount})});var c={user_id:a.currentUser.user_id,payment_id:a.selectedPayment.payment_id,student_id:a.student_id,payment_date:moment(a.dates.payment_date.startDate).format("YYYY-MM-DD"),amount:a.selectedPayment.amount,payment_method:a.selectedPayment.payment_method,slip_cheque_no:a.selectedPayment.slip_cheque_no,replacement_payment:"true"==a.selectedPayment.replacement_payment?"t":"f",line_items:e,hasCredit:!!(a.totalCredit>0||a.isCredit),creditAmt:a.totalCredit,creditId:a.selectedPayment.credit_id||null}}d.updatePayment(c,s,q)};a.reversePayment=function(){var c=e.confirm("Reverse Payment","Are you sure you want to revers this payment?",{size:"sm"});c.result.then(function(c){var e={user_id:a.currentUser.user_id,payment_id:a.selectedPayment.payment_id};d.reversePayment(e,function(c){var d=angular.fromJson(c);"success"==d.response&&(a.selectedPayment.reversed=!0,b.$emit("paymentAdded",{msg:"Payment reversed.",clear:!0}))},q)})},a.reactivatePayment=function(){var c=e.confirm("Activate Payment","Are you sure you want to mark this payment as <strong>active</strong>?",{size:"sm"});c.result.then(function(c){var e={user_id:a.currentUser.user_id,student_id:a.student_id,payment_id:a.selectedPayment.payment_id,hasCredit:a.totalCredit>0,creditAmt:a.totalCredit};d.reactivatePayment(e,function(c){var d=angular.fromJson(c);"success"==d.response&&(a.selectedPayment.reversed=!1,b.$emit("paymentAdded",{msg:"Payment activated.",clear:!0}))},q)})},a.deletePayment=function(){var f=e.confirm("Delete Payment","Are you sure you want to <strong>DELETE</strong> this payment? (This CAN NOT be undone)",{size:"sm"});f.result.then(function(e){d.deletePayment(a.selectedPayment.payment_id,function(a){var d=angular.fromJson(a);"success"==d.response&&(b.$emit("paymentAdded",{msg:"Payment deleted.",clear:!0}),c.close())},q)})};var s=function(d,e){var f=angular.fromJson(d);"success"==f.response?(c.close(),b.$emit("paymentAdded",{msg:"Payment was added.",clear:!0})):(a.error=!0,a.errMsg=f.data)};a.sumPayment=function(){a.totalApplied=a.feeItemsSelection.reduce(function(a,b){return""==b.amount&&(b.amount=0),a+=parseFloat(b.amount)},0),a.totalCredit=a.selectedPayment.amount-a.totalApplied>0?a.selectedPayment.amount-a.totalApplied:0}}]),angular.module("eduwebApp").controller("paymentFormCtrl",["$scope","$rootScope","$uibModalInstance","apiService","dialogs","data","$filter","$parse",function(a,b,c,d,e,f,g,h){a.student={},a.selectedStudent=void 0!==f.selectedStudent?f.selectedStudent:void 0,a.showSelect=void 0===f.selectedStudent,a.student.selected=a.selectedStudent,a.payment={},a.payment.amount=0,a.payment.payment_date={startDate:moment().format("YYYY-MM-DD")},a.payment.replacement_payment=!1,a.currency=b.currentUser.settings.Currency,a.invoiceSelection=[],a.feeItemsSelection=[],a.feeItemsSelection2=[],a.apply_to_all=[],a.totalApplied=0,a.totalCredit=0;var i=function(){var c=b.currentUser.settings["Payment Methods"];a.paymentMethods=c.split(","),void 0===a.selectedStudent?d.getAllStudents(!0,function(c){var d=angular.fromJson(c);"success"==d.response?a.students=d.nodata?{}:b.formatStudentData(d.data):(a.error=!0,a.errMsg=d.data)},function(){}):(d.getOpenInvoices(a.selectedStudent.student_id,j,o),d.getStudentBalance(a.selectedStudent.student_id,l,o))};setTimeout(i,1),a.cancel=function(){c.dismiss("canceled")},a.clearSelect=function(b,c){c.stopPropagation();var b=h(b+".selected");b.assign(a,void 0)},a.$watch("student.selected",function(b,c){b!=c&&(a.selectedStudent=a.student.selected,d.getOpenInvoices(a.student.selected.student_id,j,o),d.getStudentBalance(a.student.selected.student_id,l,o))}),a.$watch("payment.replacement_payment",function(b,c){b!=c&&d.getReplaceableFeeItems(a.selectedStudent.student_id,function(b,c){var d=angular.fromJson(b);"success"==d.response&&(a.replaceableFeeItems=angular.copy(d.data))},o)}),a.selectAllItems=function(b,c){a.apply_to_all[b]=!a.apply_to_all[b],a.apply_to_all[b]?angular.forEach(c.fee_items,function(b,c){b.amount=Math.abs(b.balance),a.totalApplied+=parseInt(b.amount),a.feeItemsSelection.push(b)}):angular.forEach(c.fee_items,function(b,c){b.amount=void 0,a.totalApplied=0,a.feeItemsSelection=[]}),a.totalCredit=a.payment.amount-a.totalApplied>0?a.payment.amount-a.totalApplied:0},a.viewStudent=function(b){var c=window.location.host,d=e.create("http://"+c+"/app/students/viewStudent.html","viewStudentCtrl",b,{size:"lg",backdrop:"static"});d.result.then(function(b){a.generateInvoice()},function(){a.generateInvoice()})};var j=function(b,c){a.loading=!1;var d=angular.fromJson(b);"success"==d.response&&(a.invoices=k(angular.copy(d.data)))},k=function(a){var b={},c={},d=[],e=[],f=0;return angular.forEach(a,function(a,g){g>0&&b!=a.inv_id&&(d.push({inv_id:c.inv_id,inv_date:c.inv_date,due_date:c.due_date,balance:c.balance,overall_balance:f,total_due:c.total_due,fee_items:e}),e=[],f=0),e.push({fee_item_id:a.fee_item_id,fee_item:a.fee_item,balance:a.balance,inv_item_id:a.inv_item_id,inv_id:a.inv_id,payment_id:a.payment_id,amount:null,isPaid:0===parseInt(a.balance),modifiable:parseInt(a.balance)<0}),f+=parseFloat(a.balance),b=a.inv_id,c=a}),d.push({inv_id:c.inv_id,inv_date:c.inv_date,due_date:c.due_date,balance:c.balance,overall_balance:f,total_due:c.total_due,fee_items:e}),d},l=function(b,c){a.loading=!1;var d=angular.fromJson(b);void 0!==a.dataGrid&&(a.dataGrid.clear(),a.dataGrid.destroy()),"success"==d.response&&(void 0===d.nodata?(a.feeSummary=angular.copy(d.data.fee_summary),a.fees=angular.copy(d.data.fees),a.nofeeSummary=!1):(a.feeSummary=[],a.fees=[],a.nofeeSummary=!0),setTimeout(m,50))},m=function(){var a={sortOrder:[4,"asc"],noResultsTxt:"This student has not been invoiced."};n(a)},n=function(c){var d=$("#resultsTable2");a.dataGrid=d.DataTable({responsive:{details:{type:"column"}},columnDefs:[{className:"control",orderable:!1,targets:0}],paging:!1,destroy:!0,order:c.sortOrder,filter:!1,info:!1,sorting:[],scrollY:"200px",initComplete:function(c,d){a.loading=!1,b.loading=!1,a.$apply()},language:{lengthMenu:"Display _MENU_",emptyTable:c.noResultsTxt}})},o=function(b,c){var d=angular.fromJson(b);a.error=!0,a.errMsg=d.data};a.$watch("payment.amount",function(b,c){b!=c&&(a.totalCredit=b-a.totalApplied>0?b-a.totalApplied:0)}),a.$watch("payment.invoice",function(b,c){b!=c&&(a.selectedInvoice=b)}),a.toggleFeeItems=function(b){var c=a.feeItemsSelection.indexOf(b);c>-1?(a.totalApplied=a.totalApplied-b.amount,b.amount=void 0,a.feeItemsSelection.splice(c,1)):(b.amount=Math.abs(b.balance),a.totalApplied+=parseFloat(b.amount),a.feeItemsSelection.push(b)),a.totalCredit=a.payment.amount-a.totalApplied>0?a.payment.amount-a.totalApplied:0},a.toggleFeeItems2=function(b){var c=a.feeItemsSelection2.indexOf(b);c>-1?(b.paying_amount=void 0,a.feeItemsSelection2.splice(c,1)):(b.paying_amount=b.amount,a.feeItemsSelection2.push(b))},a.save=function(b){if(!b.$invalid){a.saveCredit=!1;var c=a.feeItemsSelection.reduce(function(a,b){return a+=parseFloat(b.amount)},0);if(a.payment.replacement_payment!==!0)if(c>a.payment.amount)var d=e.error("Amount Inconsistency","<p>You have entered <strong>"+g("number")(c)+" Ksh</strong> towards fee items, however to total payment amount entered was <strong>"+g("number")(a.payment.amount)+" Ksh</strong>.</p><p>Please correct, the total amount applied to fee items can not exceed the total payment amount.</p>",{size:"sm"});else if(c<a.payment.amount){a.creditAmt=a.payment.amount-c;var d=e.confirm("Adding Credit","<p>You have <strong>"+g("number")(a.creditAmt)+" Ksh</strong> that has not been applied to fee items, do you wish to add this as a credit?</p>",{size:"sm"});d.result.then(function(b){a.saveCredit=!0,p()},function(b){a.saveCredit=!1})}else p();else p()}};var p=function(){if(a.error=!1,a.errMsg="",a.payment.replacement_payment){var b=[];angular.forEach(a.feeItemsSelection2,function(a,c){b.push({student_fee_item_id:a.student_fee_item_id,amount:a.paying_amount})});var c={user_id:a.currentUser.user_id,student_id:a.selectedStudent.student_id,payment_date:moment(a.payment.payment_date.startDate).format("YYYY-MM-DD"),amount:a.payment.amount,payment_method:a.payment.payment_method,slip_cheque_no:a.payment.slip_cheque_no,replacement_payment:a.payment.replacement_payment?"t":"f",inv_id:void 0!==a.payment.invoice?a.payment.invoice.inv_id:null,replacement_items:b,hasCredit:a.saveCredit,creditAmt:a.creditAmt}}else{var e=[];angular.forEach(a.feeItemsSelection,function(a,b){e.push({inv_item_id:a.inv_item_id,inv_id:a.inv_id,amount:a.amount})});var c={user_id:a.currentUser.user_id,student_id:a.selectedStudent.student_id,payment_date:moment(a.payment.payment_date.startDate).format("YYYY-MM-DD"),amount:a.payment.amount,payment_method:a.payment.payment_method,slip_cheque_no:a.payment.slip_cheque_no,replacement_payment:"true"==a.payment.replacement_payment?"t":"f",line_items:e,hasCredit:a.saveCredit,creditAmt:a.creditAmt}}d.addPayment(c,q,o)},q=function(d,e){var f=angular.fromJson(d);"success"==f.response?(c.close(),b.$emit("paymentAdded",{msg:"Payment was added.",clear:!0})):(a.error=!0,a.errMsg=f.data)};a.sumPayment=function(){a.totalApplied=a.feeItemsSelection.reduce(function(a,b){return""==b.amount&&(b.amount=0),a+=parseFloat(b.amount)},0),a.totalCredit=a.payment.amount-a.totalApplied>0?a.payment.amount-a.totalApplied:0}}]),angular.module("eduwebApp").controller("paymentsReceivedCtrl",["$scope","$rootScope","apiService","$timeout","$window",function(a,b,c,d,e){a.filters={},a.filters.status="true",a.filterShowing=!1,a.toolsShowing=!1;var f=!1;b.modalLoading=!1,a.alert={},a.currency=b.currentUser.settings.Currency,a.totals={},a.paymentStatuses=[{value:"false",label:"Good"},{value:"true",label:"Reversed"}],a.filters.payment_status="false",a.loading=!0,a.gridFilter={},a.gridFilter.filterValue="";var g=moment().format("YYYY-01-01"),h=moment().format("YYYY-MM-DD");a.date={startDate:g,endDate:h};var i=angular.copy(a.date),j=!1;a.filters.date=a.date;var k=function(){return'<div class="clickable" ng-class="{\'alert-warning\': row.entity.replacement_payment}">	 <div ng-if="row.entity.merge">{{row.entity.title}}</div>	 <div ng-if="!row.entity.merge" ng-repeat="(colRenderIndex, col) in colContainer.renderedColumns track by col.colDef.name" class="ui-grid-cell" ng-class="{ \'ui-grid-row-header-cell\': col.isRowHeader }"	 ui-grid-cell></div></div>'},l=["Amount ( "+a.currency+" )"];a.gridOptions={enableSorting:!0,rowTemplate:k(),rowHeight:34,columnDefs:[{name:"Receipt",field:"payment_id",headerCellClass:"center",cellClass:"center",enableColumnMenu:!1,width:60,cellTemplate:'<div class="ui-grid-cell-contents" ng-click="grid.appScope.getReceipt(row.entity)"><i class="glyphicon glyphicon-file"></i><br>{{row.entity.receipt_number}}</div>'},{name:"Name",field:"student_name",enableColumnMenu:!1,width:150,cellTemplate:'<div class="ui-grid-cell-contents" ng-click="grid.appScope.viewStudent(row.entity)">{{row.entity.student_name}}</div>'},{name:"Class",field:"class_name",enableColumnMenu:!1,cellTemplate:'<div class="ui-grid-cell-contents" ng-click="grid.appScope.viewPayment(row.entity)">{{row.entity.class_name}}</div>'},{name:"Payment Date",field:"payment_date",enableColumnMenu:!1,type:"date",sort:{direction:"desc"},cellTemplate:'<div class="ui-grid-cell-contents" ng-click="grid.appScope.viewPayment(row.entity)">{{row.entity.payment_date|date}}</div>'},{name:"Payment Method",field:"payment_method",enableColumnMenu:!1,cellTemplate:'<div class="ui-grid-cell-contents" ng-click="grid.appScope.viewPayment(row.entity)">{{row.entity.payment_method}}</div>'},{name:l[0],field:"amount",enableColumnMenu:!1,type:"number",headerCellClass:"center",cellClass:"center",cellTemplate:'<div class="ui-grid-cell-contents" ng-click="grid.appScope.viewPayment(row.entity)">{{row.entity.amount|currency:""}}</div>'},{name:"Applied To",field:"applied_to",enableColumnMenu:!1,width:200,cellTemplate:'<div class="ui-grid-cell-contents" ng-click="grid.appScope.viewPayment(row.entity)">{{row.entity.applied_to|arrayToList}}</div>'},{name:"Amount Unapplied",field:"unapplied_amount",enableColumnMenu:!1,headerCellClass:"center",cellClass:"center",cellTemplate:'<div class="ui-grid-cell-contents" ng-click="grid.appScope.viewPayment(row.entity)" ng-class="{\'alert-danger\': row.entity.unapplied_amount>0}">{{row.entity.unapplied_amount|currency:""}}</div>'},{name:"Replacement?",field:"replacement",headerCellClass:"center",cellClass:"center",enableColumnMenu:!1,cellTemplate:'<div class="ui-grid-cell-contents" ng-click="grid.appScope.viewPayment(row.entity)">{{row.entity.replacement}}</div>'},{name:"Reversed?",field:"reverse",headerCellClass:"center",cellClass:"center",enableColumnMenu:!1,cellTemplate:'<div class="ui-grid-cell-contents" ng-click="grid.appScope.viewPayment(row.entity)">{{row.entity.reverse}}</div>'}],exporterCsvFilename:"payments-received.csv",onRegisterApi:function(b){a.gridApi=b,a.gridApi.grid.registerRowsProcessor(a.singleFilter,200),d(function(){a.gridApi.core.handleWindowResize()})}};var m=function(){if(void 0===b.allClasses?c.getAllClasses({},function(b){var c=angular.fromJson(b);"success"==c.response&&(a.classes=c.data)},function(){}):a.classes=b.allClasses,void 0===b.terms){var d=moment().format("YYYY");c.getTerms(d,function(c){var d=angular.fromJson(c);"success"==d.response&&(a.terms=d.data,b.terms=d.data,b.setTermRanges(d.data))},function(){})}else a.terms=b.terms,b.setTermRanges(a.terms);void 0===b.termRange&&c.getTermRange({},function(a){var c=angular.fromJson(a);"success"==c.response&&(b.termRange=c.data)},apiError),setTimeout(function(){var b=$(".full-height.datagrid").height();$("#grid1").css("height",b),a.gridApi.core.handleWindowResize()},100),n(!1)};d(m,1);var n=function(d){var e=angular.copy(a.filters),f=moment(e.date.startDate).format("YYYY-MM-DD")+"/"+moment(e.date.endDate).format("YYYY-MM-DD")+"/"+e.payment_status;""!=status&&(f+="/"+e.status),c.getPaymentsReceived(f,function(c,e,f){var g=angular.fromJson(c);if("success"==g.response){if(void 0!==g.nodata)a.payments=[];else{i=f.filters.date;var h=g.data;"true"==f.filters.payment_status?(a.reversedPayments=h,a.payments=q(h,f.filters)):(a.allPayments=h,a.payments=d?q(h,f.filters):h),a.payments=h.map(function(a){return a.replacement=a.replacement_payment?"Yes":"No",a.reverse=a.reversed?"Yes":"No",a.receipt_number=b.zeroPad(a.payment_id,5),a})}p(a.payments)}else a.error=!0,a.errMsg=g.data},function(){},{filters:e})},o=function(){a.totals.total_paid=a.payments.reduce(function(a,b){return a+=parseFloat(b.amount)},0)},p=function(c){a.payments.length>0&&o(),a.gridOptions.data=c,a.loading=!1,b.loading=!1};a.filterDataTable=function(){a.gridApi.grid.refresh()},a.clearFilterDataTable=function(){a.gridFilter.filterValue="",a.gridApi.grid.refresh()},a.singleFilter=function(b){var c=new RegExp(a.gridFilter.filterValue,"i");return b.forEach(function(a){var b=!1;["student_name","class_name","payment_date","payment_method","receipt_number"].forEach(function(d){a.entity[d].match(c)&&(b=!0)}),b||(a.visible=!1)}),b},a.$watch("filters.class_cat_id",function(c,d){d!=c&&(void 0===c||""==c?a.classes=b.allClasses:a.classes=b.allClasses.reduce(function(a,b){return b.class_cat_id==c&&a.push(b),a},[]))}),a.$watch("filters.date",function(a,b){a!=b&&(j=a!==i)}),a.toggleFilter=function(){a.filterShowing=!a.filterShowing,a.filterShowing||a.toolsShowing?$("#resultsTable_filter").hide():d(function(){$("#resultsTable_filter").show()},500)},a.toggleTools=function(){a.toolsShowing=!a.toolsShowing,a.filterShowing||a.toolsShowing?$("#resultsTable_filter").hide():d(function(){$("#resultsTable_filter").show()},500)},a.loadFilter=function(){a.loading=!0,f=!0,"true"==a.filters.payment_status&&void 0===a.reversedPayments?n(!0):j?n(!0):(a.payments=q("true"==a.filters.payment_status?a.reversedPayments:a.allPayments,a.filters),p(a.payments))};var q=function(a,b){return void 0!==b.class_cat_id&&null!==b.class_cat_id&&""!==b.class_cat_id&&(a=a.reduce(function(a,c){return c.class_cat_id.toString()==b.class_cat_id.toString()&&a.push(c),a},[])),void 0!==b.class_id&&null!==b.class_id&&""!==b.class_id&&(a=a.reduce(function(a,c){return c.class_id.toString()==b.class_id.toString()&&a.push(c),a},[])),void 0!==b.status&&null!==b.status&&""!==b.status&&(a=a.reduce(function(a,c){return c.status.toString()==b.status.toString()&&a.push(c),a},[])),a};a.addPayment=function(){a.openModal("fees","paymentForm","lg",{})},a.adjustPayment=function(){a.openModal("fees","adjustPaymentForm","lg",{})},a.exportPayments=function(){a.gridApi.exporter.csvExport("visible","visible")},a.viewStudent=function(b){a.openModal("students","viewStudent","lg",b)},a.viewPayment=function(b){a.openModal("fees","paymentDetails","lg",b)},a.adjustPayment=function(){a.openModal("fees","paymentDetails","lg",{})},a.getReceipt=function(d){c.getStudentDetails(d.student_id,function(e){var f=angular.fromJson(e);if("success"==f.response){var g=b.formatStudentData([f.data]),h=b.allClasses.filter(function(a){return a.class_id==g[0].class_id?a:void 0});g[0].current_class=h[0],a.student=g[0],c.getFeeItems(!0,function(b){var c=angular.fromJson(b);if("success"==c.response){a.feeItems=r(c.data.required_items),a.feeItems=s(a.feeItems),a.optFeeItems=r(c.data.optional_items),a.optFeeItems=s(a.optFeeItems);var e={student:a.student,payment:d,feeItems:a.feeItems.concat(a.optFeeItems)};a.openModal("fees","receipt","md",e)}},function(){})}})};var r=function(a){return a.map(function(a){if(null!==a.class_cats_restriction&&"{}"!=a.class_cats_restriction){var b=a.class_cats_restriction.slice(1,-1);a.class_cats_restriction=b.split(",")}return a.amount=void 0,a.payment_method=void 0,a})},s=function(b){var c=[];return c=a.student.new_student?b:b.filter(function(a){return a.new_student_only?void 0:a}),void 0!==a.student.current_class&&(c=c.filter(function(b){return null===b.class_cats_restriction||"{}"==b.class_cats_restriction?b:b.class_cats_restriction.indexOf(a.student.current_class.class_cat_id.toString())>-1?b:void 0})),c};a.$on("refreshPayments",function(c,e){a.loading=!0,b.loading=!0,void 0!==e&&(a.updated=!0,a.notificationMsg=e.msg),a.refresh(),d(function(){a.alert.expired=!0},2e3),d(function(){a.updated=!1,a.notificationMsg="",a.alert.expired=!1},3e3)}),a.refresh=function(){a.loading=!0,b.loading=!0,n(f)},a.$on("$destroy",function(){b.isModal=!1})}]),angular.module("eduwebApp").controller("printInvoiceCtrl",["$scope","$rootScope",function(a,b){var c=function(){var c=window.printCriteria;a.student=angular.fromJson(c.student),a.invoice=angular.fromJson(c.invoice),a.lineItems=angular.fromJson(c.lineItems),a.invoiceLineItems=angular.fromJson(c.invoiceLineItems),a.totalAmtKsh=c.totals.totalAmtKsh,a.totalAmtCts=c.totals.totalAmtCts,a.loading=!1,setTimeout(function(){window.print(),setTimeout(function(){b.isPrinting=!1,window.close()},100)},100)};setTimeout(c,1),a.$on("$destroy",function(){b.isPrinting=!1})}]),angular.module("eduwebApp").controller("printReceiptCtrl",["$scope","$rootScope",function(a,b){var c=function(){var c=window.printCriteria;a.student=angular.fromJson(c.student),a.payment=angular.fromJson(c.payment),a.feeItems=angular.fromJson(c.feeItems),a.paymentItems=angular.fromJson(c.paymentItems),a.totalAmtKsh=c.totals.totalAmtKsh,a.totalAmtCts=c.totals.totalAmtCts,a.balanceDue=c.totals.balanceDue,a.term_name=c.termName,a.term_year=c.termYear,a.loading=!1,setTimeout(function(){window.print(),setTimeout(function(){b.isPrinting=!1,window.close()},100)},100)};setTimeout(c,1),a.$on("$destroy",function(){b.isPrinting=!1})}]),angular.module("eduwebApp").controller("printStatementCtrl",["$scope","$rootScope","apiService",function(a,b,c){var d=function(){var c=window.printCriteria;a.student=angular.fromJson(c.student),b.getCurrentTerm(),void 0===a.invoices?e():(a.invoices=angular.fromJson(c.invoices),g()),void 0===a.payments?h():(a.payments=angular.fromJson(c.payments),j()),void 0===a.credits?k():(a.credits=angular.fromJson(c.credits),m()),a.currency=b.currentUser.settings.Currency,a.todays_date=moment().format("YYYY-MM-DD")};setTimeout(d,1);var e=function(){c.getStudentInvoices(a.student.student_id,f,n)},f=function(b,c){a.loading=!1;var d=angular.fromJson(b);"success"==d.response&&(a.invoices=d.nodata?{}:angular.copy(d.data),g())},g=function(){a.invoices=a.invoices.filter(function(a){return a.canceled?void 0:a}),a.totalAmt=a.invoices.reduce(function(a,b){return a+=parseFloat(b.total_due)},0),a.totalPaid=a.invoices.reduce(function(a,b){return a+=parseFloat(b.total_paid)},0),a.totalBalance=a.invoices.reduce(function(a,b){return a+=parseFloat(b.balance)},0)},h=function(){c.getStudentPayments(a.student.student_id,i,n)},i=function(c,d){a.loading=!1;var e=angular.fromJson(c);if("success"==e.response){var f=e.nodata?[]:angular.copy(e.data);a.payments=f.map(function(a){return a.replacement=a.replacement_payment?"Yes":"No",a.reverse=a.reversed?"Yes":"No",a.receipt_number=b.zeroPad(a.payment_id,5),a}),j()}},j=function(){a.totalPayments=a.payments.reduce(function(a,b){return"Credit"!=b.payment_method&&(a+=parseFloat(b.amount)),a},0),a.grandTotalBalance=a.totalAmt-a.totalPayments,setTimeout(function(){window.print(),setTimeout(function(){b.isPrinting=!1,window.close()},100)},500)},k=function(){c.getStudentCredits(a.student.student_id,l,n)},l=function(b,c){a.loading=!1;var d=angular.fromJson(b);if("success"==d.response){var e=d.nodata?[]:angular.copy(d.data);a.credits=e.filter(function(a){return parseFloat(a.amount)>0?a:void 0}),m()}},m=function(){a.totalCredits=a.credits.reduce(function(a,b){return a+=parseFloat(b.amount)},0),a.hasCredit=a.totalCredits>0},n=function(b,c){var d=angular.fromJson(b);a.error=!0,a.errMsg=d.data}}]),angular.module("eduwebApp").controller("receiptCtrl",["$scope","$rootScope","$uibModalInstance","apiService","data",function(a,b,c,d,e){a.payment=e.payment,a.student=e.student,a.feeItems=e.feeItems;var f=function(){d.getStudentBalance(a.student.student_id,function(b,c){a.loading=!1;var e=angular.fromJson(b);"success"==e.response&&void 0===e.nodata&&(a.feeSummary=angular.copy(e.data.fee_summary)),d.getPaymentDetails(a.payment.payment_id,g,h)},h)};setTimeout(f,1),a.cancel=function(){c.dismiss("canceled")};var g=function(b,c){var d=angular.fromJson(b);if("success"==d.response){var e=d.nodata?{}:d.data;a.paymentDetails=e.paymentItems;var f=e.invoice;if(f.length>0){var g=f[0].term_name;g=g.split(" "),a.term_name=f.length>0?g[1]:"",a.term_year=f.length>0?f[0].term_year:""}if(a.paymentItems=[],a.paymentDetails.length>0){var h,i=0;angular.forEach(a.paymentDetails,function(b,c){h=b.line_item_amount.split("."),a.paymentItems.push({inv_id:b.inv_id,fee_item:b.fee_item,ksh:h[0],cts:h[1]}),i+=parseFloat(b.line_item_amount)});var h=String(i).indexOf(".")>-1?String(i).split("."):[i,"00"];a.totalAmtKsh=h[0],a.totalAmtCts=h[1]}else{var h=a.payment.amount.split(".");a.paymentItems.push({inv_id:"-",fee_item:"Credit",ksh:h[0],cts:h[1]})}a.feeSummary&&(a.balanceDue=a.feeSummary.balance,parseFloat(a.feeSummary.total_credit)>0&&(a.hasCredit=!0,a.credit=parseFloat(a.feeSummary.total_credit)))}else a.error=!0,a.errMsg=d.data};a.print=function(){var b={student:a.student,payment:a.payment,paymentItems:a.paymentItems,termName:a.term_name,termYear:a.term_year,totals:{totalAmtKsh:a.totalAmtKsh,totalAmtCts:a.totalAmtCts,balanceDue:a.balanceDue},feeItems:a.feeItems},c=window.location.host,d=window.open("http://"+c+"/#/fees/receipt/print");d.printCriteria=b};var h=function(b,c){var d=angular.fromJson(b);a.error=!0,a.errMsg=d.data}}]),angular.module("eduwebApp").controller("classFormCtrl",["$scope","$rootScope","$uibModalInstance","apiService","dialogs","data",function(a,b,c,d,e,f){a.theClass=void 0!==f.selectedClass?f.selectedClass:{},a.deleted=!1,a.clonedClass={},a.classes=f.classes,a.subjectSelection=[],a.subjectExamSelection={},a.apply_to_all_subjects=[],a.gradeWeight={},a.reportCardTypes=["Standard","Kindergarten","Playgroup"],a.examTypes=[],a.isTeacher="TEACHER"==b.currentUser.user_type,a.edit=void 0!==a.theClass.class_id;var g=function(c){if(a.isTeacher&&!a.canEditClass){var e=b.currentUser.emp_id+"/"+c+"/all";d.getAllTeacherSubjects(e,function(b){var c=angular.fromJson(b);"success"==c.response&&(a.subjects=c.nodata?[]:c.data)},l)}else{var e=c+"/all/0";d.getAllSubjects(e,function(b){var c=angular.fromJson(b);"success"==c.response&&(a.subjects=c.nodata?[]:c.data)},l)}},h=function(c){var e=a.isTeacher&&!a.canEditClass?c+"/0/"+b.currentUser.emp_id:c;d.getAllClassExams(e,i,l)},i=function(b,c){var e=angular.fromJson(b);"success"==e.response&&(a.classDetails=e.nodata?[]:angular.copy(e.data),angular.forEach(a.classDetails,function(b,c){-1===a.subjectSelection.indexOf(b.subject_id)&&a.subjectSelection.push(b.subject_id),void 0===a.subjectExamSelection[b.subject_id]&&(a.subjectExamSelection[b.subject_id]=[]),null!==b.exam_type_id&&a.subjectExamSelection[b.subject_id].push(b.exam_type_id),null!==b.exam_type_id&&(void 0===a.gradeWeight[b.subject_id+"-"+b.exam_type_id]&&(a.gradeWeight[b.subject_id+"-"+b.exam_type_id]={}),null!==b.grade_weight&&(a.gradeWeight[b.subject_id+"-"+b.exam_type_id].grade_weight=b.grade_weight))}),g(a.theClass.class_cat_id),d.getExamTypes(a.theClass.class_cat_id,function(b){var c=angular.fromJson(b);"success"==c.response&&(a.examTypes=c.data)},l))},j=function(){d.getAllTeachers(!0,function(b){var c=angular.fromJson(b);"success"==c.response&&(a.teachers=c.data)},l),a.edit?(h(a.theClass.class_id),a.isTeacher?a.canEditClass=a.theClass.teacher_id==a.currentUser.emp_id:a.canEditClass=!0):a.canEditClass=!0};setTimeout(j,1),a.$watch("theClass.class_cat_id",function(b,c){b!=c&&(g(b),d.getExamTypes(b,function(b){var c=angular.fromJson(b);"success"==c.response&&(a.examTypes=c.data)},l))}),a.cancel=function(){c.dismiss("canceled")},a.cloneClass=function(){a.theClass=angular.copy(a.clonedClass),h(a.theClass.class_id)},a.save=function(c){if(!c.$invalid){var e=a.theClass;e.user_id=b.currentUser.user_id,e.subjects=[],a.edit?a.isTeacher&&!a.canEditClass?(angular.forEach(a.subjectSelection,function(b,c){var d=[],f=void 0;angular.forEach(a.subjectExamSelection[b],function(c,e){if(void 0!==a.classDetails)var g=a.classDetails.filter(function(a){return a.subject_id==b&&a.exam_type_id==c?a:void 0})[0];if(f=void 0!==g?g.class_subject_id:void 0,void 0===f){var g=a.classDetails.filter(function(a){return a.subject_id==b&&null==a.exam_type_id?a:void 0})[0];f=void 0!==g?g.class_subject_id:void 0}d.push({exam_type_id:c,class_subject_id:f,class_sub_exam_id:void 0!==g?g.class_sub_exam_id:void 0,grade_weight:void 0!==a.gradeWeight[b+"-"+c]?a.gradeWeight[b+"-"+c].grade_weight:0})}),e.subjects.push({subject_id:b,class_subject_id:f,exams:d})}),e.teacher_id=b.currentUser.emp_id,d.updateTeacherSubject(e,k,l)):(angular.forEach(a.subjectSelection,function(b,c){var d=[],f=void 0;angular.forEach(a.subjectExamSelection[b],function(c,e){if(void 0!==a.classDetails)var g=a.classDetails.filter(function(a){return a.subject_id==b&&a.exam_type_id==c?a:void 0;
})[0];if(f=void 0!==g?g.class_subject_id:void 0,void 0===f){var g=a.classDetails.filter(function(a){return a.subject_id==b&&null==a.exam_type_id?a:void 0})[0];f=void 0!==g?g.class_subject_id:void 0}d.push({exam_type_id:c,class_subject_id:f,class_sub_exam_id:void 0!==g?g.class_sub_exam_id:void 0,grade_weight:void 0!==a.gradeWeight[b+"-"+c]?a.gradeWeight[b+"-"+c].grade_weight:0})}),e.subjects.push({subject_id:b,class_subject_id:f,exams:d})}),d.updateClass(e,k,l)):(angular.forEach(a.subjectSelection,function(b,c){var d=[];angular.forEach(a.subjectExamSelection[b],function(c,e){d.push({exam_type_id:c,grade_weight:void 0!==a.gradeWeight[b+"-"+c]?a.gradeWeight[b+"-"+c].grade_weight:0})}),e.subjects.push({subject_id:b,exams:d})}),d.addClass(e,k,l))}};var k=function(d,e,f){var g=angular.fromJson(d);if("success"==g.response){c.close();var h=a.deleted?"Class was deleted.":a.edit?"Class was updated":"Class was added.";b.$emit("classAdded",{msg:h,clear:!0})}else a.error=!0,a.errMsg=g.data},l=function(b,c){var d=angular.fromJson(b);a.error=!0;var e=d.data.indexOf('"U_active_class_name"')>-1?"This class already exists.":d.data;a.errMsg=e};a.deleteClass=function(){a.error=!1,d.checkClass(a.theClass.class_id,function(c,f){var g=angular.fromJson(c);if("success"==g.response){var h=0==parseInt(g.data.num_exams);if(h){var i=e.confirm("Delete Class","Are you sure you want to permanently delete class <strong>"+a.theClass.class_name+"</strong>? ",{size:"sm"});i.result.then(function(b){a.deleted=!0,d.deleteClass(a.theClass.class_id,k,l)})}else{var i=e.confirm("Please Confirm","Class <strong>"+a.theClass.class_name+"</strong> is associated with <b>"+g.data.num_exams+"</b> classes. Are you sure you want to mark this class as in-active? ",{size:"sm"});i.result.then(function(c){var e={user_id:b.currentUser.user_id,class_id:a.theClass.class_id,status:"f"};d.setClassStatus(e,k,l)})}}else a.error=!0,a.errMsg=g.data},l)},a.activateClass=function(){var c=e.confirm("Please Confirm","Are you sure you want to re-activate this class? ",{size:"sm"});c.result.then(function(c){var e={user_id:b.currentUser.user_id,class_id:a.theClass.class_id,status:"t"};d.setClassStatus(e,k,l)})},a.addClassCat=function(){var a=e.create("addClassCategory.html","addClassCategoryCtrl",{},{size:"sm",backdrop:"static"});a.result.then(function(a){void 0===b.classCats&&(b.classCats=[]),b.classCats.push(a)},function(){})},a.addSubject=function(){var b=window.location.host,c=e.create("http://"+b+"/app/school/subjectForm.html","subjectFormCtrl",{class_cat_id:a.theClass.class_cat_id},{size:"md",backdrop:"static"});c.result.then(function(b){g(a.theClass.class_cat_id)},function(){})},a.addExamType=function(){var b={class_cat_id:a.theClass.class_cat_id},c=e.create("addExamType.html","addExamTypeCtrl",b,{size:"sm",backdrop:"static"});c.result.then(function(b){void 0===a.examTypes&&(a.examTypes=[]),a.examTypes.push(b)},function(){})},a.toggleSubjects=function(b){var c=a.subjectSelection.indexOf(b);c>-1?(a.subjectSelection.splice(c,1),a.subjectExamSelection[b]=void 0):-1===a.subjectSelection.indexOf(b)&&(a.subjectSelection.push(b),a.subjectExamSelection[b]=[])},a.toggleSubjectExam=function(b,c){void 0===a.subjectExamSelection[b]&&(a.subjectExamSelection[b]=[]);var d=a.subjectExamSelection[b].indexOf(c);d>-1?a.subjectExamSelection[b].splice(d,1):a.subjectExamSelection[b].push(c)},a.$watch("subject.apply_to_all",function(b,c){b!=c&&(b?angular.forEach(a.subjects,function(b,c){a.subjectSelection.push(b.subject_id),a.subjectExamSelection[b.subject_id]=[]}):angular.forEach(a.subjects,function(b,c){a.subjectSelection=[],a.subjectExamSelection[b.subject_id]=void 0}))}),a.toggleAllExams=function(b,c){var d=a.apply_to_all_subjects[c]===!0;d?angular.forEach(a.subjects,function(c,d){void 0===a.subjectExamSelection[c.subject_id]&&(a.subjectExamSelection[c.subject_id]=[]),a.subjectExamSelection[c.subject_id].push(b)}):angular.forEach(a.subjects,function(c,d){var e=a.subjectExamSelection[c.subject_id].indexOf(b);a.subjectExamSelection[c.subject_id].splice(e,1)})}}]).controller("addExamTypeCtrl",["$scope","$rootScope","$uibModalInstance","apiService","data",function(a,b,c,d,e){a.examType={},a.examType.class_cat_id=e.class_cat_id,"TEACHER"==b.currentUser.user_type?d.getClassCats(b.currentUser.emp_id,function(b){var c=angular.fromJson(b);"success"==c.response&&(a.classCats=c.data)},g):a.classCats=b.classCats,a.cancel=function(){c.dismiss("Canceled")},a.save=function(){a.examType.user_id=b.currentUser.user_id,d.addExamType(a.examType,f,g)};var f=function(b,d){var e=angular.fromJson(b);"success"==e.response?c.close(e.data):(a.error=!0,a.errMsg=e.data)},g=function(b,c){var d=angular.fromJson(b);a.error=!0;var e=d.data.indexOf('"U_exam_type_per_category"')>-1?"This exam type has already been entered for this class category.":d.data;a.errMsg=e};a.hitEnter=function(b){angular.equals(b.keyCode,13)&&a.save()}}]).run(["$templateCache",function(a){a.put("addExamType.html",'<div class="modal-header dialog-header-form"><h4 class="modal-title"><span class="glyphicon glyphicon-plus"></span> Add Exam Type</h4></div><div class="modal-body cleafix"><ng-form name="catDialog" class="form-horizontal modalForm" novalidate role="form"><div ng-show="error" class="alert alert-danger">{{errMsg}}</div><!-- exam type --><div class="form-group" ng-class="{ \'has-error\' : catDialog.exam_type.$invalid && (catDialog.exam_type.$touched || catDialog.$submitted) }"><label for="exam_type" class="col-sm-3 control-label">Exam Type</label><div class="col-sm-9"><input type="text" name="name" ng-model="examType.exam_type" class="form-control"  ><p ng-show="catDialog.exam_type.$invalid && (catDialog.exam_type.$touched || catDialog.$submitted)" class="help-block"><i class="fa fa-exclamation-triangle"></i> Exam Type is required.</p></div></div><!-- class category --><div class="form-group ng-class="{ \'has-error\' : catDialog.class_cat.$invalid && (catDialog.class_cat.$touched || catDialog.$submitted) }"><label for="class_cat" class="col-sm-3 control-label">Class Category</label><div class="col-sm-9"><select name="class_cat" class="form-control" ng-options="cat.class_cat_id as cat.class_cat_name for cat in classCats"  ng-model="examType.class_cat_id" required><option value="">--select class category--</option></select><p ng-show="catDialog.class_cat.$invalid && (catDialog.class_cat.$touched || catDialog.$submitted)" class="help-block"><i class="fa fa-exclamation-triangle"></i> Class category is required.</p></div></div></ng-form></div><div class="modal-footer"><button type="button" class="btn btn-link" ng-click="cancel()">Cancel</button><button type="button" class="btn btn-primary" ng-click="save()">Save</button></div>')}]),angular.module("eduwebApp").controller("classesCtrl",["$scope","$rootScope","apiService","$timeout","$window","$filter","$state",function(a,b,c,d,e,f,g){a.filters={},a.filters.status="true",a.alert={},a.filters={},a.filters.status="true",a.filters.class_cat_id=""!==g.params.class_cat_id?g.params.class_cat_id:null,a.filterClassCat=""!==g.params.class_cat_id,a.filters.class_id=""!==g.params.class_id?g.params.class_id:null,a.filterClass=""!==g.params.class_id,a.loading=!0,a.isTeacher="TEACHER"==b.currentUser.user_type;var h=function(){i("")};d(h,1);var i=function(e){if(void 0!==a.dataGrid&&($(".fixedHeader-floating").remove(),a.dataGrid.clear(),a.dataGrid.destroy()),a.isTeacher){var f=b.currentUser.emp_id+"/"+a.filters.status;c.getTeacherClasses(f,function(b,c){var e=angular.fromJson(b);"success"==e.response?(a.classes=e.nodata?[]:e.data,d(j,10)):(a.error=!0,a.errMsg=e.data)},l)}else{var f=""!=e&&null!==e&&void 0!==e?e+"/"+a.filters.status:"ALL/"+a.filters.status;c.getClasses(f,function(b,c){var e=angular.fromJson(b);"success"==e.response?(a.classes=e.nodata?[]:e.data,d(j,10)):(a.error=!0,a.errMsg=e.data)},l)}};a.loadFilter=function(){a.loading=!0,i(a.filters.class_cat_id)};var j=function(){var c=$("#resultsTable");a.dataGrid=c.DataTable({rowReorder:!0,columnDefs:[{orderable:!0,className:"reorder",targets:0},{orderable:!1,targets:"_all"}],paging:!1,destroy:!0,filter:!0,info:!1,initComplete:function(c,d){a.loading=!1,b.loading=!1,a.$apply()},language:{search:"Search Results<br>",searchPlaceholder:"Filter",lengthMenu:"Display _MENU_",emptyTable:"No classes found."}});var d=$(".navbar-fixed-top").height(),f=$("#body-content .content-fixed-header").height(),g=b.isSmallScreen?22:13;if(new $.fn.dataTable.FixedHeader(a.dataGrid,{header:!0,headerOffset:d+f+g}),a.dataGrid.on("row-reordered",function(a,b,c){k()}),!b.isSmallScreen){var h=$(".dataFilterForm form").width();$("#resultsTable_filter").css("left",h+55)}e.addEventListener("resize",function(){if(b.isSmallScreen=window.innerWidth<768,b.isSmallScreen)$("#resultsTable_filter").css("left",0);else{var a=$(".dataFilterForm form").width();$("#resultsTable_filter").css("left",a-30)}},!1)},k=function(){var d={user_id:b.currentUser.user_id,data:[]};a.dataGrid.rows().every(function(a,b,c){var e={class_id:this.id(),sort_order:this.data()[0]};d.data.push(e)}),d.data.length>0&&c.setClassSortOrder(d,function(){},l)},l=function(b,c){var d=angular.fromJson(b);a.error=!0,a.errMsg=d.data};a.addClass=function(){a.openModal("school","classForm","lg",{classes:a.classes})},a.viewClass=function(b){a.openModal("school","classForm","lg",{selectedClass:b})},a.exportItems=function(){b.wipNotice()},a.$on("refreshClasses",function(c,e){a.loading=!0,b.loading=!0,void 0!==e&&(a.updated=!0,a.notificationMsg=e.msg),a.refresh(),d(function(){a.alert.expired=!0},2e3),d(function(){a.updated=!1,a.notificationMsg="",a.alert.expired=!1},3e3)}),a.refresh=function(){a.loading=!0,b.loading=!0,i(a.filters.class_cat_id||"")},a.$on("$destroy",function(){a.dataGrid&&(a.dataGrid.off("row-reordered"),$(".fixedHeader-floating").remove(),a.dataGrid.fixedHeader.destroy(),a.dataGrid.clear(),a.dataGrid.destroy()),b.isModal=!1})}]),angular.module("eduwebApp").controller("datesCtrl",["$scope","$rootScope","apiService","$timeout","$window","$filter",function(a,b,c,d,e,f){a.filters={},a.alert={},a.loading=!0,a.gridFilter={},a.gridFilter.filterValue="";var g=function(){return'<div class="clickable" ng-click="grid.appScope.viewDate(row.entity)">  <div ng-if="row.entity.merge">{{row.entity.title}}</div>  <div ng-if="!row.entity.merge" ng-repeat="(colRenderIndex, col) in colContainer.renderedColumns track by col.colDef.name" class="ui-grid-cell" ng-class="{ \'ui-grid-row-header-cell\': col.isRowHeader }"  ui-grid-cell></div></div>'};a.gridOptions={enableSorting:!0,rowTemplate:g(),rowHeight:24,columnDefs:[{name:"Term Name",field:"term_name",enableColumnMenu:!1,sort:{direction:"asc"}},{name:"Start Date",field:"start_date",type:"date",cellFilter:"date",enableColumnMenu:!1},{name:"End Date",field:"end_date",type:"date",cellFilter:"date",enableColumnMenu:!1}],exporterCsvFilename:"school-dates.csv",onRegisterApi:function(b){a.gridApi=b,a.gridApi.grid.registerRowsProcessor(a.singleFilter,200),d(function(){a.gridApi.core.handleWindowResize()})}};var h=function(){a.years=[];for(var c=moment().format("YYYY"),d=void 0!==b.currentUser.settings["Initial Year"]?b.currentUser.settings["Initial Year"]:"2014",e=d;c>=e;e++)a.years.push(e);a.filters.year=c,i(c),setTimeout(function(){var b=$(".full-height.datagrid").height();$("#grid1").css("height",b),a.gridApi.core.handleWindowResize()},100)};d(h,1);var i=function(d){var d=""==d?void 0:d;c.getTerms(d,function(c,d,e){var f=angular.fromJson(c);"success"==f.response?(a.dates=f.nodata?[]:f.data,b.terms=a.dates,j(a.dates)):(a.error=!0,a.errMsg=f.data)},k)};a.loadFilter=function(){a.loading=!0,i(a.filters.year)};var j=function(c){a.gridOptions.data=c,a.loading=!1,b.loading=!1};a.filterDataTable=function(){a.gridApi.grid.refresh()},a.clearFilterDataTable=function(){a.gridFilter.filterValue="",a.gridApi.grid.refresh()},a.singleFilter=function(b){var c=new RegExp(a.gridFilter.filterValue,"i");return b.forEach(function(a){var b=!1;["term_name"].forEach(function(d){a.entity[d].match(c)&&(b=!0)}),b||(a.visible=!1)}),b};var k=function(b,c){var d=angular.fromJson(b);a.error=!0,a.errMsg=d.data};a.addDate=function(){a.openModal("school","datesForm","md")},a.viewDate=function(b){a.openModal("school","datesForm","md",b)},a.exportItems=function(){a.gridApi.exporter.csvExport("visible","visible")},a.$on("refreshDates",function(c,e){a.loading=!0,b.loading=!0,void 0!==e&&(a.updated=!0,a.notificationMsg=e.msg),a.refresh(),d(function(){a.alert.expired=!0},2e3),d(function(){a.updated=!1,a.notificationMsg="",a.alert.expired=!1},3e3)}),a.refresh=function(){a.loading=!0,b.loading=!0,i(a.filters.year)},a.$on("$destroy",function(){b.isModal=!1})}]),angular.module("eduwebApp").controller("datesFormCtrl",["$scope","$rootScope","$uibModalInstance","apiService","dialogs","data",function(a,b,c,d,e,f){a.edit=void 0!==f,a.date=void 0!==f?f:{},a.canDelete="0"==a.date.has_exams,a.initializeController=function(){if(a.edit)a.start_date={startDate:a.date.start_date},a.end_date={startDate:a.date.end_date};else{var b=moment().format("YYYY-MM-DD");a.start_date={startDate:b},a.end_date={startDate:b}}},a.initializeController(),a.cancel=function(){c.dismiss("canceled")},a.save=function(b){if(!b.$invalid){var c=a.date;c.start_date=moment(a.start_date.startDate).format("YYYY-MM-DD"),c.end_date=moment(a.end_date.startDate).format("YYYY-MM-DD"),a.edit?d.updateTerm(c,g,h):d.addTerm(c,g,h)}};var g=function(d,e,f){var g=angular.fromJson(d);if("success"==g.response){c.close();var h=a.edit?"Term was updated.":"Term was added.";b.$emit("termAdded",{msg:h,clear:!0})}else a.error=!0,a.errMsg=g.data},h=function(b,c){var d=angular.fromJson(b);a.error=!0,a.errMsg=d.data};a.deleteTerm=function(){var f=e.confirm("Please Confirm","Are you sure you want to delete this term? <br><br><b><i>(THIS CAN NOT BE UNDONE)</i></b>",{size:"sm"});f.result.then(function(e){d.deleteTerm(a.date.term_id,function(d,e,f){var g=angular.fromJson(d);if("success"==g.response){var h="Term was deleted.";b.$emit("termAdded",{msg:h,clear:!0}),c.dismiss("canceled")}else a.error=!0,a.errMsg=g.data},h)})}}]),angular.module("eduwebApp").controller("departmentFormCtrl",["$scope","$rootScope","$uibModalInstance","apiService","dialogs","data",function(a,b,c,d,e,f){a.edit=void 0!==f.department,a.department=void 0!==f.department?f.department:{},a.edit||(a.department.category=void 0!==f.emp_cat_name?f.emp_cat_name:""),a.initializeController=function(){a.categories=b.empCats},a.initializeController(),a.cancel=function(){c.dismiss("canceled")},a.save=function(c){if(!c.$invalid){var e=a.department;e.user_id=b.currentUser.user_id,a.edit?d.updateDept(e,g,h):d.addDept(e,g,h)}};var g=function(d,e,f){var g=angular.fromJson(d);if("success"==g.response){c.close();var h=a.edit?"Department was updated.":"Department was added.";b.$emit("deptAdded",{msg:h,clear:!0})}else a.error=!0,a.errMsg=g.data},h=function(b,c){var d=angular.fromJson(b);a.error=!0;var e=d.data.indexOf('"U_dept_name"')>-1?"The Department name you entered already exists.":d.data;a.errMsg=e};a.deleteDept=function(){d.checkDepartment(a.department.dept_id,function(c,f){var i=angular.fromJson(c);if("success"==i.response){var j=0==parseInt(i.data.num_employees);if(j){var k=e.confirm("Please Confirm","Are you sure you want to permanently delete this department? ",{size:"sm"});k.result.then(function(b){d.deleteDept(a.department.dept_id,g,h)})}else{var k=e.confirm("Please Confirm","This department is associated with <b>"+i.data.num_employees+"</b> employees. Are you sure you want to mark this department as in-active? ",{size:"sm"});k.result.then(function(c){var e={user_id:b.currentUser.user_id,dept_id:a.department.dept_id,status:"f"};d.setDeptStatus(e,g,h)})}}else a.error=!0,a.errMsg=i.data},h)},a.activateDept=function(){var c=e.confirm("Please Confirm","Are you sure you want to re-activate this department? ",{size:"sm"});c.result.then(function(c){var e={user_id:b.currentUser.user_id,dept_id:a.department.dept_id,status:"t"};d.setDeptStatus(e,g,h)})},a.addCat=function(){var c=e.create("addCategory.html","addCategoryCtrl",{},{size:"sm",backdrop:"static"});c.result.then(function(c){a.categories.push(c),d.getSettings({},function(a){var c=angular.fromJson(a);if("success"==c.response){var d=c.data.reduce(function(a,b){return a[b.name]=b.value,a},{});b.$emit("setSettings",d)}},h)},function(){})}}]).controller("addCategoryCtrl",["$scope","$rootScope","$uibModalInstance","apiService","data",function(a,b,c,d,e){a.category={},a.cancel=function(){c.dismiss("Canceled")},a.save=function(){var b={name:"Department Categories",value:a.category.name,append:!0};d.updateSetting(b,f,g)};var f=function(b,d){var e=angular.fromJson(b);"success"==e.response?c.close(a.category.name):(a.error=!0,a.errMsg=e.data)},g=function(b,c){var d=angular.fromJson(b);a.error=!0,a.errMsg=d.data};a.hitEnter=function(b){angular.equals(b.keyCode,13)&&a.save()}}]).run(["$templateCache",function(a){a.put("addCategory.html",'<div class="modal-header dialog-header-form"><h4 class="modal-title"><span class="glyphicon glyphicon-plus"></span> Add Category</h4></div><div class="modal-body cleafix"><ng-form name="catDialog" class="form-horizontal modalForm" novalidate role="form"><div ng-show="error" class="alert alert-danger">{{errMsg}}</div><!-- name --><div class="form-group" ng-class="{ \'has-error\' : catDialog.name.$invalid && (catDialog.name.$touched || catDialog.$submitted) }"><label for="name" class="col-sm-3 control-label">Category Name</label><div class="col-sm-9"><input type="text" name="name" ng-model="category.name" class="form-control"  ><p ng-show="catDialog.name.$invalid && (catDialog.name.$touched || catDialog.$submitted)" class="help-block"><i class="fa fa-exclamation-triangle"></i> Category Name is required.</p></div></div></ng-form></div><div class="modal-footer"><button type="button" class="btn btn-link" ng-click="cancel()">Cancel</button><button type="button" class="btn btn-primary" ng-click="save()">Save</button></div>')}]),angular.module("eduwebApp").controller("departmentsCtrl",["$scope","$rootScope","apiService","$timeout","$window","$filter",function(a,b,c,d,e,f){a.filters={},a.filters.status="true",a.alert={},a.loading=!0,a.gridFilter={},a.gridFilter.filterValue="";var g=function(){return'<div class="clickable" ng-click="grid.appScope.viewDepartment(row.entity)">  <div ng-if="row.entity.merge">{{row.entity.title}}</div>  <div ng-if="!row.entity.merge" ng-repeat="(colRenderIndex, col) in colContainer.renderedColumns track by col.colDef.name" class="ui-grid-cell" ng-class="{ \'ui-grid-row-header-cell\': col.isRowHeader }"  ui-grid-cell></div></div>'};a.gridOptions={enableSorting:!0,rowTemplate:g(),rowHeight:24,columnDefs:[{name:"Category",field:"category",enableColumnMenu:!1,sort:{direction:"asc"}},{name:"Department Name",field:"dept_name",enableColumnMenu:!1}],exporterCsvFilename:"school-departments.csv",onRegisterApi:function(b){a.gridApi=b,a.gridApi.grid.registerRowsProcessor(a.singleFilter,200),d(function(){a.gridApi.core.handleWindowResize()})}};var h=function(){i(),setTimeout(function(){var b=$(".full-height.datagrid").height();$("#grid1").css("height",b),a.gridApi.core.handleWindowResize()},100)};d(h,1);var i=function(){c.getDepts(a.filters.status,function(c,d,e){var f=angular.fromJson(c);"success"==f.response?(a.departments=f.nodata?[]:f.data,b.allDepts=a.departments,j(a.departments)):(a.error=!0,a.errMsg=f.data)},k)},j=function(c){a.gridOptions.data=c,a.loading=!1,b.loading=!1};a.filterDataTable=function(){a.gridApi.grid.refresh()},a.clearFilterDataTable=function(){a.gridFilter.filterValue="",a.gridApi.grid.refresh()},a.singleFilter=function(b){var c=new RegExp(a.gridFilter.filterValue,"i");return b.forEach(function(a){var b=!1;["category","dept_name"].forEach(function(d){a.entity[d].match(c)&&(b=!0)}),b||(a.visible=!1)}),b};var k=function(b,c){var d=angular.fromJson(b);a.error=!0,a.errMsg=d.data};a.loadFilter=function(){a.loading=!0,i()},a.addDept=function(){a.openModal("school","departmentForm","md")},a.viewDepartment=function(b){var c={department:b};a.openModal("school","departmentForm","md",c)},a.exportItems=function(){a.gridApi.exporter.csvExport("visible","visible")},a.$on("refreshDepartments",function(c,e){a.loading=!0,b.loading=!0,void 0!==e&&(a.updated=!0,a.notificationMsg=e.msg),a.refresh(),d(function(){a.alert.expired=!0},2e3),d(function(){a.updated=!1,a.notificationMsg="",a.alert.expired=!1},3e3)}),a.refresh=function(){a.loading=!0,b.loading=!0,i()},a.$on("$destroy",function(){b.isModal=!1})}]),angular.module("eduwebApp").controller("gradingCtrl",["$scope","$rootScope","apiService","$timeout","$window","$filter",function(a,b,c,d,e,f){a.alert={},a.loading=!0,a.gridFilter={},a.gridFilter.filterValue="";var g=function(){return'<div class="clickable" ng-click="grid.appScope.viewGrading(row.entity)">  <div ng-if="row.entity.merge">{{row.entity.title}}</div>  <div ng-if="!row.entity.merge" ng-repeat="(colRenderIndex, col) in colContainer.renderedColumns track by col.colDef.name" class="ui-grid-cell" ng-class="{ \'ui-grid-row-header-cell\': col.isRowHeader }"  ui-grid-cell></div></div>'};a.gridOptions={enableSorting:!0,rowTemplate:g(),rowHeight:24,columnDefs:[{name:"Grade",field:"grade",enableColumnMenu:!1,sort:{direction:"asc"}},{name:"Grade Marks Range",field:"mark_range",type:"date",cellFilter:"date",enableColumnMenu:!1}],exporterCsvFilename:"school-grading.csv",onRegisterApi:function(b){a.gridApi=b,d(function(){a.gridApi.core.handleWindowResize()})}};var h=function(){i(),setTimeout(function(){var b=$(".full-height.datagrid").height();$("#grid1").css("height",b),a.gridApi.core.handleWindowResize()},100)};d(h,1);var i=function(){c.getGrading({},function(b,c,d){var e=angular.fromJson(b);"success"==e.response?(a.grades=e.nodata?[]:e.data,a.grades=a.grades.map(function(a){return a.mark_range=a.min_mark+"-"+a.max_mark,a}),j(a.grades)):(a.error=!0,a.errMsg=e.data)},k)},j=function(c){a.gridOptions.data=c,a.loading=!1,b.loading=!1},k=function(b,c){var d=angular.fromJson(b);a.error=!0,a.errMsg=d.data};a.addGrading=function(){a.openModal("school","gradingForm","sm")},a.viewGrading=function(b){a.openModal("school","gradingForm","sm",b)},a.$on("refreshGrades",function(c,e){a.loading=!0,b.loading=!0,void 0!==e&&(a.updated=!0,a.notificationMsg=e.msg),a.refresh(),d(function(){a.alert.expired=!0},2e3),d(function(){a.updated=!1,a.notificationMsg="",a.alert.expired=!1},3e3)}),a.refresh=function(){a.loading=!0,b.loading=!0,i()},a.$on("$destroy",function(){b.isModal=!1})}]),angular.module("eduwebApp").controller("gradingFormCtrl",["$scope","$rootScope","$uibModalInstance","apiService","dialogs","data",function(a,b,c,d,e,f){a.edit=void 0!==f,a.grading=void 0!==f?f:{},a.initializeController=function(){},a.initializeController(),a.cancel=function(){c.dismiss("canceled")},a.save=function(b){if(!b.$invalid){var c=a.grading;a.edit?d.updateGrading(c,g,h):d.addGrading(c,g,h)}};var g=function(d,e,f){var g=angular.fromJson(d);if("success"==g.response){c.close();var h=a.edit?"Grading was updated.":"Grading was added.";b.$emit("gradingAdded",{msg:h,clear:!0})}else a.error=!0,a.errMsg=g.data},h=function(b,c){var d=angular.fromJson(b);a.error=!0,a.errMsg=d.data}}]),angular.module("eduwebApp").controller("schoolSettingsCtrl",["$scope","$rootScope","apiService","$timeout","$window","$filter","FileUploader","dialogs",function(a,b,c,d,e,f,g,h){a.alert={};var i=function(){a.schoolTypes=["Private School","Public School"],a.curriculums=["8-4-4"],a.currencies=["Ksh"],a.schoolLevels=["Primary","Secondary"],void 0===b.currentUser.settings["School Name"]&&(a.initialSetup=!0),k()};d(i,1);var j=function(){c.getSettings({},function(a){var c=angular.fromJson(a);if("success"==c.response){var d=c.data.reduce(function(a,b){return a[b.name]=b.value,a},{});b.$emit("setSettings",d),k()}},m)},k=function(){a.settings={"Address 1":angular.copy(b.currentUser.settings["Address 1"]),"Address 2":angular.copy(b.currentUser.settings["Address 2"]),Country:angular.copy(b.currentUser.settings.Country),Curriculum:angular.copy(b.currentUser.settings.Curriculum),"Email Address":angular.copy(b.currentUser.settings["Email Address"]),"Email From":angular.copy(b.currentUser.settings["Email From"]),"Phone Number":angular.copy(b.currentUser.settings["Phone Number"]),"School Name":angular.copy(b.currentUser.settings["School Name"]),"School Type":angular.copy(b.currentUser.settings["School Type"]),"School Level":angular.copy(b.currentUser.settings["School Level"]),logo:angular.copy(b.currentUser.settings.logo),Currency:angular.copy(b.currentUser.settings.Currency),Letterhead:angular.copy(b.currentUser.settings.Letterhead)}};a.$watch("uploader.queue[0]",function(b,c){void 0!==b&&a.schoolForm.$setDirty()}),a.$watch("uploader2.queue[0]",function(b,c){void 0!==b&&a.schoolForm.$setDirty()}),a.save=function(b){if(a.error=!1,a.errMsg="",!b.$invalid){void 0!==n.queue[0]&&(n.queue[0].file.name=moment()+"_"+n.queue[0].file.name,n.uploadAll()),void 0!==o.queue[0]&&(o.queue[0].file.name=moment()+"_"+o.queue[0].file.name,o.uploadAll());var d=[];angular.forEach(a.settings,function(a,b){void 0!==n.queue[0]&&"logo"==b?d.push({name:"logo",value:n.queue[0].file.name,append:!1}):void 0!==o.queue[0]&&"Letterhead"==b?d.push({name:"Letterhead",value:o.queue[0].file.name,append:!1}):d.push({name:b,value:a,append:!1})});var e={settings:d};a.saving=!0,c.updateSettings(e,l,m)}};var l=function(b,c){var d=angular.fromJson(b);"success"==d.response?(a.initialSetup=!1,j(),a.schoolForm.$setPristine(),a.saving=!1):(a.error=!0,a.errMsg=d.data)};a.addEmpCat=function(){var a=h.create("addEmpCategory.html","addEmpCategoryCtrl",{},{size:"sm",backdrop:"static"});a.result.then(function(a){b.empCats=void 0,b.getEmpCats()},function(){})},a.editEmpCat=function(a){var c=h.create("addEmpCategory.html","addEmpCategoryCtrl",{item:a},{size:"sm",backdrop:"static"});c.result.then(function(a){b.empCats=void 0,b.getEmpCats()},function(){})},a.removeEmpCat=function(d){a.error=!1,c.checkEmpCat(d.emp_cat_id,function(e,f){var g=angular.fromJson(e);if("success"==g.response){var i=0==parseInt(g.data.num_employees);if(i){var j=h.confirm("Delete Employee Category","Are you sure you want to permanently delete employee category <strong>"+d.emp_cat_name+"</strong>? ",{size:"sm"});j.result.then(function(a){c.deleteEmpCat(d.emp_cat_id,function(a,c){b.empCats=void 0,b.getEmpCats()},m)})}else{var j=h.confirm("Please Confirm","Employee category <strong>"+d.emp_cat_name+"</strong> is associated with <b>"+g.data.num_employees+"</b> employees. Are you sure you want to mark this employee category as in-active? ",{size:"sm"});j.result.then(function(a){var e={user_id:b.currentUser.user_id,emp_cat_id:d.emp_cat_id,status:"f"};c.setEmployeeCatStatus(e,function(a,c){b.empCats=void 0,b.getEmpCats()},m)})}}else a.error=!0,a.errMsg=g.data},m)},a.addClassCat=function(){var a=h.create("addClassCategory.html","addClassCategoryCtrl",{},{size:"sm",backdrop:"static"});a.result.then(function(a){b.classCats=void 0,b.getClassCats()},function(){})},a.editClassCat=function(a){var c=h.create("addClassCategory.html","addClassCategoryCtrl",{item:a},{size:"sm",backdrop:"static"});c.result.then(function(a){b.classCats=void 0,b.getClassCats()},function(){})},a.removeClassCat=function(d){a.error=!1,c.checkClassCat(d.class_cat_id,function(e,f){var g=angular.fromJson(e);if("success"==g.response){var i=0==parseInt(g.data.num_exams);if(i){var j=h.confirm("Delete Class Category","Are you sure you want to permanently delete class category <strong>"+d.class_cat_name+"</strong>? ",{size:"sm"});j.result.then(function(a){c.deleteClassCat(d.class_cat_id,function(a,c){b.classCats=void 0,b.getClassCats()},m)})}else{var j=h.confirm("Please Confirm","Class category <strong>"+d.class_cat_name+"</strong> is associated with <b>"+g.data.num_exams+"</b> exam marks. Are you sure you want to mark this class category as in-active? ",{size:"sm"});j.result.then(function(a){var e={user_id:b.currentUser.user_id,class_cat_id:d.class_cat_id,status:"f"};c.setClassCatStatus(e,function(a,c){b.classCats=void 0,b.getClassCats()},m)})}}else a.error=!0,a.errMsg=g.data},m)};var m=function(b,c){var d=angular.fromJson(b);a.error=!0;var e=d.data.indexOf('"U_active_emp_cat"')>-1?"The Employee Category name you entered already exists.":d.data;a.errMsg=e},n=a.uploader=new g({url:"upload.php",formData:[{dir:"schools"}]}),o=a.uploader2=new g({url:"upload.php",formData:[{dir:"schools"}]});a.$on("$destroy",function(){a.dataGrid&&($(".fixedHeader-floating").remove(),a.dataGrid.fixedHeader.destroy(),a.dataGrid.clear(),a.dataGrid.destroy()),b.isModal=!1})}]).controller("addEmpCategoryCtrl",["$scope","$rootScope","$uibModalInstance","apiService","dialogs","data",function(a,b,c,d,e,f){a.edit=void 0!==f.item,a.empCat=f.item||{},a.cancel=function(){c.dismiss("Canceled")},a.save=function(){if(a.edit){var c=e.confirm("Update Employee Category","Are you sure you want to update this employee category? It will also update all employees that are associated with this category.",{size:"sm"});c.result.then(function(c){var e={emp_cat_id:a.empCat.emp_cat_id,emp_cat_name:a.empCat.emp_cat_name,user_id:b.currentUser.user_id};d.updateEmployeeCat(e,g,h)})}else{var f={emp_cat_name:a.empCat.emp_cat_name,user_id:b.currentUser.user_id};d.addEmployeeCat(f,g,h)}};var g=function(b,d){var e=angular.fromJson(b);"success"==e.response?c.close(e.data):(a.error=!0,a.errMsg=e.data)},h=function(b,c){var d=angular.fromJson(b);a.error=!0;var e=d.data.indexOf('"U_active_emp_cat"')>-1?"The Employee Category name you entered already exists.":d.data;a.errMsg=e};a.hitEnter=function(b){angular.equals(b.keyCode,13)&&a.save()}}]).run(["$templateCache",function(a){a.put("addEmpCategory.html",'<div class="modal-header dialog-header-form"><h4 class="modal-title"><span class="glyphicon glyphicon-plus"></span> {{ (edit ? \'Update\' : \'Add\') }} Employee Category</h4></div><div class="modal-body cleafix"><ng-form name="catDialog" class="form-horizontal modalForm" novalidate role="form"><div ng-show="error" class="alert alert-danger">{{errMsg}}</div><!-- emp_cat_name --><div class="form-group" ng-class="{ \'has-error\' : catDialog.emp_cat_name.$invalid && (catDialog.emp_cat_name.$touched || catDialog.$submitted) }"><label for="emp_cat_name" class="col-sm-3 control-label">Employee Category Name</label><div class="col-sm-9"><input type="text" name="emp_cat_name" ng-model="empCat.emp_cat_name" class="form-control" required ><p ng-show="catDialog.emp_cat_name.$invalid && (catDialog.emp_cat_name.$touched || catDialog.$submitted)" class="help-block"><i class="fa fa-exclamation-triangle"></i> Employee Category Name is required.</p></div></div></ng-form></div><div class="modal-footer"><button type="button" class="btn btn-link" ng-click="cancel()">Cancel</button><button type="button" class="btn btn-primary" ng-click="save()">{{ (edit ? \'Update\' : \'Save\') }}</button></div>')}]),angular.module("eduwebApp").controller("subjectFormCtrl",["$scope","$rootScope","$uibModalInstance","apiService","dialogs","data",function(a,b,c,d,e,f){a.edit=!(!f.subject||void 0===f.subject.subject_id),a.deleted=!1,a.initializeController=function(){if(d.getAllTeachers(!0,function(b){var c=angular.fromJson(b);"success"==c.response&&(a.teachers=c.data)},h),a.edit?a.subject=void 0!==f.subject?f.subject:{}:(a.subject={},a.subject.class_cat_id=void 0!==f.class_cat_id?f.class_cat_id:{}),void 0!==a.subject.class_cat_id){var b=a.subject.class_cat_id+"/true/0";d.getAllSubjects(b,function(b,c,d){var e=angular.fromJson(b);"success"==e.response&&(a.subjects=e.nodata?[]:e.data)},h)}},a.initializeController(),a.$watch("subject.class_cat_id",function(b,c){if(b!=c){var e=b+"/true/0";d.getAllSubjects(e,function(b,c,d){var e=angular.fromJson(b);"success"==e.response&&(a.subjects=e.nodata?[]:e.data)},h)}}),a.cancel=function(){c.dismiss("canceled")},a.save=function(c){if(!c.$invalid){var e=a.subject;e.user_id=b.currentUser.user_id,e.use_for_grading=e.use_for_grading?"t":"f",
a.edit?d.updateSubject(e,g,h):d.addSubject(e,g,h)}};var g=function(d,e,f){var g=angular.fromJson(d);if("success"==g.response){c.close();var h=a.deleted?"Subject was deleted.":a.edit?"Subject was updated":"Subject was added.";b.$emit("subjectAdded",{msg:h,clear:!0})}else a.error=!0,a.errMsg=g.data},h=function(b,c){var d=angular.fromJson(b);a.error=!0;var e=d.data.indexOf('"U_subject_by_class_cat"')>-1?"This subject already exists.":d.data;a.errMsg=e};a.deleteSubject=function(){a.error=!1,d.checkSubject(a.subject.subject_id,function(c,f){var i=angular.fromJson(c);if("success"==i.response){var j=0==parseInt(i.data.num_classes);if(j){var k=e.confirm("Delete Subject","Are you sure you want to permanently delete subject <strong>"+a.subject.subject_name+"</strong>? ",{size:"sm"});k.result.then(function(b){a.deleted=!0,d.deleteSubject(a.subject.subject_id,g,h)})}else{var k=e.confirm("Please Confirm","Subject <strong>"+a.subject.subject_name+"</strong> is associated with <b>"+i.data.num_classes+"</b> classes. Are you sure you want to mark this subject as in-active? ",{size:"sm"});k.result.then(function(c){var e={user_id:b.currentUser.user_id,subject_id:a.subject.subject_id,status:"f"};d.setSubjectStatus(e,g,h)})}}else a.error=!0,a.errMsg=i.data},h)},a.activateSubject=function(){var c=e.confirm("Please Confirm","Are you sure you want to re-activate this subject? ",{size:"sm"});c.result.then(function(c){var e={user_id:b.currentUser.user_id,subject_id:a.subject.subject_id,status:"t"};d.setSubjectStatus(e,g,h)})},a.addClassCat=function(){var a=e.create("addClassCategory.html","addClassCategoryCtrl",{},{size:"sm",backdrop:"static"});a.result.then(function(a){b.classCats.push(a)},function(){})}}]).controller("addClassCategoryCtrl",["$scope","$rootScope","$uibModalInstance","apiService","dialogs","data",function(a,b,c,d,e,f){a.edit=void 0!==f.item,a.classCat=f.item||{},a.cancel=function(){c.dismiss("Canceled")},a.save=function(){if(a.edit){var c=e.confirm("Update Class Category","Are you sure you want to update this class category? It will also update all students that are associated with this category.",{size:"sm"});c.result.then(function(c){var e={class_cat_id:a.classCat.class_cat_id,class_cat_name:a.classCat.class_cat_name,user_id:b.currentUser.user_id};d.updateClassCat(e,g,h)})}else{var f={class_cat_name:a.classCat.class_cat_name,user_id:b.currentUser.user_id};d.addClassCat(f,g,h)}};var g=function(b,d){var e=angular.fromJson(b);"success"==e.response?c.close(e.data):(a.error=!0,a.errMsg=e.data)},h=function(b,c){var d=angular.fromJson(b);a.error=!0;var e=d.data.indexOf('"U_active_class_cat"')>-1?"The Class Category name you entered already exists.":d.data;a.errMsg=e};a.hitEnter=function(b){angular.equals(b.keyCode,13)&&a.save()}}]).run(["$templateCache",function(a){a.put("addClassCategory.html",'<div class="modal-header dialog-header-form"><h4 class="modal-title"><span class="glyphicon glyphicon-plus"></span> {{ (edit ? \'Update\' : \'Add\') }} Class Category</h4></div><div class="modal-body cleafix"><ng-form name="catDialog" class="form-horizontal modalForm" novalidate role="form"><div ng-show="error" class="alert alert-danger">{{errMsg}}</div><!-- class_cat_name --><div class="form-group" ng-class="{ \'has-error\' : catDialog.class_cat_name.$invalid && (catDialog.class_cat_name.$touched || catDialog.$submitted) }"><label for="class_cat_name" class="col-sm-3 control-label">Class Category Name</label><div class="col-sm-9"><input type="text" name="class_cat_name" ng-model="classCat.class_cat_name" class="form-control" required ><p ng-show="catDialog.class_cat_name.$invalid && (catDialog.class_cat_name.$touched || catDialog.$submitted)" class="help-block"><i class="fa fa-exclamation-triangle"></i> Class Category Name is required.</p></div></div></ng-form></div><div class="modal-footer"><button type="button" class="btn btn-link" ng-click="cancel()">Cancel</button><button type="button" class="btn btn-primary" ng-click="save()">{{ (edit ? \'Update\' : \'Save\') }}</button></div>')}]),angular.module("eduwebApp").controller("subjectsCtrl",["$scope","$rootScope","apiService","$timeout","$window","$filter",function(a,b,c,d,e,f){a.filters={},a.filters.status="true",a.alert={},a.loading=!0,a.isTeacher="TEACHER"==b.currentUser.user_type;var g=function(){if(void 0===b.classCats){var d="TEACHER"==b.currentUser.user_type?b.currentUser.emp_id:void 0;c.getClassCats(d,function(c){var d=angular.fromJson(c);"success"==d.response&&(b.classCats=a.classCats=d.data)},function(){})}else a.classCats=b.classCats};d(g,1),a.$watch("classCats",function(c,d){b.classCats&&b.classCats.length>0&&(a.filters.class_cat_id=b.classCats[0].class_cat_id,h(b.classCats[0].class_cat_id))});var h=function(e){if(void 0!==a.dataGrid&&($(".fixedHeader-floating").remove(),a.dataGrid.clear(),a.dataGrid.destroy()),a.isTeacher){var f=b.currentUser.emp_id+"/"+e+"/"+a.filters.status;c.getAllTeacherSubjects(f,function(b,c,e){var f=angular.fromJson(b);"success"==f.response?(a.subjects=f.nodata?[]:f.data,d(i,10)):(a.error=!0,a.errMsg=f.data)},k)}else{var f=e+"/"+a.filters.status+"/0";c.getAllSubjects(f,function(b,c,e){var f=angular.fromJson(b);"success"==f.response?(a.subjects=f.nodata?[]:f.data,d(i,10)):(a.error=!0,a.errMsg=f.data)},k)}};a.loadFilter=function(){a.loading=!0,h(a.filters.class_cat_id)};var i=function(){var c=$("#resultsTable");a.dataGrid=c.DataTable({rowReorder:!0,columnDefs:[{orderable:!0,className:"reorder",targets:0},{orderable:!1,targets:"_all"}],paging:!1,destroy:!0,filter:!0,info:!1,initComplete:function(c,d){a.loading=!1,b.loading=!1,a.$apply()},language:{search:"Search Results<br>",searchPlaceholder:"Filter",lengthMenu:"Display _MENU_",emptyTable:"No subjects found."}});var d=$(".navbar-fixed-top").height(),f=$("#body-content .content-fixed-header").height(),g=b.isSmallScreen?22:41;if(new $.fn.dataTable.FixedHeader(a.dataGrid,{header:!0,headerOffset:d+f+g}),a.dataGrid.on("row-reordered",function(a,b,c){j()}),!b.isSmallScreen){var h=$(".dataFilterForm form").width();$("#resultsTable_filter").css("left",h+55)}e.addEventListener("resize",function(){if(b.isSmallScreen=window.innerWidth<768,b.isSmallScreen)$("#resultsTable_filter").css("left",0);else{var a=$(".dataFilterForm form").width();$("#resultsTable_filter").css("left",a-30)}},!1)},j=function(){var d={user_id:b.currentUser.user_id,data:[]};a.dataGrid.rows().every(function(a,b,c){var e={subject_id:this.id(),sort_order:this.data()[0]};d.data.push(e)}),d.data.length>0&&c.setSubjectSortOrder(d,function(){},k)},k=function(b,c){var d=angular.fromJson(b);a.error=!0,a.errMsg=d.data};a.addSubject=function(){var b={subjects:a.subjects};a.openModal("school","subjectForm","md",b)},a.viewSubject=function(b){var c={subjects:a.subjects,subject:b};a.openModal("school","subjectForm","md",c)},a.exportItems=function(){b.wipNotice()},a.$on("refreshSubjects",function(c,e){a.loading=!0,b.loading=!0,void 0!==e&&(a.updated=!0,a.notificationMsg=e.msg),a.refresh(),d(function(){a.alert.expired=!0},2e3),d(function(){a.updated=!1,a.notificationMsg="",a.alert.expired=!1},3e3)}),a.refresh=function(){a.loading=!0,b.loading=!0,h(a.filters.class_cat_id||"")},a.$on("$destroy",function(){a.dataGrid&&(a.dataGrid.off("row-reordered"),$(".fixedHeader-floating").remove(),a.dataGrid.fixedHeader.destroy(),a.dataGrid.clear(),a.dataGrid.destroy()),b.isModal=!1})}]),angular.module("eduwebApp").controller("addEmployeeCtrl",["$scope","$rootScope","$uibModalInstance","apiService","dialogs","FileUploader","data","$parse",function(a,b,c,d,e,f,g,h){a.employee={};var i=moment().format("YYYY-MM-DD HH:MM");a.employee.joined_date={startDate:i},a.employee.country="Kenya",a.employee.status="true",a.initializeController=function(){a.departments=b.allDepts},a.initializeController(),a.cancel=function(){c.dismiss("canceled")},a.$watch("employee.emp_cat",function(c,d){c!=d&&(void 0===c||null===c||""==c?a.departments=b.allDepts:(a.departments=b.allDepts.reduce(function(a,b){return b.category==c.emp_cat_name&&a.push(b),a},[]),a.employee.emp_cat_id=c.emp_cat_id,"Teaching"==c.emp_cat_name&&(a.employee.user_type="TEACHER")))}),a.addEmpCat=function(){var a=e.create("addEmpCategory.html","addEmpCategoryCtrl",{},{size:"sm",backdrop:"static"});a.result.then(function(a){b.empCats=void 0,b.getEmpCats()},function(){})},a.addDept=function(){var c=window.location.host,f=e.create("http://"+c+"/app/school/departmentForm.html","departmentFormCtrl",{emp_cat_name:a.employee.emp_cat.emp_cat_name},{size:"md",backdrop:"static"});f.result.then(function(){d.getDepts(!0,function(c){var d=angular.fromJson(c);"success"==d.response&&(d.nodata?a.departments=[]:(b.allDepts=d.data,a.departments=b.allDepts.reduce(function(b,c){return c.category==a.employee.emp_cat.emp_cat_name&&b.push(c),b},[])))},function(){})},function(){})},a.save=function(c){if(c.$invalid)a.formError=!0,a.errMsg="There were errors found in the form.";else{void 0!==l.queue[0]&&(a.filename=moment()+"_"+l.queue[0].file.name,l.queue[0].file.name=a.filename,l.uploadAll(),a.employee.emp_image=a.filename);var e=angular.copy(a.employee);e.joined_date=moment(a.employee.joined_date.startDate).format("YYYY-MM-DD"),e.user_id=b.currentUser.user_id,e.active="true"==a.employee.status?"t":"f",d.addEmployee(e,j,k)}};var j=function(d,e){var f=angular.fromJson(d);"success"==f.response?(void 0!==l.queue[0]&&(a.employee.emp_image=a.filename),c.close(),b.$emit("employeeAdded",{msg:"Employee was created.",clear:!0})):(a.formError=!0,a.errMsg=f.data)},k=function(){var b=angular.fromJson(response);a.formError=!0,a.errMsg=b.data},l=a.uploader=new f({url:"upload.php",formData:[{dir:"employees"}]})}]),angular.module("eduwebApp").controller("listStaffCtrl",["$scope","$rootScope","apiService","$timeout","$window","$state",function(a,b,c,d,e,f){a.employees=[],a.loading=!0,a.filters={},a.filters.status="true",a.filters.emp_cat_id=""!==f.params.category?f.params.category:null,a.filterEmpCat=""!==f.params.category,a.filters.dept_id=""!==f.params.dept?f.params.dept:null,a.filterDept=""!==f.params.dept,a.gridFilter={},a.gridFilter.filterValue="",null!==f.params.category&&(a.filters.emp_cat=b.empCats.filter(function(a){return a.emp_cat_id==f.params.category?a:void 0})[0]),a.alert={};var g=function(){return'<div class="clickable" ng-click="grid.appScope.viewEmployee(row.entity)">  <div ng-if="row.entity.merge">{{row.entity.title}}</div>  <div ng-if="!row.entity.merge" ng-repeat="(colRenderIndex, col) in colContainer.renderedColumns track by col.colDef.name" class="ui-grid-cell" ng-class="{ \'ui-grid-row-header-cell\': col.isRowHeader }"  ui-grid-cell></div></div>'};a.gridOptions={enableSorting:!0,rowTemplate:g(),rowHeight:24,columnDefs:[{name:"Name",field:"employee_name",enableColumnMenu:!1,sort:{direction:"asc"}},{name:"Category",field:"emp_cat_name",enableColumnMenu:!1},{name:"Department",field:"dept_name",enableColumnMenu:!1}],exporterCsvFilename:"staff.csv",onRegisterApi:function(b){a.gridApi=b,a.gridApi.grid.registerRowsProcessor(a.singleFilter,200),d(function(){a.gridApi.core.handleWindowResize()})}};var h=function(){c.getAllEmployees(!0,function(b){var c=angular.fromJson(b);"success"==c.response?(a.allEmployees=void 0!==c.nondata?[]:c.data,a.employees=a.allEmployees,void 0!==a.currentFilters||a.filterEmpCat||a.filterDept?k(!1):j(a.employees)):j(a.employees)},function(){})},i=function(){a.departments=b.allDepts,h(),setTimeout(function(){var b=$(".full-height.datagrid").height();$("#grid1").css("height",b),a.gridApi.core.handleWindowResize()},100)};d(i,1e3),a.$watch("filters.emp_cat",function(c,e){e!=c&&(void 0===c||null===c||""==c?a.departments=b.allDepts:(a.departments=b.allDepts.reduce(function(a,b){return b.category==c.emp_cat_name&&a.push(b),a},[]),a.filters.emp_cat_id=c.emp_cat_id,d(setSearchBoxPosition,10)))});var j=function(c){a.gridOptions.data=c,a.loading=!1,b.loading=!1};a.filterDataTable=function(){a.gridApi.grid.refresh()},a.clearFilterDataTable=function(){a.gridFilter.filterValue="",a.gridApi.grid.refresh()},a.singleFilter=function(b){var c=new RegExp(a.gridFilter.filterValue,"i");return b.forEach(function(a){var b=!1;["employee_name","emp_cat_name","dept_name"].forEach(function(d){a.entity[d].match(c)&&(b=!0)}),b||(a.visible=!1)}),b},a.filter=function(){a.currentFilters=angular.copy(a.filters),k(!0)};var k=function(b){a.loading=!0;var c=a.allEmployees;void 0!==a.filters.emp_cat_id&&null!==a.filters.emp_cat_id&&""!=a.filters.emp_cat_id&&(c=c.reduce(function(b,c){return c.emp_cat_id.toString()==a.filters.emp_cat_id.toString()&&b.push(c),b},[])),void 0!==a.filters.dept_id&&null!==a.filters.dept_id&&""!=a.filters.dept_id&&(c=c.reduce(function(b,c){return c.dept_id.toString()==a.filters.dept_id.toString()&&b.push(c),b},[])),a.employees=c,j(a.employees)};a.addEmployee=function(){a.openModal("staff","addEmployee","lg")},a.viewEmployee=function(b){a.openModal("staff","viewEmployee","lg",b)},a.exportData=function(){a.gridApi.exporter.csvExport("visible","visible")},a.$on("refreshStaff",function(c,e){a.loading=!0,b.loading=!0,void 0!==e&&(a.updated=!0,a.notificationMsg=e.msg),a.refresh(),d(function(){a.alert.expired=!0},2e3),d(function(){a.updated=!1,a.notificationMsg="",a.alert.expired=!1},3e3)}),a.refresh=function(){a.loading=!0,b.loading=!0,h()},a.$on("$destroy",function(){b.isModal=!1})}]),angular.module("eduwebApp").controller("viewEmployeeCtrl",["$scope","$rootScope","$uibModalInstance","apiService","dialogs","FileUploader","$timeout","data",function(a,b,c,d,e,f,g,h){b.modalLoading=!1,a.tabs=["Personal Info","Employee Info"],a.currentTab=a.tabs[0],a.staffLoading=!0,a.hasChanges=!1;var i;a.filters={},a.edit=!!b.permissions.staff.edit,a.employee={},a.employee.joined_date={startDate:""},a.initLoad=!0,a.initializeController=function(){d.getEmployeeDetails(h.emp_id,function(c){var d=angular.fromJson(c);"success"==d.response&&(a.employee=angular.copy(d.data),a.employee.joined_date={startDate:a.employee.joined_date},a.employee.emp_cat=b.empCats.filter(function(b){return b.emp_cat_id==a.employee.emp_cat_id?b:void 0})[0],a.editUsername=null===d.data.username,a.employee.login_active=null===a.employee.login_active?!0:a.employee.login_active,a.staffLoading=!1,g(function(){a.initLoad=!1},100))})},a.initializeController(),a.getTabContent=function(b){if(a.empForm.$pristine)j(b);else{var c=e.confirm("Changes Where Made","You have made changes to the data on this page. Did you want to save these changes?",{size:"sm"});c.result.then(function(c){a.save(a.empForm,b)},function(c){a.employee=angular.copy(i),a.empForm.$setPristine(),j(b)})}};var j=function(b){a.currentTab=b};a.cancel=function(){c.dismiss("canceled")},a.$watch("employee.emp_cat",function(c,d){c!=d&&(void 0===c||null===c||""==c?a.departments=b.allDepts:(a.departments=b.allDepts.reduce(function(a,b){return b.category==c.emp_cat_name&&a.push(b),a},[]),a.employee.emp_cat_id=c.emp_cat_id))}),a.$watch("uploader.queue[0]",function(b,c){void 0!==b&&a.empForm.$setDirty()}),a.$watch("employee.joined_date",function(b,c){void 0!==b&&(a.initLoad||a.empForm.$setDirty())}),a.save=function(c,e){if(!c.$invalid){if("Personal Info"==a.currentTab){void 0!==m.queue[0]&&(a.filename=a.employee.emp_id+"_"+m.queue[0].file.name,m.queue[0].file.name=a.filename,m.uploadAll());var f={emp_id:a.employee.emp_id,user_id:b.currentUser.user_id,personal:{first_name:a.employee.first_name,middle_name:a.employee.middle_name,last_name:a.employee.last_name,initials:a.employee.initials,id_number:a.employee.id_number,country:a.employee.country,gender:a.employee.gender,dob:a.employee.dob,emp_image:void 0!==m.queue[0]?a.filename:null,active:a.employee.active?"t":"f",telephone:a.employee.telephone,email:a.employee.email,next_of_kin_name:a.employee.next_of_kin_name,next_of_kin_telephone:a.employee.next_of_kin_telephone,next_of_kin_email:a.employee.next_of_kin_email}}}else if("Employee Info"==a.currentTab)var f={emp_id:a.employee.emp_id,user_id:b.currentUser.user_id,employee:{emp_number:a.employee.emp_number,emp_cat_id:a.employee.emp_cat_id,dept_id:a.employee.dept_id,job_title:a.employee.job_title,joined_date:null!==a.employee.joined_date.startDate?moment(a.employee.joined_date.startDate).format("YYYY-MM-DD"):null,qualifications:a.employee.qualifications,experience:a.employee.experience,additional_info:a.employee.additional_info,first_name:a.employee.first_name,middle_name:a.employee.middle_name,last_name:a.employee.last_name,email:a.employee.email,username:a.employee.username,password:a.employee.password,user_type:a.employee.user_type,login_active:a.employee.login_active?"t":"f",login_id:a.employee.login_id}};d.updateEmployee(f,k,l,{tab:e})}};var k=function(c,d,e){var f=angular.fromJson(c);"success"==f.response?(void 0!==m.queue[0]&&(a.employee.emp_image=a.filename),i=angular.copy(a.employee),a.empForm.$setPristine(),void 0!==e.tab&&j(e.tab),b.$emit("employeeAdded",{msg:"Employee was updated.",clear:!0})):(a.error=!0,a.errMsg=f.data)},l=function(b,c){var d=angular.fromJson(b);a.error=!0,a.errMsg=d.data},m=a.uploader=new f({url:"upload.php",formData:[{dir:"employees"}]})}]),angular.module("eduwebApp").controller("addStudentCtrl",["$scope","$rootScope","$uibModalInstance","apiService","dialogs","FileUploader","data","$parse",function(a,b,c,d,e,f,g,h){a.tabs=["Student Details","Parents","Medical History","Fee Items"],a.formNames=["studentDetails","parentGuardians","medicalHistory","feeItems"],a.currentTab="Student Details",a.currentStep=0,a.firstStep=!0,a.forms={},a.student={},a.student.guardians=[];var i=moment().format("YYYY-MM-DD HH:MM");a.student.admission_date={startDate:i},a.student.student_category="Regular",a.student.nationality="Kenya",a.student.status="true",a.student.other_medical_conditions="false",a.student.hospitalized="false",a.student.current_medical_treatment="false",a.showSeparationAge=!1,a.feeItemSelection=[],a.optFeeItemSelection=[],a.conditionSelection=[],a.formError=!1;var j=["new_student","admission_number","current_class","last_name","first_name","dob","gender","emergency_name","emergency_relationship","emergency_telephone"],k=["father_last_name","father_first_name","father_id_number","father_telephone","father_email","mother_last_name","mother_first_name","mother_id_number","mother_telephone","mother_email"],l=["payment_method","installment_option"];a.submitted=!1;var m=function(){var c=b.currentUser.settings["Student Categories"];a.studentCats=c.split(",");var e=b.currentUser.settings["Payment Options"];a.paymentOptions=e.split(",");var f=b.currentUser.settings["Guardian Relationships"];a.relationships=f.split(",");var g=b.currentUser.settings["Marital Statuses"];a.maritalStatuses=g.split(",");var h=b.currentUser.settings.Titles;a.titles=h.split(",");var i=b.currentUser.settings["Medical Conditions"];i=i.split(","),a.medicalConditions=i.reduce(function(a,b){return a.push({medical_condition:b,age:"",comments:""}),a},[]),n(),d.getTansportRoutes({},function(b){var c=angular.fromJson(b);"success"==c.response&&(a.transportRoutes=c.data)},function(){}),d.getAllClasses({},function(b){var c=angular.fromJson(b);"success"==c.response&&(a.allClasses=c.data)},function(){})};setTimeout(m,10);var n=function(b){d.getFeeItems(!0,function(c){var d=angular.fromJson(c);"success"==d.response&&(a.feeItems=o(d.data.required_items),a.allFeeItems=a.feeItems,a.optFeeItems=o(d.data.optional_items),a.allOptFeeItems=a.optFeeItems,b&&(a.feeItems=q(a.allFeeItems)))},function(){})},o=function(a){return a.map(function(a){if(null!==a.class_cats_restriction&&"{}"!=a.class_cats_restriction){var b=a.class_cats_restriction.slice(1,-1);a.class_cats_restriction=b.split(",")}return a.amount=void 0,a.payment_method=void 0,a})};a.getStep=function(a,b){b.$pristine?p(a,b):(b.$setDirty(),b.$setSubmitted(),b.$invalid||p(a,b))};var p=function(b,c){a.currentStep="next"==b?a.currentStep+1:a.currentStep-1,a.getTabContent(a.tabs[a.currentStep],c)};a.getTabContent=function(b,c){a.forms[a.currentTab]=angular.copy(c),a.submitted&&r(),a.currentTab=b,a.currentStep=a.tabs.indexOf(b),a.currentForm=a.formNames[a.currentStep],a.lastStep=!1,a.firstStep=!1,a.currentTab==a.tabs[0]?a.firstStep=!0:a.currentTab==a.tabs[a.tabs.length-1]&&(a.lastStep=!0)},a.cancel=function(){c.dismiss("canceled")},a.$watch("student.payment_method",function(a,b){}),a.$watch("student.new_student",function(b,c){b!=c&&(a.feeItems=q(a.allFeeItems))}),a.$watch("student.current_class",function(b,c){b!=c&&(a.feeItems=q(a.allFeeItems),a.optFeeItems=q(a.allOptFeeItems))}),a.$watch("student.transport_route",function(b,c){b!=c&&angular.forEach(a.optFeeItemSelection,function(a,c){"Transport"==a.fee_item&&(a.amount=b.amount)})}),a.$watch("student.admission_number",function(b,c){b!=c&&void 0!==b&&(a.uniqueAdmNumber=void 0,a.checkAdmNumber(b))});var q=function(b){var c=[];return c="true"==a.student.new_student?b:b.filter(function(a){return a.new_student_only?void 0:a}),void 0!==a.student.current_class&&(c=c.filter(function(b){return null===b.class_cats_restriction||"{}"==b.class_cats_restriction?b:b.class_cats_restriction.indexOf(a.student.current_class.class_cat_id.toString())>-1?b:void 0})),c};a.toggleFeeItem=function(b,c){var d="optional"==c?a.optFeeItemSelection:a.feeItemSelection,e=d.indexOf(b);e>-1?(d.splice(e,1),b.amount=void 0,b.payment_method=void 0,"Transport"==b.fee_item&&(a.showTransport=!1)):(b.amount=b.default_amount,b.payment_method=a.student.payment_method,d.push(b),"Transport"==b.fee_item&&(a.showTransport=!0))},a.toggleMedicalCondition=function(b){var c=a.conditionSelection.indexOf(b);c>-1?a.conditionSelection.splice(c,1):a.conditionSelection.push(b)},a.hasErrors=function(b){switch(b){case"Student Details":return a.detailsErrors>0;case"Parents":return a.guardianErrors>0;case"Medical History":return a.medicalErrors>0;case"Fee Items":return a.feeErrors>0}},a.getErrorCount=function(b){switch(b){case"Student Details":return a.detailsErrors;case"Parents":return a.guardianErrors;case"Medical History":return a.medicalErrors;case"Fee Items":return a.feeErrors}},a.save=function(c){if(a.forms[a.currentTab]=angular.copy(c),a.submitted=!0,a.error=!1,a.errMsg="",c.$invalid)a.formError=!0,a.errMsg="There were errors found in the form.",r();else{void 0!==v.queue[0]&&(a.filename=moment()+"_"+v.queue[0].file.name,v.queue[0].file.name=a.filename,v.uploadAll(),a.student.student_image=a.filename),a.student.has_medical_conditions=!!(a.conditionSelection.length>0||a.student.other_medical_conditions);var e=angular.copy(a.student);e.admission_date=moment(a.student.admission_date.startDate).format("YYYY-MM-DD"),e.current_class=a.student.current_class.class_id,e.new_student=a.student.new_student?"t":"f",e.medicalConditions=a.conditionSelection,e.feeItems=a.feeItemSelection,e.optFeeItems=a.optFeeItemSelection,e.user_id=b.currentUser.user_id,d.postStudent(e,s,u)}},a.checkAdmNumber=function(b){d.checkAdmNumber(b,function(b){var c=angular.fromJson(b);"success"==c.response&&(a.uniqueAdmNumber=!!c.nodata)},t)};var r=function(){a.detailsErrors=0,a.guardianErrors=0,a.feeErrors=0,a.formErrorList=[],angular.forEach(a.forms,function(b,c){for(var d in b.$error)for(var e=0;e<b.$error[d].length;e++)a.formErrorList.push(b.$error[d][e].$name+" is required."),j.indexOf(b.$error[d][e].$name)>-1?a.detailsErrors++:k.indexOf(b.$error[d][e].$name)>-1?a.guardianErrors++:l.indexOf(b.$error[d][e].$name)>-1&&a.feeErrors++})};a.addFeeItem=function(){var b=window.location.host,c=e.create("http://"+b+"/app/fees/feeItemForm.html","feeItemFormCtrl",void 0,{size:"md",backdrop:"static"});c.result.then(function(b){"t"==b.optional?a.optFeeItems.push(b):a.feeItems.push(b)},function(){})};var s=function(d,e){var f=angular.fromJson(d);"success"==f.response?(void 0!==v.queue[0]&&(a.student.student_image=a.filename),c.close(),b.$emit("studentAdded",{msg:"Student was created.",clear:!0})):(a.formError=!0,a.errMsg=f.data)},t=function(b,c){var d=angular.fromJson(b);a.error=!0;var e=d.data.indexOf('"U_id_number"')>-1?"Duplicate ID Number for Guardian.":d.data;a.errMsg=e},u=function(b){var c=angular.fromJson(b);a.formError=!0,c.data.indexOf('"U_admission_number"')>-1&&(a.formErrorList=[],a.detailsErrors=1,a.formErrorList.push("You have entered a duplicate Admission Number."));var d=c.data.indexOf('"U_admission_number"')>-1?"You have entered a duplicate Admission Number.":c.data;a.errMsg=d},v=a.uploader=new f({url:"upload.php",formData:[{dir:"students"}]});a.addGuardian=function(){var b={student_id:a.student.student_id,action:"add"},c=e.create("addParent.html","addParentCtrl",b,{size:"lg",backdrop:"static"});c.result.then(function(b){a.student.guardians.push(b)},function(){})},a.editGuardian=function(b){var c={student_id:a.student.student_id,guardian:b,action:"edit"},d=e.create("addParent.html","addParentCtrl",c,{size:"lg",backdrop:"static"});d.result.then(function(b){angular.forEach(a.student.guardians,function(c,d){c.guardian_id==b.guardian_id&&(a.student.guardians[d]=b)})},function(){})},a.deleteGuardian=function(b,c,f){var g=e.confirm("Please Confirm","Are you sure you want to delete <b>"+c.parent_full_name+"</b> as a parent/guardian of "+a.student.student_name+"? <br><br><b><i>(THIS CAN NOT BE UNDONE)</i></b>",{size:"sm"});g.result.then(function(e){d.deleteGuardian(b+"/"+c.guardian_id,function(b,c,d){var e=angular.fromJson(b);"success"==e.response?a.student.guardians.splice(d.index,1):(a.error=!0,a.errMsg=e.data)},t,{index:f})})}}]),angular.module("eduwebApp").controller("listStudentsCtrl",["$scope","$rootScope","apiService","$timeout","$window","$state",function(a,b,c,d,e,f){a.filters={},a.filters.status="true";var g=null,h=!1;a.filters.date={startDate:null,endDate:null},a.students=[],a.filterShowing=!1,a.toolsShowing=!1;var i=!0,j=!1;a.loading=!0,b.modalLoading=!1,a.alert={},a.gridFilter={},a.gridFilter.filterValue="",a.isTeacher="TEACHER"==b.currentUser.user_type;var k=function(){return'<div class="clickable" ng-class="{\'alert-danger\': row.entity.balance > 0, \'alert-success\' : row.entity.balance == 0}" ng-click="grid.appScope.viewStudent(row.entity)">  <div ng-if="row.entity.merge">{{row.entity.title}}</div>  <div ng-if="!row.entity.merge" ng-repeat="(colRenderIndex, col) in colContainer.renderedColumns track by col.colDef.name" class="ui-grid-cell" ng-class="{ \'ui-grid-row-header-cell\': col.isRowHeader }"  ui-grid-cell></div></div>'};a.gridOptions={enableSorting:!0,rowTemplate:k(),rowHeight:24,columnDefs:[{name:"Name",field:"student_name",enableColumnMenu:!1,sort:{direction:"asc"}},{name:"Class",field:"class_name",enableColumnMenu:!1},{name:"Admission Number",field:"admission_number",enableColumnMenu:!1},{name:"Admission Date",field:"admission_date",type:"date",cellFilter:"date",enableColumnMenu:!1}],exporterCsvFilename:"students.csv",onRegisterApi:function(b){a.gridApi=b,a.gridApi.grid.registerRowsProcessor(a.singleFilter,200),d(function(){a.gridApi.core.handleWindowResize()})}},a.$watch("filters.date",function(a,b){a!=b&&(h=a!==g,g=a)});var l=function(){if(a.isTeacher?c.getClassCats(b.currentUser.emp_id,function(d){var e=angular.fromJson(d);"success"==e.response&&(b.classCats=e.data,void 0===b.allClasses?c.getAllClasses({},function(c){var d=angular.fromJson(c);"success"==d.response&&(a.classes=d.data,m("true",!1),null!==f.params.class_cat_id?(a.filters.class_cat_id=""!==f.params.class_cat_id?f.params.class_cat_id:null,a.filterClassCat=""!==f.params.class_cat_id,a.filters.class_id=""!==f.params.class_id?f.params.class_id:null,a.filterClass=""!==f.params.class_id):1==b.classCats.length&&(a.filters.class_cat_id=b.classCats[0].class_cat_id))},o):(a.classes=b.allClasses,m("true",!1),null!==f.params.class_cat_id?(a.filters.class_cat_id=""!==f.params.class_cat_id?f.params.class_cat_id:null,a.filterClassCat=""!==f.params.class_cat_id,a.filters.class_id=""!==f.params.class_id?f.params.class_id:null,a.filterClass=""!==f.params.class_id):1==b.classCats.length&&(a.filters.class_cat_id=b.classCats[0].class_cat_id)))},o):void 0===b.allClasses?c.getAllClasses({},function(b){var c=angular.fromJson(b);"success"==c.response&&(a.classes=c.data,m("true",!1),a.filters.class_cat_id=""!==f.params.class_cat_id?f.params.class_cat_id:null,a.filterClassCat=""!==f.params.class_cat_id,a.filters.class_id=""!==f.params.class_id?f.params.class_id:null,a.filterClass=""!==f.params.class_id)},o):(a.classes=b.allClasses,a.filters.class_cat_id=""!==f.params.class_cat_id?f.params.class_cat_id:null,a.filterClassCat=""!==f.params.class_cat_id,a.filters.class_id=""!==f.params.class_id?f.params.class_id:null,a.filterClass=""!==f.params.class_id,m("true",!1)),void 0===b.terms){var d=moment().format("YYYY");c.getTerms(d,function(c){var d=angular.fromJson(c);"success"==d.response&&(a.terms=d.data,b.terms=d.data,b.setTermRanges(d.data))},function(){})}else a.terms=b.terms,b.setTermRanges(a.terms);setTimeout(function(){var b=$(".full-height.datagrid").height();$("#grid1").css("height",b),a.gridApi.core.handleWindowResize()},100)};d(l,1);var m=function(d,e){var f=angular.copy(a.filters);if(null!==f.date.startDate)var g=moment(f.date.startDate).format("YYYY-MM-DD")+"/"+moment(f.date.endDate).format("YYYY-MM-DD");if(a.isTeacher){var h=b.currentUser.emp_id+"/"+d;g&&(h+="/"+g),c.getTeacherStudents(h,n,o,{filtering:e})}else{var h=d;g&&(h+="/"+g),c.getAllStudents(h,n,o,{filtering:e,status:d})}},n=function(c,d,e){var f=angular.fromJson(c);if("success"==f.response){if(f.nodata)var g=[];else var g=b.formatStudentData(f.data);"false"==e.status?(a.formerStudents=g,q(!1)):(a.allStudents=g,a.students=g,(a.filterClassCat||a.filterClass)&&q(),p(a.students))}else a.error=!0,a.errMsg=f.data},o=function(b,c){var d=angular.fromJson(b);a.error=!0,a.errMsg=d.data},p=function(c){a.gridOptions.data=a.students,a.loading=!1,b.loading=!1};a.filterDataTable=function(){a.gridApi.grid.refresh()},a.clearFilterDataTable=function(){a.gridFilter.filterValue="",a.gridApi.grid.refresh()},a.singleFilter=function(b){var c=new RegExp(a.gridFilter.filterValue,"i");return b.forEach(function(a){var b=!1;["student_name","class_name","admission_number"].forEach(function(d){a.entity[d].match(c)&&(b=!0)}),b||(a.visible=!1)}),b},a.$watch("filters.class_cat_id",function(c,d){d!=c&&(void 0===c||null===c||""==c?a.classes=b.allClasses:a.classes=b.allClasses.reduce(function(a,b){return b.class_cat_id==c&&a.push(b),a},[]))}),a.toggleFilter=function(){a.filterShowing=!a.filterShowing,a.filterShowing||a.toolsShowing?$("#resultsTable_filter").hide():d(function(){$("#resultsTable_filter").show()},500)},a.toggleTools=function(){a.toolsShowing=!a.toolsShowing,a.filterShowing||a.toolsShowing?$("#resultsTable_filter").hide():d(function(){$("#resultsTable_filter").show()},500)},a.loadFilter=function(){a.loading=!0,j=!0,"false"==a.filters.status&&void 0===a.formerStudents?m("false",!0):h?m(i,!0):q(!0),i=a.filters.status};var q=function(b){var c="false"==a.filters.status?a.formerStudents:a.allStudents;void 0!==a.filters.class_cat_id&&null!==a.filters.class_cat_id&&""!==a.filters.class_cat_id&&(c=c.reduce(function(b,c){return c.class_cat_id.toString()==a.filters.class_cat_id.toString()&&b.push(c),b},[])),void 0!==a.filters.class_id&&null!==a.filters.class_id&&""!==a.filters.class_id&&(c=c.reduce(function(b,c){return c.class_id.toString()==a.filters.class_id.toString()&&b.push(c),b},[])),a.students=c,p(a.students)};a.addStudent=function(){a.openModal("students","addStudent","lg")},a.viewStudent=function(b){a.openModal("students","viewStudent","lg",b)},a.importStudents=function(){b.wipNotice()},a.exportData=function(){a.gridApi.exporter.csvExport("visible","visible")},a.$on("refreshStudents",function(c,e){a.loading=!0,b.loading=!0,void 0!==e&&(a.updated=!0,a.notificationMsg=e.msg),a.refresh(),d(function(){a.alert.expired=!0},2e3),d(function(){a.updated=!1,a.notificationMsg="",a.alert.expired=!1},3e3)}),a.refresh=function(){a.loading=!0,b.loading=!0,m(i,j)},a.$on("$destroy",function(){b.isModal=!1})}]),angular.module("eduwebApp").controller("viewStudentCtrl",["$scope","$rootScope","$uibModalInstance","apiService","dialogs","FileUploader","$timeout","$filter","data",function(a,b,c,d,e,f,g,h,i){
b.modalLoading=!1,a.tabs="TEACHER"==b.currentUser.user_type?["Details","Family","Medical History","Exams","Report Cards"]:["Details","Family","Medical History","Fees","Exams","Report Cards"],a.feeTabs=["Fee Summary","Invoices","Payments Received","Fee Items"],a.currentTab=a.tabs[0],a.currentFeeTab=a.feeTabs[0],a.hasChanges=!1,a.currency=b.currentUser.settings.Currency;var j;a.filters={},a.studentLoading=!0,a.edit=!!b.permissions.students.edit,a.parentPortalAcitve=!(!b.currentUser.settings["Parent Portal"]||"Yes"!=b.currentUser.settings["Parent Portal"]),a.feeItemSelection=[],a.optFeeItemSelection=[],a.conditionSelection=[],a.student={},a.student.admission_date={},a.initLoad=!0,a.studentForm={},a.gridFilter={},a.gridFilter.filterValue="",a.isTeacher="TEACHER"==b.currentUser.user_type;var k=function(){return'<div class="clickable" ng-class="{\'alert-danger\': row.entity.balance<0 && row.entity.past_due, \'alert-success\':row.entity.balance==0, \'canceled\': row.entity.canceled}">  <div ng-if="row.entity.merge">{{row.entity.title}}</div>  <div ng-if="!row.entity.merge" ng-repeat="(colRenderIndex, col) in colContainer.renderedColumns track by col.colDef.name" class="ui-grid-cell" ng-class="{ \'ui-grid-row-header-cell\': col.isRowHeader }"  ui-grid-cell></div></div>'},l=function(){return'<div class="clickable" ng-class="{\'alert-warning\': row.entity.replacement_payment, \'canceled\': row.entity.reversed }">  <div ng-if="row.entity.merge">{{row.entity.title}}</div>  <div ng-if="!row.entity.merge" ng-repeat="(colRenderIndex, col) in colContainer.renderedColumns track by col.colDef.name" class="ui-grid-cell" ng-class="{ \'ui-grid-row-header-cell\': col.isRowHeader }"  ui-grid-cell></div></div>'},m=function(){return'<div class="clickable"  ng-class="{\'canceled\':row.entity.amount==0 }">  <div ng-if="row.entity.merge">{{row.entity.title}}</div>  <div ng-if="!row.entity.merge" ng-repeat="(colRenderIndex, col) in colContainer.renderedColumns track by col.colDef.name" class="ui-grid-cell" ng-class="{ \'ui-grid-row-header-cell\': col.isRowHeader }"  ui-grid-cell></div></div>'},n=["Amount ( "+a.currency+" )","Paid ( "+a.currency+" )","Balance ( "+a.currency+" )","Amount Applied ( "+a.currency+" )","Amount Available ( "+a.currency+" )"];a.feesGrid={enableSorting:!0,rowTemplate:m(),rowHeight:24,columnDefs:[{name:"Item",field:"fee_item",enableColumnMenu:!1},{name:"Payment Method",field:"payment_method",enableColumnMenu:!1},{name:n[0],field:"total_due",cellFilter:'currency:""',cellClass:"center",headerCellClass:"center",enableColumnMenu:!1},{name:n[1],field:"total_paid",cellFilter:'currency:""',cellClass:"center",headerCellClass:"center",enableColumnMenu:!1},{name:n[2],field:"balance",cellFilter:"numeric",cellClass:"center",headerCellClass:"center",enableColumnMenu:!1,sort:{direction:"asc"}}],onRegisterApi:function(b){a.gridApi=b,g(function(){a.gridApi.core.handleWindowResize()})}},a.invoiceGrid={enableSorting:!0,rowTemplate:k(),rowHeight:34,columnDefs:[{name:"Invoice",field:"inv_id",headerCellClass:"center",cellClass:"center",enableColumnMenu:!1,width:60,cellTemplate:'<div class="ui-grid-cell-contents" ng-click="grid.appScope.getInvoice(row.entity)"><i class="glyphicon glyphicon-file"></i><br>{{row.entity.inv_id}}</div>'},{name:"Invoice Date",field:"inv_date",type:"date",cellFilter:"date",enableColumnMenu:!1,cellTemplate:'<div class="ui-grid-cell-contents"  ng-click="grid.appScope.viewInvoice(row.entity)">{{row.entity.inv_date|date}}</div>'},{name:"Due Date",field:"due_date",type:"date",cellFilter:"date",enableColumnMenu:!1,sort:{direction:"desc"},cellTemplate:'<div class="ui-grid-cell-contents" ng-click="grid.appScope.viewInvoice(row.entity)">{{row.entity.due_date|date}}</div>'},{name:n[0],field:"total_due",cellFilter:'currency:""',cellClass:"center",headerCellClass:"center",enableColumnMenu:!1,cellTemplate:'<div class="ui-grid-cell-contents" ng-click="grid.appScope.viewInvoice(row.entity)">{{row.entity.total_due|currency:""}}</div>'},{name:n[1],field:"total_paid",cellFilter:'currency:""',cellClass:"center",headerCellClass:"center",enableColumnMenu:!1,cellTemplate:'<div class="ui-grid-cell-contents" ng-click="grid.appScope.viewInvoice(row.entity)">{{row.entity.total_paid|currency:""}}</div>'},{name:n[2],field:"balance",cellFilter:"numeric",cellClass:"center",headerCellClass:"center",enableColumnMenu:!1,cellTemplate:'<div class="ui-grid-cell-contents" ng-click="grid.appScope.viewInvoice(row.entity)">{{row.entity.balance|numeric}}</div>'}],onRegisterApi:function(b){a.gridApi=b,g(function(){a.gridApi.core.handleWindowResize()})}},a.paidGrid={enableSorting:!0,rowTemplate:l(),rowHeight:34,columnDefs:[{name:"Receipt",field:"payment_id",headerCellClass:"center",cellClass:"center",enableColumnMenu:!1,width:60,cellTemplate:'<div class="ui-grid-cell-contents" ng-click="grid.appScope.getReceipt(row.entity)"><i class="glyphicon glyphicon-file"></i><br>{{row.entity.receipt_number}}</div>'},{name:"Payment Date",field:"payment_date",enableColumnMenu:!1,type:"date",sort:{direction:"desc"},cellTemplate:'<div class="ui-grid-cell-contents" ng-click="grid.appScope.viewPayment(row.entity)">{{row.entity.payment_date|date}}</div>'},{name:"Payment Method",field:"payment_method",enableColumnMenu:!1,cellTemplate:'<div class="ui-grid-cell-contents" ng-click="grid.appScope.viewPayment(row.entity)">{{row.entity.payment_method}}</div>'},{name:n[0],field:"amount",enableColumnMenu:!1,headerCellClass:"center",cellClass:"center",cellTemplate:'<div class="ui-grid-cell-contents" ng-click="grid.appScope.viewPayment(row.entity)">{{row.entity.amount|currency:""}}</div>'},{name:"Applied To",field:"applied_to",enableColumnMenu:!1,width:200,cellTemplate:'<div class="ui-grid-cell-contents" ng-click="grid.appScope.viewPayment(row.entity)" ng-bind-html="row.entity.applied_to"></div>'},{name:"Amount Unapplied",field:"unapplied_amount",enableColumnMenu:!1,headerCellClass:"center",cellClass:"center",cellTemplate:'<div class="ui-grid-cell-contents" ng-click="grid.appScope.viewPayment(row.entity)" ng-class="{\'alert-danger\': row.entity.unapplied_amount>0}">{{row.entity.unapplied_amount|currency:""}}</div>'},{name:"Replacement?",field:"replacement",headerCellClass:"center",cellClass:"center",enableColumnMenu:!1,cellTemplate:'<div class="ui-grid-cell-contents" ng-click="grid.appScope.viewPayment(row.entity)">{{row.entity.replacement}}</div>'},{name:"Reversed?",field:"reverse",headerCellClass:"center",cellClass:"center",enableColumnMenu:!1,cellTemplate:'<div class="ui-grid-cell-contents" ng-click="grid.appScope.viewPayment(row.entity)">{{row.entity.reverse}}</div>'}],onRegisterApi:function(b){a.gridApi=b,g(function(){a.gridApi.core.handleWindowResize()})}},a.creditGrid={enableSorting:!0,rowTemplate:m(),rowHeight:34,columnDefs:[{name:"Receipt",field:"payment_id",headerCellClass:"center",cellClass:"center",enableColumnMenu:!1,width:60,cellTemplate:'<div class="ui-grid-cell-contents" ng-click="grid.appScope.getReceipt(row.entity)"><i class="glyphicon glyphicon-file"></i><br>{{row.entity.receipt_number}}</div>'},{name:"Payment Date",field:"payment_date",enableColumnMenu:!1,type:"date",sort:{direction:"desc"},cellTemplate:'<div class="ui-grid-cell-contents" ng-click="grid.appScope.viewPayment(row.entity)">{{row.entity.payment_date|date}}</div>'},{name:"Payment Method",field:"payment_method",enableColumnMenu:!1,cellTemplate:'<div class="ui-grid-cell-contents" ng-click="grid.appScope.viewPayment(row.entity)">{{row.entity.payment_method}}</div>'},{name:n[0],field:"amount",cellFilter:'currency:""',enableColumnMenu:!1,headerCellClass:"center",cellClass:"center",cellTemplate:'<div class="ui-grid-cell-contents" ng-click="grid.appScope.viewPayment(row.entity)">{{row.entity.amount|currency:""}}</div>'}],onRegisterApi:function(b){a.gridApi=b,g(function(){a.gridApi.core.handleWindowResize()})}};var o=function(){a.getStudentDetails(i.student_id);var c=b.currentUser.settings["Student Categories"];a.studentCats=c.split(",");var e=b.currentUser.settings["Payment Options"];a.paymentOptions=e.split(",");var f=b.currentUser.settings["Guardian Relationships"];a.relationships=f.split(",");var g=b.currentUser.settings["Marital Statuses"];a.maritalStatuses=g.split(",");var h=b.currentUser.settings.Titles;a.titles=h.split(",");var j=b.currentUser.settings["Medical Conditions"];j=j.split(","),a.medicalConditions=j.reduce(function(a,b){return a.push({medical_condition:b,age:"",comments:""}),a},[]),d.getTansportRoutes({},function(b){var c=angular.fromJson(b);"success"==c.response&&(a.transportRoutes=c.data)},function(){})};setTimeout(o,100),a.getStudentDetails=function(c){d.getStudentDetails(c,function(c){var d=angular.fromJson(c);if("success"==d.response){var e=b.formatStudentData([d.data]);a.currentClass=b.allClasses.filter(function(a){return a.class_id==e[0].class_id?a:void 0}),e[0].current_class=a.currentClass[0],a.student=e[0],a.student.admission_date={startDate:a.student.admission_date},j=angular.copy(a.student),a.studentLoading=!1,g(function(){a.studentForm.$setUntouched(),a.studentForm.$setPristine()},10),p()}})};var p=function(){d.getFeeItems(!0,function(b){var c=angular.fromJson(b);"success"==c.response&&(a.feeItems=E(c.data.required_items),a.allFeeItems=a.feeItems,a.feeItems=G(a.allFeeItems),a.feeItemSelection=F(a.feeItems),a.optFeeItems=E(c.data.optional_items),a.allOptFeeItems=a.optFeeItems,a.optFeeItems=G(a.allOptFeeItems),a.optFeeItemSelection=F(a.optFeeItems),a.initLoad=!1)},function(){})};a.getTabContent=function(b){if(a.studentForm.$pristine)q(b);else{var c=e.confirm("Changes Where Made","You have made changes to the data on this page. Did you want to save these changes?",{size:"sm"});c.result.then(function(c){a.save(a.studentForm,b)},function(c){a.student=angular.copy(j),g(function(){a.studentForm.$setUntouched(),a.studentForm.$setPristine()},10),q(b)})}};var q=function(c){if("Fees"==c)a.loading=!0,a.currentFeeTab="Fee Summary",s();else if("Exams"==c){if(a.loading=!0,a.filters["class"]=a.student.current_class,a.filters.class_cat_id=a.student.class_cat_id,a.filters.class_id=a.student.class_id,a.classes=b.allClasses.filter(function(b){return b.class_cat_id==a.filters.class_cat_id?b:void 0}),void 0===b.terms)d.getTerms(void 0,r,function(){});else{a.terms=b.terms;var e=a.terms.filter(function(a){return a.current_term?a:void 0})[0];a.filters.term_id=e.term_id,a.getExams()}void 0===b.examTypes?d.getExamTypes(a.student.class_cat_id,function(c){var d=angular.fromJson(c);"success"==d.response&&(a.examTypes=d.data,b.examTypes=d.data)},function(){}):a.examTypes=b.examTypes}else if("Report Cards"==c){if(a.loading=!0,a.filters["class"]=a.student.current_class,a.filters.class_cat_id=a.student.class_cat_id,a.filters.class_id=a.student.class_id,a.classes=b.allClasses.filter(function(b){return b.class_cat_id==a.filters.class_cat_id?b:void 0}),void 0===b.terms){var f=moment().format("YYYY");d.getTerms(f,r,function(){})}else{a.terms=b.terms;var e=a.terms.filter(function(a){return a.current_term?a:void 0})[0];a.filters.term_id=e.term_id}a.getStudentReportCards()}a.currentTab=c},r=function(c,d){var e=angular.fromJson(c);if("success"==e.response){a.terms=e.data,b.terms=e.data;var f=a.terms.filter(function(a){return a.current_term?a:void 0})[0];a.filters.term_id=f.term_id,a.getExams()}};a.cancel=function(){c.dismiss("canceled")},a.$watch("student.current_class",function(b,c){b!=c&&(a.student.class_id=a.student.current_class.class_id,a.student.class_name=a.student.current_class.class_name,a.student.class_cat_id=a.student.current_class.class_cat_id,void 0!==a.allFeeItems&&(a.feeItems=G(a.allFeeItems),a.optFeeItems=G(a.allOptFeeItems)))}),a.$watch("uploader.queue[0]",function(b,c){void 0!==b&&a.studentForm.$setDirty()}),a.$watch("student.admission_date",function(b,c){void 0!==b&&(a.initLoad||a.studentForm.$setDirty())}),a.addGuardian=function(){var b={student_id:a.student.student_id,action:"add"},c=e.create("addParent.html","addParentCtrl",b,{size:"lg",backdrop:"static"});c.result.then(function(b){a.student.guardians.push(b)},function(){})},a.editGuardian=function(b){var c={student_id:a.student.student_id,guardian:b,action:a.edit?"edit":"view"},d=e.create("addParent.html","addParentCtrl",c,{size:"lg",backdrop:"static"});d.result.then(function(b){angular.forEach(a.student.guardians,function(c,d){c.guardian_id==b.guardian_id&&(a.student.guardians[d]=b)})},function(){})},a.deleteGuardian=function(b,c,f){var g=e.confirm("Please Confirm","Are you sure you want to delete <b>"+c.parent_full_name+"</b> as a parent/guardian of "+a.student.student_name+"? <br><br><b><i>(THIS CAN NOT BE UNDONE)</i></b>",{size:"sm"});g.result.then(function(e){d.deleteGuardian(b+"/"+c.guardian_id,function(b,c,d){var e=angular.fromJson(b);"success"==e.response?a.student.guardians.splice(d.index,1):(a.error=!0,a.errMsg=e.data)},L,{index:f})})},a.sendMessage=function(a){},a.addMedicalHistory=function(){var b={student_id:a.student.student_id,medicalHistory:a.student.medical_history,action:"add"},c=e.create("addMedicalHistory.html","addMedicalHistoryCtrl",b,{size:"md",backdrop:"static"});c.result.then(function(b){angular.forEach(b,function(b,c){a.student.medical_history.push(b)})},function(){})},a.editMedical=function(b){if(a.edit){var c={student_id:a.student.student_id,medicalCondition:b,action:"edit"},d=e.create("updateMedicalCondition.html","updateMedicalConditionCtrl",c,{size:"md",backdrop:"static"});d.result.then(function(b){angular.forEach(a.student.medical_history,function(c,d){c.medical_id==b.medical_id&&(a.student.medical_history[d]=b)})},function(){})}},a.deleteMedical=function(b,c){var f=e.confirm("Please Confirm","Are you sure you want to delete <b>"+b.illness_condition+"</b> as a medical condition for this student? <br><br><b><i>(THIS CAN NOT BE UNDONE)</i></b>",{size:"sm"});f.result.then(function(e){d.deleteMedicalCondition(b.medical_id,function(b,c,d){var e=angular.fromJson(b);"success"==e.response?a.student.medical_history.splice(d.index,1):(a.error=!0,a.errMsg=e.data)},L,{index:c})})},a.$watch("student.payment_method",function(a,b){}),a.$watch("student.transport_route",function(b,c){b!=c&&angular.forEach(a.optFeeItemSelection,function(a,c){"Transport"==a.fee_item&&(a.amount=b.amount)})}),a.getFeeTabContent=function(b){a.currentFeeTab=b,"Fee Summary"==b?A(a.fees):"Invoices"==b?(a.loading=!0,t()):"Payments Received"==b?(a.loading=!0,u()):"Credits"==b&&(a.loading=!0,v())};var s=function(){d.getStudentBalance(a.student.student_id,w,L)},t=function(){d.getStudentInvoices(a.student.student_id,x,L)},u=function(){d.getStudentPayments(a.student.student_id,y,L)},v=function(){d.getStudentCredits(a.student.student_id,z,L)},w=function(b,c){a.loading=!1;var d=angular.fromJson(b);"success"==d.response&&(void 0===d.nodata?(a.feeSummary=angular.copy(d.data.fee_summary),a.balanceDue=a.feeSummary.balance,a.totalPaid=a.feeSummary.total_paid,a.fees=angular.copy(d.data.fees),a.nofeeSummary=!1):(a.feeSummary=[],a.fees=[],a.nofeeSummary=!0),"Fee Summary"==a.currentFeeTab&&A(a.fees))},x=function(b,c){a.loading=!1;var d=angular.fromJson(b);"success"==d.response&&(a.invoices=d.nodata?{}:angular.copy(d.data),"Invoices"==a.currentFeeTab&&B(a.invoices))};a.addInvoice=function(){var b=window.location.host,c=e.create("http://"+b+"/app/fees/invoiceForm.html","invoiceFormCtrl",{selectedStudent:a.student},{size:"lg",backdrop:"static"});c.result.then(function(a){s(),t()},function(){angular.equals(a.invoice,"")&&(a.errMsg="You did not enter an invoice!")})},a.viewInvoice=function(b){b.student_name=a.student.student_name;var c=window.location.host,d=e.create("http://"+c+"/app/fees/invoiceDetails.html","invoiceDetailsCtrl",b,{size:"md",backdrop:"static"});d.result.then(function(a){s(),t()},function(){s(),t()})},a.getInvoice=function(b){var c={student:a.student,invoice:b},d=window.location.host;e.create("http://"+d+"/app/fees/invoice.html","invoiceCtrl",c,{size:"md",backdrop:"static"})},a.printStatement=function(){var b={student:a.student,invoices:a.invoices,payments:a.payments,credits:a.credits},c=window.location.host,d=window.open("http://"+c+"/#/fees/statement/print");d.printCriteria=b};var y=function(c,d){a.loading=!1;var e=angular.fromJson(c);if("success"==e.response){var f=e.nodata?[]:angular.copy(e.data);a.payments=f.map(function(a){return a.replacement=a.replacement_payment?"Yes":"No",a.reverse=a.reversed?"Yes":"No",a.receipt_number=b.zeroPad(a.payment_id,5),a}),"Payments Received"==a.currentFeeTab&&C(a.payments)}},z=function(c,d){a.loading=!1;var e=angular.fromJson(c);if("success"==e.response){var f=e.nodata?[]:angular.copy(e.data);a.credits=f.map(function(a){return a.payment_date=h("date")(a.payment_date),a.receipt_number=b.zeroPad(a.payment_id,5),a}),"Credits"==a.currentFeeTab&&D(a.credits)}},A=function(c){a.feesGrid.data=c,a.loading=!1,b.loading=!1},B=function(c){a.invoiceGrid.data=c,a.loading=!1,b.loading=!1},C=function(c){a.paidGrid.data=c,a.loading=!1,b.loading=!1},D=function(c){a.creditGrid.data=c,a.loading=!1,b.loading=!1};a.addPayment=function(){var b=window.location.host,c=e.create("http://"+b+"/app/fees/paymentForm.html","paymentFormCtrl",{selectedStudent:a.student},{size:"lg",backdrop:"static"});c.result.then(function(a){s(),u(),t()},function(){})},a.getReceipt=function(b){var c={student:a.student,payment:b,feeItems:a.feeItems.concat(a.optFeeItems)},d=window.location.host;e.create("http://"+d+"/app/fees/receipt.html","receiptCtrl",c,{size:"md",backdrop:"static"})},a.viewPayment=function(b){b.student_id=a.student.student_id,b.student_name=a.student.student_name;var c=window.location.host,d=e.create("http://"+c+"/app/fees/paymentDetails.html","paymentDetailsCtrl",b,{size:"lg",backdrop:"static"});d.result.then(function(a){s(),u(),v()},function(){s(),u()})};var E=function(a){return a.map(function(a){if(null!==a.class_cats_restriction&&"{}"!=a.class_cats_restriction){var b=a.class_cats_restriction.slice(1,-1);a.class_cats_restriction=b.split(",")}return a.amount=void 0,a.payment_method=void 0,a})},F=function(b){return b.filter(function(b){return a.student.fee_items.filter(function(a){return a.fee_item_id==b.fee_item_id&&a.active?(b.amount=a.amount,b.payment_method=a.payment_method,b.student_fee_item_id=a.student_fee_item_id,b.payment_made=a.payment_made,b):void 0})[0]})},G=function(b){var c=[];return c=a.student.new_student?b:b.filter(function(a){return a.new_student_only?void 0:a}),void 0!==a.student.current_class&&(c=c.filter(function(b){return null===b.class_cats_restriction||"{}"==b.class_cats_restriction?b:b.class_cats_restriction.indexOf(a.student.current_class.class_cat_id.toString())>-1?b:void 0})),c};a.toggleFeeItem=function(b,c){var d="optional"==c?a.optFeeItemSelection:a.feeItemSelection,e=d.indexOf(b);if(e>-1){if("optional"==c&&b.made_payment>0){var f=$dialog.confirm("Payment Made for Current Term","This student has paid for this lesson for the current term, therefore they will be removed from this optional lesson for all remaining terms. Do you wish to continue?",{size:"sm"});f.result.then(function(b){d.splice(e,1),a.studentForm.$setDirty()})}else d.splice(e,1),a.studentForm.$setDirty();"Transport"==b.fee_item&&(a.showTransport=!1)}else{var g=a.student.fee_items.filter(function(a){return a.fee_item_id==b.fee_item_id?b:void 0})[0];void 0!==g?(b.amount=g.amount,b.payment_method=g.payment_method,b.student_fee_item_id=g.student_fee_item_id,b.payment_made=g.payment_made):(b.amount=b.default_amount,b.payment_method=a.student.payment_method),d.push(b),a.studentForm.$setDirty(),"Transport"==b.fee_item&&(a.showTransport=!0)}},a.addFeeItem=function(){var a=window.location.host,b=e.create("http://"+a+"/app/fees/feeItemForm.html","feeItemFormCtrl",void 0,{size:"md",backdrop:"static"});b.result.then(function(){p()},function(){})},a.$watch("filters.class_cat_id",function(c,d){c!=d&&(a.classes=b.allClasses.filter(function(a){return a.class_cat_id==c?a:void 0}))}),a.$watch("filters.class",function(b,c){b!=c&&(a.filters.class_id=b.class_id,d.getExamTypes(b.class_cat_id,function(b){var c=angular.fromJson(b);"success"==c.response&&(a.examTypes=c.data)},L))}),a.getExams=function(){a.examMarks={},a.marksNotFound=!1,a.notice=!1;var b=a.student.student_id+"/"+a.filters.class_id+"/"+a.filters.term_id;""!=a.filters.exam_type_id&&void 0!==a.filters.exam_type_id&&(b+="/"+a.filters.exam_type_id);var c=a.terms.filter(function(b){return b.term_id==a.filters.term_id?b:void 0})[0];c&&(a.selectedYear=c.year),a.selectedClass=a.classes.filter(function(b){return b.class_id==a.filters.class_id?b:void 0})[0],d.getStudentExamMarks(b,H,L)};var H=function(b,c){a.loading=!1;var d=angular.fromJson(b);if("success"==d.response)if(d.nodata)a.marksNotFound=!0,a.errMsg="There are currently no exam marks entered for this search criteria.";else{a.rawExamMarks=d.data,a.examMarks={};var e=moment().format("YYYY");e==a.selectedYear&&a.selectedClass.class_id!=a.currentClass[0].class_id&&(a.notice=!0,a.noticeMsg=a.student.student_name+" is currently associated with <strong>"+a.currentClass[0].class_name+"</strong>, however these exam marks are associated with <strong>"+a.filters["class"].class_name+"</strong>.<br>Would you like to move these marks from "+a.filters["class"].class_name+" to "+a.currentClass[0].class_name+"?<br><br>"),a.examMarks.types=d.data.reduce(function(a,b){return-1===a.indexOf(b.exam_type)&&a.push(b.exam_type),a},[]),a.examMarks.subjects=[];var f="",g=[],h=0;angular.forEach(d.data,function(b,c){b.subject_name!=f&&(h>0&&(a.examMarks.subjects[h-1].marks=g),a.examMarks.subjects.push({subject_name:b.subject_name,parent_subject_name:b.parent_subject_name,marks:[]}),g={},h++),g[b.exam_type]={mark:b.mark,grade_weight:b.grade_weight,grade:b.grade},f=b.subject_name}),a.examMarks.subjects[h-1].marks=g}else a.marksNotFound=!0,a.errMsg=d.data};a.updateExams=function(){var b=[];angular.forEach(a.rawExamMarks,function(a){b.push(a.exam_id)});var c={class_id:a.currentClass[0].class_id,exam_ids:b};d.updateExamClass(c,function(b){a.filters["class"]=a.currentClass[0],a.filters.class_id=a.currentClass[0].class_id,a.getExams()},L)},a.addExamMarks=function(){var b={student_id:a.student.student_id,classes:a.classes,terms:a.terms,examTypes:a.examTypes,filters:a.filters},c=e.create("addStudentExamMarks.html","addStudentExamMarksCtrl",b,{size:"md",backdrop:"static"});c.result.then(function(b){a.getExams()},function(){})},a.importExamMarks=function(){b.wipNotice()},a.exportData=function(){b.wipNotice()},a.getStudentReportCards=function(){a.reportsNotFound=!1,d.getStudentReportCards(a.student.student_id,I,L)};var I=function(b,c){a.loading=!1;var d=angular.fromJson(b);if("success"==d.response)if(d.nodata)a.reportCards={},a.reportsNotFound=!0,a.errMsg="There are currently no report cards entered for this student.";else{a.rawReportCards=d.data,a.reportCards={},a.reportCards.terms=a.rawReportCards.reduce(function(a,b){return-1===a.indexOf(b.term_name)&&a.push(b.term_name),a},[]),a.reportCards.classes=[];var e="",f="",g={},h=0;angular.forEach(a.rawReportCards,function(b,c){b.class_name!=e&&(h>0&&(a.reportCards.classes[h-1].reports=g),a.reportCards.classes.push({report_card_id:b.report_card_id,class_name:b.class_name,class_id:b.class_id,class_cat_id:b.class_cat_id,report_card_type:b.report_card_type,teacher_id:b.teacher_id,teacher_name:b.teacher_name,term_id:b.term_id,date:b.date,year:b.year,published:b.published}),g={},h++),g[b.term_name]={term_id:b.term_id,year:b.year,published:b.published,report_card_id:b.report_card_id,report_card_type:b.report_card_type,class_name:b.class_name,class_id:b.class_id,teacher_id:b.teacher_id,teacher_name:b.teacher_name,date:b.date,data:b.report_data},e=b.class_name,f=b.term_name}),a.reportCards.classes[h-1].reports=g}else a.reportsNotFound=!0,a.errMsg=d.data};a.addReportCard=function(){var b={student:a.student,classes:a.classes,terms:a.terms,filters:a.filters,adding:!0},c=window.location.host,d=e.create("http://"+c+"/app/exams/reportCard.html","reportCardCtrl",b,{size:"lg",backdrop:"static"});d.result.then(function(b){a.getStudentReportCards()},function(){a.getStudentReportCards()})},a.getReportCard=function(b,c,d){var f={student:a.student,report_card_id:d.report_card_id,class_name:d.class_name,class_id:d.class_id,published:d.published,term_id:d.term_id,term_name:c,year:d.year,report_card_type:d.report_card_type,teacher_id:d.teacher_id,teacher_name:d.teacher_name,date:d.date,reportData:d.data,adding:!1,filters:{term:{term_name:c,term_id:b.term_id},"class":{class_id:b.class_id,class_cat_id:b.class_cat_id}}},g=window.location.host,h=e.create("http://"+g+"/app/exams/reportCard.html","reportCardCtrl",f,{size:"lg",backdrop:"static"});h.result.then(function(b){a.getStudentReportCards()},function(){a.getStudentReportCards()})},a.save=function(c,e){if(a.error=!1,!c.$invalid){if("Details"==a.currentTab){void 0!==M.queue[0]&&(a.filename=a.student.student_id+"_"+M.queue[0].file.name,M.queue[0].file.name=a.filename,M.uploadAll());var f={student_id:a.student.student_id,user_id:b.currentUser.user_id,details:{student_category:a.student.student_category,first_name:a.student.first_name,middle_name:a.student.middle_name,last_name:a.student.last_name,gender:a.student.gender,dob:a.student.dob,nationality:a.student.nationality,current_class:a.student.class_id,update_class:j.class_id!=a.student.class_id,previous_class:j.class_id,previous_class_cat:j.class_cat_id,current_class_cat:a.student.class_cat_id,student_image:void 0!==M.queue[0]?M.queue[0].file.name:a.student.student_image,active:a.student.active?"t":"f",admission_date:moment(a.student.admission_date.startDate).format("YYYY-MM-DD"),admission_number:a.student.admission_number,new_student:a.student.new_student?"t":"f"}}}else if("Family"==a.currentTab)var f={student_id:a.student.student_id,user_id:b.currentUser.user_id,family:{marial_status_parents:a.student.marial_status_parents,adopted:a.student.adopted?"t":"f",adopted_age:a.student.adopted_age,marital_separation_age:a.student.marital_separation_age,adoption_aware:a.student.adoption_aware?"t":"f",emergency_name:a.student.emergency_name,emergency_relationship:a.student.emergency_relationship,emergency_telephone:a.student.emergency_telephone,pick_up_drop_off_individual:a.student.pick_up_drop_off_individual}};else if("Medical History"==a.currentTab)var f={student_id:a.student.student_id,user_id:b.currentUser.user_id,medical:{has_medical_conditions:a.student.has_medical_conditions||a.student.other_medical_conditions?"t":"f",hospitalized:a.student.hospitalized?"t":"f",hospitalized_description:a.student.hospitalized?a.student.hospitalized_description:null,current_medical_treatment:a.student.current_medical_treatment?"t":"f",current_medical_treatment_description:a.student.current_medical_treatment?a.student.current_medical_treatment_description:null,other_medical_conditions:a.student.other_medical_conditions?"t":"f",other_medical_conditions_description:a.student.other_medical_conditions?a.student.other_medical_conditions_description:null}};else if("Fees"==a.currentTab)var f={student_id:a.student.student_id,user_id:b.currentUser.user_id,fees:{payment_method:a.student.payment_method,installment_option:a.student.installment_option_id,feeItems:a.feeItemSelection,optFeeItems:a.optFeeItemSelection}};d.updateStudent(f,J,L,{tab:e})}};var J=function(b,c,f){var g=angular.fromJson(b);if("success"==g.response)if(void 0!==M.queue[0]&&(a.student.student_image=a.filename),a.getStudentDetails(a.student.student_id),g.data.length>0){var h=e.confirm("Update Previous Exam Marks?","This student has exam marks entered this year that are associated with another class. Do you want to associate these marks with their new class?<br><br><i>This can also be done at a later date on the student exams section.</i>",{size:"sm"});h.result.then(function(b){var c=[];angular.forEach(g.data,function(a){c.push(a.exam_id)});var e={class_id:a.student.class_id,exam_ids:c};d.updateExamClass(e,function(a){K(f)},L)},function(a){K(f)})}else K(f);else a.error=!0,a.errMsg=g.data},K=function(c){void 0!==c.tab&&q(c.tab),"Fees"==a.currentTab&&s(),b.$emit("studentAdded",{msg:"Student was updated.",clear:!0})},L=function(b,c){var d=angular.fromJson(b);a.error=!0,a.errMsg=d.data},M=a.uploader=new f({url:"upload.php",formData:[{dir:"students"}]});a.adminDelete=function(){var b=e.create("adminDelete.html","adminDeleteCtrl",{student_id:a.student.student_id},{size:"sm",backdrop:"static"});b.result.then(function(a){c.dismiss("Canceled")},function(a){})}}]).controller("addParentCtrl",["$scope","$rootScope","$uibModalInstance","apiService","data",function(a,b,c,d,e){a.student_id=e.student_id||null,a.guardian=e.guardian||{},void 0===a.guardian.login&&(a.guardian.login={}),a.guardian.login.login_active="false",a.edit="edit"==e.action,a.add="add"==e.action,a.readOnly="view"==e.action,a.parentPortalAcitve=!(!b.currentUser.settings["Parent Portal"]||"Yes"!=b.currentUser.settings["Parent Portal"]);var f=b.currentUser.settings["Guardian Relationships"];a.relationships=f.split(",");var g=b.currentUser.settings["Marital Statuses"];a.maritalStatuses=g.split(",");var h=b.currentUser.settings.Titles;a.titles=h.split(","),a.existingGuardian={},a.uniqueUsername=void 0,a.uniqueIdNumber=void 0,a.checkID=!0,a.initializeController=function(){a.edit?(a.getStudents(a.guardian.guardian_id),a.checkMISLogin(a.guardian.id_number)):d.getAllGuardians(!0,function(b){var c=angular.fromJson(b);"success"==c.response&&(a.guardians=c.nodata?[]:c.data)},j)},setTimeout(a.initializeController,10),a.getStudents=function(b){d.getGuardiansChildren(b,function(b){var c=angular.fromJson(b);"success"==c.response&&(a.children=c.nodata?[]:c.data,a.children=a.children.filter(function(b){return b.student_id!=a.student_id?b:void 0}))},j)},a.checkMISLogin=function(b){d.getMISLogin(b,function(b){var c=angular.fromJson(b);if("success"==c.response)if(a.hasLogin=!c.nodata,a.hasLogin){if(a.guardian.login=c.data,a.guardian.login.login_active=String(c.data.login_active),null!==c.data.student_ids)var d=c.data.student_ids.indexOf(String(a.student_id));a.guardian.login.exists=d>-1}else void 0===a.guardian.login&&(a.guardian.login={}),a.guardian.login.login_active="false"},j)},a.checkUsername=function(b){a.hasLogin||d.checkUsername(b,function(b){var c=angular.fromJson(b);"success"==c.response&&(a.uniqueUsername=!!c.nodata)},j)},a.checkIdNumber=function(b){d.checkIdNumber(b,function(b){var c=angular.fromJson(b);"success"==c.response&&(c.nodata?a.uniqueIdNumber=!0:void 0!==a.guardian&&c.data.guardian_id==a.guardian.guardian_id?a.uniqueIdNumber=!0:a.uniqueIdNumber=!1)},j)},a.$watch("existingGuardian.selected",function(b,c){if(b!=c&&void 0!==b){var d=angular.copy(a.guardian.relationship);a.guardian=b,a.guardian.relationship=d,a.getStudents(a.guardian.guardian_id)}}),a.$watch("guardian.id_number",function(b,c){b!=c&&void 0!==b&&(a.checkMISLogin(b),a.uniqueIdNumber=void 0,a.checkIdNumber(b))}),a.$watch("guardian.login.username",function(b,c){b!=c&&void 0!==b&&(a.uniqueUsername=void 0,a.checkUsername(b))}),a.cancel=function(){c.dismiss("Canceled")},a.save=function(e){if(!e.$invalid&&a.uniqueUsername!==!1&&a.uniqueIdNumber!==!1)if(a.edit)a.update();else if(a.student_id){var f={student_id:a.student_id,guardian_id:void 0!==a.existingGuardian.selected?a.existingGuardian.selected.guardian_id:void 0,guardian:a.guardian,user_id:b.currentUser.user_id};d.postGuardian(f,i,j)}else a.guardian.parent_full_name=a.guardian.first_name+" "+(a.guardian.middle_name||"")+" "+a.guardian.last_name,c.close(a.guardian)},a.update=function(){var c={student_id:a.student_id,guardian:a.guardian,user_id:b.currentUser.user_id};d.updateGuardian(c,i,j)};var i=function(b,d){var e=angular.fromJson(b);if("success"==e.response)a.edit||(a.guardian.guardian_id=e.data),a.guardian.parent_full_name=a.guardian.first_name+" "+(a.guardian.middle_name||"")+" "+a.guardian.last_name,c.close(a.guardian);else{a.error=!0;var f=e.data.indexOf('"U_id_number"')>-1?"The ID Number you entered already exists.":e.data;a.errMsg=f}},j=function(b,c){var d=angular.fromJson(b);
a.error=!0,a.errMsg=d.data};a.clearSelect=function(b){b.stopPropagation(),a.existingGuardian.selecte=void 0,a.guardian={},a.childern=void 0}}]).run(["$templateCache",function(a){a.put("addParent.html",'<form name="parentForm" class="form-horizontal modalForm" novalidate role="form" ng-submit="save(parentForm)"><div class="modal-header dialog-header-form"><h4 class="modal-title"><span class="glyphicon glyphicon-plus"></span> {{(edit ? \'Update\' : \'Add\')}} Parent/Guardian</h4></div><div class="modal-body cleafix"><div ng-show="error" class="alert alert-danger">{{errMsg}}</div><!-- relationship --><div class="form-group"><label for="relationship" class="col-sm-2 control-label">Relationship</label><div class="col-sm-4"><p class="form-control-static" ng-show="readOnly">{{guardian.relationship}}</p><div ng-show="edit||add"><select name="relationship" ng-model="guardian.relationship" class="form-control"><option value="">--select relationship--</option><option value="{{item}}" ng-repeat="item in relationships">{{item}}</option></select></div></div></div><!-- existing parent --><div class="form-group" ng-show="!edit && !readOnly"><label for="guardian_id" class="col-sm-2 control-label">Use Existing Parent</label><div class="col-sm-6"><ui-select ng-model="existingGuardian.selected" theme="select2" class="form-control" name="existingGuardian" > <ui-select-match placeholder="Select or search a parent..."><span>{{$select.selected.parent_full_name}}</span><button type="button" class="clear text-danger" ng-click="clearSelect($event)"><span class="glyphicon glyphicon-remove"></span></button> </ui-select-match><ui-select-choices repeat="item in guardians | filter: $select.search"><span ng-bind-html="item.parent_full_name | highlight: $select.search"></span> </ui-select-choices></ui-select><p class="help-block info-block pull-left"><i class="glyphicon glyphicon-info-sign"></i> If this student\'s parent is already entered, you can select them above. Or, leave above blank and enter a new parent below.</p></div></div><div ng-show="children.length > 0 " class="alert alert-warning"><i class="glyphicon glyphicon-alert pull-left"></i> <strong>Any data that is changed below will also affect the following students who are also associated with this parent.</strong><div ng-show="children.length>0"><ul><li ng-repeat="child in children">{{child.student_name}}</li></ul></div></div><div class="row"><div class="col-sm-6"><h3>Personal Info</h3><!-- last name --><div class="form-group" ng-class="{ \'has-error\' : (parentForm.$submitted || parentForm.last_name.$dirty ) && parentForm.last_name.$invalid && parentForm.last_name.$error.required }"><label for="last_name" class="col-sm-3 control-label">Last Name</label><div class="col-sm-9"><p class="form-control-static" ng-show="readOnly">{{guardian.last_name}}</p><div ng-show="edit||add"><input type="text" name="last_name" ng-model="guardian.last_name" class="form-control" required /><p ng-show="(parentForm.$submitted || parentForm.last_name.$dirty ) && parentForm.last_name.$invalid && parentForm.last_name.$error.required" class="help-block"><i class="fa fa-exclamation-triangle"></i> Last Name is required.</p></div></div></div><!-- first name --><div class="form-group" ng-class="{ \'has-error\' : (parentForm.$submitted || parentForm.first_name.$dirty ) && parentForm.first_name.$invalid && parentForm.first_name.$error.required }"><label for="first_name" class="col-sm-3 control-label">First Name</label><div class="col-sm-9"><p class="form-control-static" ng-show="readOnly">{{guardian.first_name}}</p><div ng-show="edit||add"><input type="text" name="first_name" ng-model="guardian.first_name" class="form-control" required /><p ng-show="(parentForm.$submitted || parentForm.first_name.$dirty ) && parentForm.first_name.$invalid && parentForm.first_name.$error.required" class="help-block"><i class="fa fa-exclamation-triangle"></i> First Name is required.</p></div></div></div><!-- middle name --><div class="form-group"><label for="middle_name" class="col-sm-3 control-label">Middle Name</label><div class="col-sm-9"><p class="form-control-static" ng-show="readOnly">{{guardian.middle_name}}</p><div ng-show="edit||add"><input type="text" name="middle_name" ng-model="guardian.middle_name" class="form-control" /></div></div></div><!-- name title --><div class="form-group" ><label for="title" class="col-sm-3 control-label">Title</label><div class="col-sm-9"><p class="form-control-static" ng-show="readOnly">{{guardian.title}}</p><div ng-show="edit||add"><select name="title" ng-model="guardian.title" class="form-control"><option value="{{title}}" ng-repeat="title in titles">{{title}}</option></select></div></div></div><!-- id number --><div class="form-group" ng-class="{ \'has-error\' : (parentForm.$submitted || parentForm.id_number.$dirty ) && parentForm.id_number.$invalid && parentForm.id_number.$error.required }"><label for="id_number" class="col-sm-3 control-label">ID Number</label><div class="col-sm-4 nopad-right"><p class="form-control-static" ng-show="readOnly">{{guardian.id_number}}</p><div ng-show="edit||add"><input type="text" name="id_number" ng-model="guardian.id_number" ng-model-options="{ debounce: 1000 }" class="form-control" required numeric-only />	<p ng-show="(parentForm.$submitted || parentForm.id_number.$dirty ) && parentForm.id_number.$invalid && parentForm.id_number.$error.required" class="help-block"><i class="fa fa-exclamation-triangle"></i> ID Number is required.</p></div></div><div class="col-sm-5" ng-show="uniqueIdNumber===false"><p class="form-control-static alert alert-danger"><i class="glyphicon glyphicon-remove pull-left"></i> Already exists.</p></div><div class="col-sm-2" ng-show="uniqueIdNumber===true"><p class="form-control-static alert alert-success icon-only"><i class="glyphicon glyphicon-ok"></i></p></div></div><!-- address --><div class="form-group"><label for="address" class="col-sm-3 control-label">Address</label><div class="col-sm-9"><p class="form-control-static" ng-show="readOnly">{{guardian.address}}</p><div ng-show="edit||add"><input type="text" name="address" ng-model="guardian.address" class="form-control"  >	</div></div></div><!-- phone number --><div class="form-group" ng-class="{ \'has-error\' : (parentForm.$submitted || parentForm.telephone.$dirty ) && parentForm.telephone.$invalid && parentForm.telephone.$error.required }"><label for="telephone" class="col-sm-3 control-label">Telephone</label><div class="col-sm-9"><p class="form-control-static" ng-show="readOnly">{{guardian.telephone}}</p><div ng-show="edit||add"><input type="text" name="telephone" ng-model="guardian.telephone" class="form-control" required numeric-only />	<p ng-show="(parentForm.$submitted || parentForm.telephone.$dirty ) && parentForm.telephone.$invalid && parentForm.telephone.$error.required" class="help-block"><i class="fa fa-exclamation-triangle"></i> Telephone number is required.</p></div>	</div>	</div><!-- email --><div class="form-group" ng-class="{ \'has-error\' : (parentForm.$submitted || parentForm.email.$dirty ) && parentForm.email.$invalid && parentForm.email.$error.required }"><label for="email" class="col-sm-3 control-label">Email</label><div class="col-sm-9"><p class="form-control-static" ng-show="readOnly">{{guardian.email}}</p><div ng-show="edit||add"><input type="email" name="email" ng-model="guardian.email" class="form-control" required />	<p ng-show="(parentForm.$submitted || parentForm.email.$dirty ) && parentForm.email.$invalid && parentForm.email.$error.required" class="help-block"><i class="fa fa-exclamation-triangle"></i> Email is required.</p><p ng-show="(parentForm.$submitted || parentForm.email.$dirty ) && parentForm.email.$invalid && parentForm.email.$error.email" class="help-block"><i class="fa fa-exclamation-triangle"></i> Invalid email</p></div>	</div>	</div><!-- marital status --><div class="form-group"><label for="marital_status" class="col-sm-3 control-label">Marital Status</label><div class="col-sm-9"><p class="form-control-static" ng-show="readOnly">{{guardian.marital_status}}</p><div ng-show="edit||add"><select name="marital_status" ng-model="guardian.marital_status" class="form-control"><option value="">--select one--</option><option value="{{item}}" ng-repeat="item in maritalStatuses">{{item}}</option></select></div>	</div>	</div></div><div class="col-sm-6"><h3>Employment Info</h3><!-- occupation --><div class="form-group"><label for="occupation" class="col-sm-3 control-label">Occupation</label><div class="col-sm-9"><p class="form-control-static" ng-show="readOnly">{{guardian.occupation}}</p><div ng-show="edit||add"><input type="text" name="occupation" ng-model="guardian.occupation" class="form-control"  ></div>	</div>	</div><!-- employer --><div class="form-group"><label for="employer" class="col-sm-3 control-label">Employer</label><div class="col-sm-9"><p class="form-control-static" ng-show="readOnly">{{guardian.employer}}</p><div ng-show="edit||add"><input type="text" name="employer" ng-model="guardian.employer" class="form-control"  ></div>	</div>	</div><!-- employer address --><div class="form-group">	<label for="employer_address" class="col-sm-3 control-label">Employer Address</label><div class="col-sm-9"><p class="form-control-static" ng-show="readOnly">{{guardian.employer_address}}</p><div ng-show="edit||add"><input type="text" name="employer_address" ng-model="guardian.employer_address" class="form-control"  ></div>	</div>	</div><!-- phone number --><div class="form-group">	<label for="work_phone" class="col-sm-3 control-label">Work Phone</label><div class="col-sm-9"><p class="form-control-static" ng-show="readOnly">{{guardian.work_phone}}</p><div ng-show="edit||add"><input type="text" name="work_phone" ng-model="guardian.work_phone" class="form-control" numeric-only />	</div></div></div><!-- work_email --><div class="form-group"><label for="work_email" class="col-sm-3 control-label">Work Email</label><div class="col-sm-9"><p class="form-control-static" ng-show="readOnly">{{guardian.email}}</p><div ng-show="edit||add"><input type="email" name="work_email" ng-model="guardian.work_email" class="form-control"  >	</div>	</div>	</div><div ng-if="parentPortalAcitve"><h3>Parent Portal Login (optional)</h3><div ng-if="hasLogin"><!-- username --><div class="form-group"><label for="username" class="col-sm-3 control-label">Username</label><div class="col-sm-9"><p class="form-control-static">{{guardian.login.username}}</p></div></div><!-- active --><div class="form-group"><label for="login_active" class="col-sm-3 control-label">Login Active</label><div class="col-sm-9"><p class="form-control-static" ng-show="readOnly">{{guardian.login_active}}</p><div ng-show="edit||add"><label class="radio-inline"><input type="radio" name="login_active" ng-model="guardian.login.login_active" value="true" > Active</label><label class="radio-inline"><input type="radio" name="login_active" ng-model="guardian.login.login_active" value="false" > In-active</label></div></div></div></div><div ng-if="!hasLogin"><div ng-show="!readOnly"><!-- username --><div class="form-group"><label for="username" class="col-sm-3 control-label">Username</label><div class="col-sm-4 nopad-right"><input type="text" name="username" ng-model="guardian.login.username" class="form-control" ng-model-options="{ debounce: 1000 }" ></div>	<div class="col-sm-5" ng-show="uniqueUsername===false"><span class="alert alert-danger"><i class="glyphicon glyphicon-remove"></i> Already taken.</span></div>	<div class="col-sm-2" ng-show="uniqueUsername===true"><p class="form-control-static alert alert-success icon-only"><i class="glyphicon glyphicon-ok"></i></p></div>	</div><!-- password --><div class="form-group"><label for="password" class="col-sm-3 control-label">Password</label><div class="col-sm-9"><input type="text" name="password" ng-model="guardian.login.password" class="form-control"  ></div>	</div><!-- active --><div class="form-group"><label for="login_active" class="col-sm-3 control-label">Login Active</label><div class="col-sm-9"><label class="radio-inline"><input type="radio" name="login_active" ng-model="guardian.login.login_active" value="true" > Active</label><label class="radio-inline"><input type="radio" name="login_active" ng-model="guardian.login.login_active" value="false" > In-active</label></div>	</div></div><div ng-show="readOnly"><p>This parent does not have a parent portal login.</div></div></div></div></div></div><div class="modal-footer"><button type="button" class="btn btn-link" ng-click="cancel()">Cancel</button><button type="submit" class="btn btn-primary">{{(edit ? \'Update\' : \'Save\')}} </button></div></form>')}]).controller("addMedicalHistoryCtrl",["$scope","$rootScope","$uibModalInstance","apiService","data",function(a,b,c,d,e){a.fullMedicalHistory=e.medicalHistory||{};var f=b.currentUser.settings["Medical Conditions"];f=f.split(",");var g=a.fullMedicalHistory.reduce(function(a,b){return a.push(b.illness_condition),a},[]);a.medicalConditions=f.reduce(function(a,b){return-1===g.indexOf(b)&&a.push({illness_condition:b,age:"",comments:""}),a},[]),a.cancel=function(){c.dismiss("Canceled")},a.save=function(){var c={student_id:e.student_id,medicalConditions:a.conditionSelection,user_id:b.currentUser.user_id};d.postMedicalConditions(c,h,i)};var h=function(b,d){var e=angular.fromJson(b);"success"==e.response?(angular.forEach(e.data,function(b,c){a.conditionSelection[c].medical_id=b.medical_id,a.conditionSelection[c].date_medical_added=b.date_medical_added}),c.close(a.conditionSelection)):(a.error=!0,a.errMsg=e.data)},i=function(b,c){var d=angular.fromJson(b);a.error=!0,a.errMsg=d.data};a.hitEnter=function(b){angular.equals(b.keyCode,13)&&a.save()},a.conditionSelection=[],a.toggleMedicalCondition=function(b){var c=a.conditionSelection.indexOf(b);c>-1?a.conditionSelection.splice(c,1):a.conditionSelection.push(b)}}]).run(["$templateCache",function(a){a.put("addMedicalHistory.html",'<div class="modal-header dialog-header-form"><h4 class="modal-title"><span class="glyphicon glyphicon-plus"></span> Add Medical History</h4></div><div class="modal-body cleafix"><ng-form name="cargoDialog" class="form-horizontal modalForm" novalidate role="form"><div ng-show="error" class="alert alert-danger">{{errMsg}}</div><table class="display dataTable"><thead><tr><th>Illness/Condition</th><th>Age</th><th>Explain</th></tr></thead><tbody><tr ng-class-odd="\'odd\'" ng-class-even="\'even\'" ng-repeat="item in medicalConditions track by $index"><td width="150"><label class="checkbox-inline"><input type="checkbox" name="conditions[]" value="{{item.illness_condition}}" ng-checked="conditionSelection.indexOf(item) > -1" ng-click="toggleMedicalCondition(item)" > {{item.illness_condition}}</label></td><td width="80"><input type="text" class="form-control" name="medical_condition_age[]" ng-model="item.age" ></td><td><input type="text" class="form-control" name="medical_condition_comments[]" ng-model="item.comments" ></td></tr></tbody></table></ng-form></div><div class="modal-footer"><button type="button" class="btn btn-link" ng-click="cancel()">Cancel</button><button ng-show="!edit" type="button" class="btn btn-primary" ng-click="save()">Save</button></div>')}]).controller("updateMedicalConditionCtrl",["$scope","$rootScope","$uibModalInstance","apiService","data",function(a,b,c,d,e){a.medicalCondition=e.medicalCondition||{},a.cancel=function(){c.dismiss("Canceled")},a.save=function(){var c={student_id:e.student_id,medicalCondition:a.medicalCondition,user_id:b.currentUser.user_id};d.updateMedicalConditions(c,f,g)};var f=function(b,d){var e=angular.fromJson(b);"success"==e.response?c.close(a.medicalCondition):(a.error=!0,a.errMsg=e.data)},g=function(b,c){var d=angular.fromJson(b);a.error=!0,a.errMsg=d.data};a.hitEnter=function(b){angular.equals(b.keyCode,13)&&a.save()}}]).run(["$templateCache",function(a){a.put("updateMedicalCondition.html",'<div class="modal-header dialog-header-form"><h4 class="modal-title"><span class="glyphicon glyphicon-plus"></span> Update Medical Condition : {{medicalCondition.illness_condition}}</h4></div><div class="modal-body cleafix"><ng-form name="cargoDialog" class="form-horizontal modalForm" novalidate role="form"><div class="row"><div class="col-sm-12"><div ng-show="error" class="alert alert-danger">{{errMsg}}</div><!-- Age --><div class="form-group"><div class="col-sm-12"><label for="age">Age</label></div><div class="col-sm-3"><input type="text" name="age" ng-model="medicalCondition.age" class="form-control"  ></div></div><!-- Explain --><div class="form-group"><div class="col-sm-12"><label for="comments">Explain</label></div><div class="col-sm-12"><textarea name="comments" rows="5" ng-model="medicalCondition.comments" class="form-control"></textarea></div></div></div></div></ng-form></div><div class="modal-footer"><button type="button" class="btn btn-link" ng-click="cancel()">Cancel</button><button ng-show="!edit" type="button" class="btn btn-primary" ng-click="save()">Save</button></div>')}]).controller("addStudentExamMarksCtrl",["$scope","$rootScope","$uibModalInstance","apiService","data",function(a,b,c,d,e){a.student_id=e.student_id,a.filters=e.filters,a.classes=e.classes,a.terms=e.terms,a.examTypes=e.examTypes,a.cancel=function(){c.dismiss("Canceled")},a.$watch("filters.class",function(b,c){b!=c&&(a.filters.class_id=b.class_id,d.getExamTypes(b.class_cat_id,function(b){var c=angular.fromJson(b);"success"==c.response&&(a.examTypes=c.data)},g))}),a.getStudentExams=function(b){if(!b.$invalid){a.examMarks={},a.marksNotFound=!1,a.currentFilters=angular.copy(a.filters);var c=a.filters.class_id+"/"+a.filters.exam_type_id+"/0";d.getAllClassExams(c,function(b){a.loading=!1;var c=angular.fromJson(b);if("success"==c.response)if(void 0!==c.nodata)a.examNotFound=!0;else{var e=c.data,f=a.student_id+"/"+a.filters.class_id+"/"+a.filters.term_id+"/"+a.filters.exam_type_id;d.getStudentExamMarks(f,function(b){a.loading=!1;var c=angular.fromJson(b);"success"==c.response&&(a.marks=c.nodata?[]:c.data,a.marks.length>0?a.subjects=e.map(function(b){var c=a.marks.filter(function(a){return a.subject_name==b.subject_name?a:void 0})[0];return b.mark=void 0!==c?c.mark:void 0,b}):a.subjects=e)},g)}},g)}},a.calculateParentSubject=function(b){if(void 0!==b){var c=[],d=null;angular.forEach(a.subjects,function(a,e){a.parent_subject_id==b?c.push(a):a.subject_id==b&&(d=a)});var e=c.reduce(function(a,b){return a+=parseFloat(b.mark)||0},0),f=c.reduce(function(a,b){return a+=parseFloat(b.grade_weight)||0},0);d.mark=Math.round(e/f*100)}},a.save=function(){var c=[];angular.forEach(a.subjects,function(b,d){c.push({student_id:a.student_id,class_sub_exam_id:b.class_sub_exam_id,term_id:a.currentFilters.term_id,mark:b.mark,parent_subject_id:b.parent_subject_id})});var e={user_id:b.currentUser.user_id,exam_marks:c};d.addExamMarks(e,f,g)};var f=function(b,d){var e=angular.fromJson(b);"success"==e.response?c.close(a.subjects):(a.error=!0,a.errMsg=e.data)},g=function(b,c){var d=angular.fromJson(b);a.error=!0,a.errMsg=d.data};a.hitEnter=function(b){angular.equals(b.keyCode,13)&&a.save()};var g=function(b,c){var d=angular.fromJson(b);a.error=!0,a.errMsg=d.data}}]).run(["$templateCache",function(a){a.put("addStudentExamMarks.html",'<div class="modal-header dialog-header-form"><h4 class="modal-title"><span class="glyphicon glyphicon-plus"></span> Add Exam Marks</h4></div><div class="modal-body cleafix"><form name="examForm" class="form-horizontal modalForm" novalidate role="form"><div ng-show="error" class="alert alert-danger">{{errMsg}}</div><div class="row header"><div class="modalDataFilter col-sm-12 clearfix">	<!-- Class --><div class="form-group"><label for="class">Class</label><select name="class_id" class="form-control" ng-options="class.class_name for class in classes track by class.class_id" ng-model="filters.class" required><option value="">--select class--</option></select><p ng-show="examForm.class_id.$invalid && (examForm.class_id.$touched || examForm.$submitted)" class="help-block"><i class="fa fa-exclamation-triangle"></i> Class is required.</p></div>	<!-- Term --><div class="form-group"><label for="term">Term</label><select name="term_id" class="form-control" ng-options="item.term_id as item.term_year_name for item in terms" ng-model="filters.term_id" required><option value="">--select term--</option></select><p ng-show="examForm.term_id.$invalid && (examForm.term_id.$touched || examForm.$submitted)" class="help-block"><i class="fa fa-exclamation-triangle"></i> Term is required.</p></div><!-- Exam --><div class="form-group"><label for="exam_type">Exam</label><select name="exam_type" class="form-control" ng-options="exam.exam_type_id as exam.exam_type for exam in examTypes" ng-model="filters.exam_type_id" required><option value="">-- select exam --</option></select><p ng-show="examForm.exam_type.$invalid && (examForm.exam_type.$touched || examForm.$submitted)" class="help-block"><i class="fa fa-exclamation-triangle"></i> Exam Type is required.</p></div><!-- search btn --><div class="form-group submit-btn"><input type="submit" class="btn btn-sm btn-info" ng-click="getStudentExams(examForm)" value="Load" /><span ng-show="loading" class="fa fa-spinner fa-pulse"></span></div>	<hr></div></div><p ng-show="examNotFound" class="error alert alert-danger">The selected exam has not been set up for this class.</p><div class="row"><div class="col-sm-12" ng-repeat="item in subjects track by $index" ng-class="{\'text-muted\': item.parent_subject_id!==null}"><label class="col-sm-6" ng-class="{\'indent\': item.parent_subject_id!==null}">{{item.subject_name}}</label><div class="input-group col-sm-2"><input type="text" class="form-control" ng-model="item.mark" numeric-only ng-change="calculateParentSubject({{item.parent_subject_id}})" ng-model-options="{ debounce: 500 }" ng-disabled="item.is_parent" /><div class="input-group-addon"> / {{item.grade_weight}}</div></div></div></div></form></div><div class="modal-footer"><button type="button" class="btn btn-link" ng-click="cancel()">Cancel</button><button type="button" class="btn btn-primary" ng-click="save()">Save</button></div>')}]).controller("adminDeleteCtrl",["$scope","$rootScope","$uibModalInstance","apiService","data",function(a,b,c,d,e){a.student_id=e.student_id,a.adminPwd="",a.cancel=function(){c.dismiss("Canceled")},a.done=function(e){if(!e.$invalid){var g=a.adminPwd+"/"+a.student_id;d.adminDeleteStudent(g,function(d,e,f){var g=angular.fromJson(d);"success"==g.response?(b.$emit("studentAdded",{msg:"Student was deleted.",clear:!0}),c.close()):(a.error=!0,a.errMsg="The password you entered was incorrect.")},f)}};var f=function(b,c){var d=angular.fromJson(b);a.error=!0,a.errMsg=d.data}}]).run(["$templateCache",function(a){a.put("adminDelete.html",'<form name="deleteForm" class="form-horizontal modalForm" novalidate role="form" ng-submit="done(deleteForm)"><div class="modal-header dialog-header-confirm"><h4 class="modal-title">Delete Student</h4></div><div class="modal-body cleafix"><p >Are you sure you want to delete this student and all their associated invoices and payments?<br><strong>THIS CAN NOT BE UNDONE.</strong></p><div ng-class="{ \'has-error\' : (deleteForm.$submitted || deleteForm.admin_pwd.$dirty ) && deleteForm.admin_pwd.$invalid && deleteForm.admin_pwd.$error.required }"><input type="password" ng-model="adminPwd" class="form-control" name="admin_pwd" placeholder="Enter admin password" required /><p ng-show="(deleteForm.$submitted || deleteForm.admin_pwd.$dirty ) && deleteForm.admin_pwd.$invalid && deleteForm.admin_pwd.$error.required" class="help-block"><i class="fa fa-exclamation-triangle"></i> Admin password is required.</p></div><div ng-show="error" class="alert alert-danger">{{errMsg}}</div></div><div class="modal-footer"><button type="button" class="btn btn-link" ng-click="cancel()">Cancel</button><button type="submit" class="btn btn-danger">Delete</button></div></form>')}]),angular.module("eduwebApp").controller("listUsersCtrl",["$scope","$rootScope","apiService","$timeout","$window","$state",function(a,b,c,d,e,f){a.filters={},a.filters.status="true",a.users=[],a.loading=!0,a.alert={},a.gridFilter={},a.gridFilter.filterValue="";var g=function(){return'<div class="clickable" ng-click="grid.appScope.viewUser(row.entity)">  <div ng-if="row.entity.merge">{{row.entity.title}}</div>  <div ng-if="!row.entity.merge" ng-repeat="(colRenderIndex, col) in colContainer.renderedColumns track by col.colDef.name" class="ui-grid-cell" ng-class="{ \'ui-grid-row-header-cell\': col.isRowHeader }"  ui-grid-cell></div></div>'};a.gridOptions={enableSorting:!0,rowTemplate:g(),rowHeight:24,columnDefs:[{name:"Name",field:"user_name",enableColumnMenu:!1,sort:{direction:"asc"}},{name:"Username",field:"username",enableColumnMenu:!1},{name:"User Type",field:"user_type",enableColumnMenu:!1}],exporterCsvFilename:"users.csv",onRegisterApi:function(b){a.gridApi=b,a.gridApi.grid.registerRowsProcessor(a.singleFilter,200),d(function(){a.gridApi.core.handleWindowResize()})}};var h=function(){c.getUsers(a.filters.status,function(b){var c=angular.fromJson(b);"success"==c.response&&(a.users=void 0!==c.nondata?[]:c.data,j(a.users))},function(){})},i=function(){h(),setTimeout(function(){var b=$(".full-height.datagrid").height();$("#grid1").css("height",b),a.gridApi.core.handleWindowResize()},100)};d(i,1e3),a.loadFilter=function(){a.loading=!0,h()};var j=function(c){a.gridOptions.data=c,a.loading=!1,b.loading=!1};a.filterDataTable=function(){a.gridApi.grid.refresh()},a.clearFilterDataTable=function(){a.gridFilter.filterValue="",a.gridApi.grid.refresh()},a.singleFilter=function(b){var c=new RegExp(a.gridFilter.filterValue,"i");return b.forEach(function(a){var b=!1;["user_name","username","user_type"].forEach(function(d){a.entity[d].match(c)&&(b=!0)}),b||(a.visible=!1)}),b},a.addUser=function(){a.openModal("users","userForm","md")},a.viewUser=function(b){a.openModal("users","userForm","md",b)},a.exportData=function(){a.gridApi.exporter.csvExport("visible","visible")},a.$on("refreshUsers",function(c,e){a.loading=!0,b.loading=!0,void 0!==e&&(a.updated=!0,a.notificationMsg=e.msg),a.refresh(),d(function(){a.alert.expired=!0},2e3),d(function(){a.updated=!1,a.notificationMsg="",a.alert.expired=!1},3e3)}),a.refresh=function(){a.loading=!0,b.loading=!0,h()},a.$on("$destroy",function(){b.isModal=!1})}]),angular.module("eduwebApp").controller("userFormCtrl",["$scope","$rootScope","$uibModalInstance","apiService","dialogs","data",function(a,b,c,d,e,f){a.edit=void 0!==f,a.user=f||{},a.initializeController=function(){},a.initializeController(),a.cancel=function(){c.dismiss("canceled")},a.save=function(c){if(!c.$invalid){var e=a.user;e.current_user_id=b.currentUser.user_id,a.edit?d.updateUser(e,g,h):d.addUser(e,g,h)}};var g=function(d,e,f){var g=angular.fromJson(d);if("success"==g.response){c.close();var h=a.edit?"User was updated.":"User was added.";b.$emit("userAdded",{msg:h,clear:!0})}else a.error=!0,a.errMsg=g.data},h=function(b,c){var d=angular.fromJson(b);a.error=!0,a.errMsg=d.data};a.deleteUser=function(){var c=e.confirm("Please Confirm","Are you sure you want to mark this user as deleted? ",{size:"sm"});c.result.then(function(c){var e={current_user_id:b.currentUser.user_id,user_id:a.user.user_id,status:"f"};d.setUserStatus(e,g,h)})},a.activateUser=function(){var c=e.confirm("Please Confirm","Are you sure you want to re-activate this user? ",{size:"sm"});c.result.then(function(c){var e={current_user_id:b.currentUser.user_id,user_id:a.user.user_id,status:"t"};d.setUserStatus(e,g,h)})}}]),angular.module("eduwebApp").factory("Auth",["$http","$rootScope","$window","Session","AUTH_EVENTS","ajaxService",function(a,b,c,d,e,f){var g={};return g.login=function(a,g,h){var i=window.location.host,j=i.indexOf("dev.eduweb.co.ke")>-1?"http://devapi.eduweb.co.ke":i.indexOf("eduweb.co.ke")>-1?"http://api.eduweb.co.ke":"http://api.eduweb.localhost",k=i.substr(0,i.indexOf(".")),l="parents"==k?"parentLogin":"login";f.AjaxPost(a,j+"/"+l,function(a){"success"==a.response?("login"==l?a.data.settings=a.data.settings.reduce(function(a,b){return a[b.name]=b.value,a},{}):a.data.user_type="PARENT",c.sessionStorage.userInfo=JSON.stringify(a.data),d.create(a.data),b.currentUser=a.data,b.$broadcast(e.loginSuccess),g(a.data)):b.$broadcast(e.loginFailed,{errorMsg:a.data})},function(a){b.$broadcast(e.loginFailed,{errorMsg:a.data}),h()})},g.isAuthenticated=function(){return!!d.user},g.isAuthorized=function(a){return angular.isArray(a)||(a=[a]),g.isAuthenticated()&&-1!==a.indexOf(d.userRole)},g.logout=function(){d.destroy(),c.sessionStorage.removeItem("userInfo"),b.$broadcast(e.logoutSuccess)},g}]),angular.module("eduwebApp").service("Session",["$rootScope","USER_ROLES",function(a,b){return this.create=function(a){this.user=a,this.userRole=a.user_type},this.destroy=function(){this.user=null,this.userRole=null},this}]),angular.module("eduwebApp").service("ajaxService",["$http","$rootScope",function(a,b){var c=0;return this.AjaxPost=function(c,d,e,f,g){a({method:"POST",url:d,headers:{"Content-Type":"application/x-www-form-urlencoded","X-SCHOOL-IDENTIFIER":b.clientIdentifier},transformRequest:function(a){var b=[];for(var c in a)b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&")},data:c}).success(function(a,b,c,d){e(a,b,g)}).error(function(a){f(a)})},this.AjaxPost2=function(c,d,e,f,g){a({method:"POST",url:d,headers:{"Content-Type":"application/x-www-form-urlencoded","X-SCHOOL-IDENTIFIER":b.clientIdentifier},data:c}).success(function(a,b,c,d){e(a,b,g)}).error(function(a){f(a)})},this.AjaxPut=function(c,d,e,f,g){a({method:"PUT",url:d,headers:{"Content-Type":"application/x-www-form-urlencoded","X-SCHOOL-IDENTIFIER":b.clientIdentifier},data:c}).success(function(a,b,c,d){e(a,b,g)}).error(function(a){f(a)})},this.AjaxDelete=function(c,d,e,f){a({method:"DELETE",url:c,headers:{"X-SCHOOL-IDENTIFIER":b.clientIdentifier}}).success(function(a,b,c,e){d(a,b,f)}).error(function(a){e(a)})},this.AjaxGet=function(c,d,e,f){a({method:"GET",url:c,headers:{"X-SCHOOL-IDENTIFIER":b.clientIdentifier}}).success(function(a,b,c,e){d(a,b,f)}).error(function(a){e(a)})},this.AjaxGetWithData=function(c,d,e,f,g){a({method:"GET",url:d,headers:{"X-SCHOOL-IDENTIFIER":b.clientIdentifier},params:c}).success(function(a,b,c,d){e(a,b,g)}).error(function(a){f(a)})},this.JSONPGet=function(d,e,f,g,h){1===++c&&b.$broadcast("loading:progress"),a.jsonp(e).success(function(a,d,e,g){0===--c&&b.$broadcast("loading:finish"),f(a,d,h)}).error(function(a){0===--c&&b.$broadcast("loading:finish"),g(a)})},this}]),angular.module("eduwebApp").service("apiService",["$rootScope","ajaxService",function(a,b){var c=window.location.host,d=c.indexOf("dev.eduweb.co.ke")>-1?"http://devapi.eduweb.co.ke":c.indexOf("eduweb.co.ke")>-1?"http://api.eduweb.co.ke":"http://api.eduweb.localhost";return this.getClassCats=function(a,c,e,f){void 0===a?b.AjaxGet(d+"/getClassCats",c,e,f):b.AjaxGet(d+"/getClassCats/"+a,c,e,f)},this.getClassCatsSummary=function(a,c,e,f){b.AjaxGetWithData(a,d+"/getClassCatsSummary",c,e,f)},this.addClassCat=function(a,c,e,f){b.AjaxPost2(a,d+"/addClassCat",c,e,f)},this.updateClassCat=function(a,c,e,f){b.AjaxPut(a,d+"/updateClassCat",c,e,f)},this.updateExamClass=function(a,c,e,f){b.AjaxPut(a,d+"/updateExamClass",c,e,f)},this.setClassCatStatus=function(a,c,e,f){b.AjaxPut(a,d+"/setClassCatStatus",c,e,f)},this.deleteClassCat=function(a,c,e,f){b.AjaxDelete(d+"/deleteClassCat/"+a,c,e,f)},this.checkClassCat=function(a,c,e,f){b.AjaxGet(d+"/checkClassCat/"+a,c,e,f)},this.getEmpCats=function(a,c,e,f){b.AjaxGetWithData(a,d+"/getEmployeeCats",c,e,f)},this.addEmployeeCat=function(a,c,e,f){b.AjaxPost2(a,d+"/addEmployeeCat",c,e,f)},this.updateEmployeeCat=function(a,c,e,f){b.AjaxPut(a,d+"/updateEmployeeCat",c,e,f)},this.setEmployeeCatStatus=function(a,c,e,f){b.AjaxPut(a,d+"/setEmployeeCatStatus",c,e,f)},this.deleteEmpCat=function(a,c,e,f){b.AjaxDelete(d+"/deleteEmpCat/"+a,c,e,f);
},this.checkEmpCat=function(a,c,e,f){b.AjaxGet(d+"/checkEmpCat/"+a,c,e,f)},this.getDepts=function(a,c,e,f){void 0===a?b.AjaxGet(d+"/getDepartments",c,e,f):b.AjaxGet(d+"/getDepartments/"+a,c,e,f)},this.getDeptSummary=function(a,c,e,f){b.AjaxGetWithData(a,d+"/getDeptSummary",c,e,f)},this.checkDepartment=function(a,c,e,f){b.AjaxGet(d+"/checkDepartment/"+a,c,e,f)},this.setDeptStatus=function(a,c,e,f){b.AjaxPut(a,d+"/setDeptStatus",c,e,f)},this.addDept=function(a,c,e,f){b.AjaxPost2(a,d+"/addDepartment",c,e,f)},this.updateDept=function(a,c,e,f){b.AjaxPut(a,d+"/updateDepartment",c,e,f)},this.deleteDept=function(a,c,e,f){b.AjaxDelete(d+"/deleteDept/"+a,c,e,f)},this.updateSetting=function(a,c,e,f){b.AjaxPut(a,d+"/updateSetting",c,e,f)},this.updateSettings=function(a,c,e,f){b.AjaxPut(a,d+"/updateSettings",c,e,f)},this.getSettings=function(a,c,e,f){b.AjaxGetWithData(a,d+"/getSettings",c,e,f)},this.getGrading=function(a,c,e,f){b.AjaxGetWithData(a,d+"/getGrading",c,e,f)},this.addGrading=function(a,c,e,f){b.AjaxPost2(a,d+"/addGrading",c,e,f)},this.updateGrading=function(a,c,e,f){b.AjaxPut(a,d+"/updateGrading",c,e,f)},this.getCountries=function(a,c,e,f){b.AjaxGetWithData(a,d+"/getCountries",c,e,f)},this.getInstallmentOptions=function(a,c,e,f){b.AjaxGetWithData(a,d+"/getInstallmentOptions",c,e,f)},this.getAllClasses=function(a,c,e,f){b.AjaxGetWithData(a,d+"/getAllClasses",c,e,f)},this.getTeacherClasses=function(a,c,e,f){b.AjaxGet(d+"/getTeacherClasses/"+a,c,e,f)},this.getClasses=function(a,c,e,f){b.AjaxGet(d+"/getClasses/"+a,c,e,f)},this.addClass=function(a,c,e,f){b.AjaxPost2(a,d+"/addClass",c,e,f)},this.updateClass=function(a,c,e,f){b.AjaxPut(a,d+"/updateClass",c,e,f)},this.updateTeacherSubject=function(a,c,e,f){b.AjaxPut(a,d+"/updateTeacherSubject",c,e,f)},this.setClassStatus=function(a,c,e,f){b.AjaxPut(a,d+"/setClassStatus",c,e,f)},this.setClassSortOrder=function(a,c,e,f){b.AjaxPut(a,d+"/setClassSortOrder",c,e,f)},this.deleteClass=function(a,c,e,f){b.AjaxDelete(d+"/deleteClass/"+a,c,e,f)},this.checkClass=function(a,c,e,f){b.AjaxGet(d+"/checkClass/"+a,c,e,f)},this.getFeeItems=function(a,c,e){b.AjaxGet(d+"/getFeeItems/"+a,c,e)},this.getTansportRoutes=function(a,c,e){b.AjaxGetWithData(a,d+"/getTansportRoutes",c,e)},this.getReplaceableFeeItems=function(a,c,e,f){b.AjaxGet(d+"/getReplaceableFeeItems/"+a,c,e,f)},this.getStudentFeeItems=function(a,c,e,f){b.AjaxGet(d+"/getStudentFeeItems/"+a,c,e,f)},this.addFeeItem=function(a,c,e,f){b.AjaxPost2(a,d+"/addFeeItem",c,e,f)},this.updateFeeItem=function(a,c,e,f){b.AjaxPut(a,d+"/updateFeeItem",c,e,f)},this.setFeeItemStatus=function(a,c,e,f){b.AjaxPut(a,d+"/setFeeItemStatus",c,e,f)},this.updateRoutes=function(a,c,e,f){b.AjaxPut(a,d+"/updateRoutes",c,e,f)},this.deleteFeeItem=function(a,c,e,f){b.AjaxDelete(d+"/deleteFeeItem/"+a,c,e,f)},this.checkFeeItem=function(a,c,e,f){b.AjaxGet(d+"/checkFeeItem/"+a,c,e,f)},this.getTerms=function(a,c,e,f){void 0===a?b.AjaxGet(d+"/getTerms",c,e,f):b.AjaxGet(d+"/getTerms/"+a,c,e,f)},this.addTerm=function(a,c,e,f){b.AjaxPost2(a,d+"/addTerm",c,e,f)},this.updateTerm=function(a,c,e,f){b.AjaxPut(a,d+"/updateTerm",c,e,f)},this.getCurrentTerm=function(a,c,e,f){b.AjaxGetWithData(a,d+"/getCurrentTerm",c,e,f)},this.getPreviousTerm=function(a,c,e,f){b.AjaxGetWithData(a,d+"/getPreviousTerm",c,e,f)},this.getNextTerm=function(a,c,e,f){void 0===a?b.AjaxGet(d+"/getNextTerm",c,e,f):b.AjaxGet(d+"/getNextTerm/"+a,c,e,f)},this.getTermRange=function(a,c,e,f){b.AjaxGetWithData(a,d+"/getTermRange",c,e,f)},this.deleteTerm=function(a,c,e,f){b.AjaxDelete(d+"/deleteTerm/"+a,c,e,f)},this.getAllSubjects=function(a,c,e,f){b.AjaxGet(d+"/getAllSubjects/"+a,c,e,f)},this.getAllTeacherSubjects=function(a,c,e,f){b.AjaxGet(d+"/getAllTeacherSubjects/"+a,c,e,f)},this.getTeacherSubjects=function(a,c,e,f){b.AjaxGet(d+"/getTeacherSubjects/"+a,c,e,f)},this.getTeacherClassSubjects=function(a,c,e,f){b.AjaxGet(d+"/getTeacherClassSubjects/"+a,c,e,f)},this.getSubjects=function(a,c,e,f){b.AjaxGet(d+"/getSubjects/"+a,c,e,f)},this.addSubject=function(a,c,e,f){b.AjaxPost2(a,d+"/addSubject",c,e,f)},this.updateSubject=function(a,c,e,f){b.AjaxPut(a,d+"/updateSubject",c,e,f)},this.setSubjectStatus=function(a,c,e,f){b.AjaxPut(a,d+"/setSubjectStatus",c,e,f)},this.setSubjectSortOrder=function(a,c,e,f){b.AjaxPut(a,d+"/setSubjectSortOrder",c,e,f)},this.deleteSubject=function(a,c,e,f){b.AjaxDelete(d+"/deleteSubject/"+a,c,e,f)},this.checkSubject=function(a,c,e,f){b.AjaxGet(d+"/checkSubject/"+a,c,e,f)},this.getAllTeachers=function(a,c,e){b.AjaxGet(d+"/getAllTeachers/"+a,c,e)},this.getAllEmployees=function(a,c,e){b.AjaxGet(d+"/getAllEmployees/"+a,c,e)},this.addEmployee=function(a,c,e,f){b.AjaxPost2(a,d+"/addEmployee",c,e,f)},this.getEmployeeDetails=function(a,c,e,f){b.AjaxGet(d+"/getEmployeeDetails/"+a,c,e,f)},this.updateEmployee=function(a,c,e,f){b.AjaxPut(a,d+"/updateEmployee",c,e,f)},this.getExamTypes=function(a,c,e,f){void 0===a?b.AjaxGet(d+"/getExamTypes",c,e,f):b.AjaxGet(d+"/getExamTypes/"+a,c,e,f)},this.deleteExamType=function(a,c,e,f){b.AjaxDelete(d+"/deleteExamType/"+a,c,e,f)},this.addExamMarks=function(a,c,e,f){b.AjaxPost2(a,d+"/addExamMarks",c,e,f)},this.getClassExams=function(a,c,e,f){b.AjaxGet(d+"/getClassExams/"+a,c,e,f)},this.getAllClassExams=function(a,c,e,f){b.AjaxGet(d+"/getAllClassExams/"+a,c,e,f)},this.addExamType=function(a,c,e,f){b.AjaxPost2(a,d+"/addExamType",c,e,f)},this.getClassExamMarks=function(a,c,e,f){b.AjaxGet(d+"/getClassExamMarks/"+a,c,e,f)},this.getTopStudents=function(a,c,e,f){void 0===a?b.AjaxGet(d+"/getTopStudents",c,e,f):b.AjaxGet(d+"/getTopStudents/"+a,c,e,f)},this.getTeacherTopStudents=function(a,c,e,f){b.AjaxGet(d+"/getTeacherTopStudents/"+a,c,e,f)},this.setExamTypeSortOrder=function(a,c,e,f){b.AjaxPut(a,d+"/setExamTypeSortOrder",c,e,f)},this.getAllStudentReportCards=function(a,c,e,f){b.AjaxGet(d+"/getAllStudentReportCards/"+a,c,e,f)},this.getStudentReportCards=function(a,c,e,f){b.AjaxGet(d+"/getStudentReportCards/"+a,c,e,f)},this.getStudentReportCard=function(a,c,e,f){b.AjaxGet(d+"/getStudentReportCard/"+a,c,e,f)},this.getExamMarksforReportCard=function(a,c,e,f){b.AjaxGet(d+"/getExamMarksforReportCard/"+a,c,e,f)},this.addReportCard=function(a,c,e,f){b.AjaxPost2(a,d+"/addReportCard",c,e,f)},this.deleteReportCard=function(a,c,e,f){b.AjaxDelete(d+"/deleteReportCard/"+a,c,e,f)},this.getAllStudents=function(a,c,e,f){b.AjaxGet(d+"/getAllStudents/"+a,c,e,f)},this.getAllParents=function(a,c,e,f){b.AjaxGetWithData(a,d+"/getAllParents",c,e,f)},this.getTeacherStudents=function(a,c,e,f){b.AjaxGet(d+"/getTeacherStudents/"+a,c,e,f)},this.getTeacherParents=function(a,c,e,f){b.AjaxGet(d+"/getTeacherParents/"+a,c,e,f)},this.getStudentDetails=function(a,c,e,f){b.AjaxGet(d+"/getStudentDetails/"+a,c,e,f)},this.getStudentBalance=function(a,c,e,f){b.AjaxGet(d+"/getStudentBalance/"+a,c,e,f)},this.getStudentInvoices=function(a,c,e,f){b.AjaxGet(d+"/getStudentInvoices/"+a,c,e,f)},this.getStudentPayments=function(a,c,e,f){b.AjaxGet(d+"/getStudentPayments/"+a,c,e,f)},this.getStudentCredits=function(a,c,e,f){b.AjaxGet(d+"/getStudentCredits/"+a,c,e,f)},this.getStudentArrears=function(a,c,e,f){b.AjaxGet(d+"/getStudentArrears/"+a,c,e,f)},this.getStudentExamMarks=function(a,c,e,f){b.AjaxGet(d+"/getStudentExamMarks/"+a,c,e,f)},this.getAllStudentExamMarks=function(a,c,e,f){b.AjaxGet(d+"/getAllStudentExamMarks/"+a,c,e,f)},this.postStudent=function(a,c,e,f){b.AjaxPost2(a,d+"/addStudent",c,e,f)},this.updateStudent=function(a,c,e,f){b.AjaxPut(a,d+"/updateStudent",c,e,f)},this.getAllGuardians=function(a,c,e,f){b.AjaxGet(d+"/getAllGuardians/"+a,c,e,f)},this.getGuardiansChildren=function(a,c,e,f){b.AjaxGet(d+"/getGuardiansChildren/"+a,c,e,f)},this.getMISLogin=function(a,c,e,f){b.AjaxGet(d+"/getMISLogin/"+a,c,e,f)},this.checkUsername=function(a,c,e,f){b.AjaxGet(d+"/checkUsername/"+a,c,e,f)},this.checkIdNumber=function(a,c,e,f){b.AjaxGet(d+"/checkIdNumber/"+a,c,e,f)},this.checkAdmNumber=function(a,c,e,f){b.AjaxGet(d+"/checkAdmNumber/"+a,c,e,f)},this.postGuardian=function(a,c,e,f){b.AjaxPost2(a,d+"/addGuardian",c,e,f)},this.updateGuardian=function(a,c,e,f){b.AjaxPut(a,d+"/updateGuardian",c,e,f)},this.deleteGuardian=function(a,c,e,f){b.AjaxDelete(d+"/deleteGuardian/"+a,c,e,f)},this.postMedicalConditions=function(a,c,e,f){b.AjaxPost2(a,d+"/addMedicalConditions",c,e,f)},this.updateMedicalConditions=function(a,c,e,f){b.AjaxPut(a,d+"/updateMedicalConditions",c,e,f)},this.deleteMedicalCondition=function(a,c,e,f){b.AjaxDelete(d+"/deleteMedicalCondition/"+a,c,e,f)},this.getStudentClasses=function(a,c,e,f){b.AjaxGet(d+"/getStudentClasses/"+a,c,e,f)},this.adminDeleteStudent=function(a,c,e,f){b.AjaxDelete(d+"/adminDeleteStudent/"+a,c,e,f)},this.getPaymentsReceived=function(a,c,e,f){b.AjaxGet(d+"/getPaymentsReceived/"+a,c,e,f)},this.getPaymentsDue=function(a,c,e,f){b.AjaxGet(d+"/getPaymentsDue/"+a,c,e,f)},this.getPaymentsPastDue=function(a,c,e,f){b.AjaxGet(d+"/getPaymentsPastDue",c,e,f)},this.getTotalsForTerm=function(a,c,e,f){b.AjaxGet(d+"/getTotalsForTerm",c,e,f)},this.getStudentBalances=function(a,c,e,f){b.AjaxGet(d+"/getStudentBalances/"+a,c,e,f)},this.addPayment=function(a,c,e,f){b.AjaxPost2(a,d+"/addPayment",c,e,f)},this.getPaymentDetails=function(a,c,e,f){b.AjaxGet(d+"/getPaymentDetails/"+a,c,e,f)},this.updatePayment=function(a,c,e,f){b.AjaxPut(a,d+"/updatePayment",c,e,f)},this.reversePayment=function(a,c,e,f){b.AjaxPut(a,d+"/reversePayment",c,e,f)},this.reactivatePayment=function(a,c,e,f){b.AjaxPut(a,d+"/reactivatePayment",c,e,f)},this.deletePayment=function(a,c,e,f){b.AjaxDelete(d+"/deletePayment/"+a,c,e,f)},this.getInvoices=function(a,c,e,f){b.AjaxGet(d+"/getInvoices/"+a,c,e,f)},this.getOpenInvoices=function(a,c,e,f){b.AjaxGet(d+"/getOpenInvoices/"+a,c,e,f)},this.getInvoiceDetails=function(a,c,e,f){b.AjaxGet(d+"/getInvoiceDetails/"+a,c,e,f)},this.generateInvoices=function(a,c,e,f){b.AjaxGet(d+"/generateInvoices/"+a,c,e,f)},this.createInvoice=function(a,c,e,f){b.AjaxPost2(a,d+"/createInvoice",c,e,f)},this.updateInvoice=function(a,c,e,f){b.AjaxPut(a,d+"/updateInvoice",c,e,f)},this.cancelInvoice=function(a,c,e,f){b.AjaxPut(a,d+"/cancelInvoice",c,e,f)},this.reactivateInvoice=function(a,c,e,f){b.AjaxPut(a,d+"/reactivateInvoice",c,e,f)},this.deleteInvoice=function(a,c,e,f){b.AjaxDelete(d+"/deleteInvoice/"+a,c,e,f)},this.getUsers=function(a,c,e,f){void 0===a?b.AjaxGet(d+"/getUsers",c,e,f):b.AjaxGet(d+"/getUsers/"+a,c,e,f)},this.setUserStatus=function(a,c,e,f){b.AjaxPut(a,d+"/setUserStatus",c,e,f)},this.addUser=function(a,c,e,f){b.AjaxPost2(a,d+"/addUser",c,e,f)},this.updateUser=function(a,c,e,f){b.AjaxPut(a,d+"/updateUser",c,e,f)},this.getClassPosts=function(a,c,e,f){b.AjaxGet(d+"/getClassPosts/"+a,c,e,f)},this.getBlogPostTypes=function(a,c,e,f){b.AjaxGetWithData(a,d+"/getBlogPostTypes",c,e,f)},this.getBlogPostStatuses=function(a,c,e,f){b.AjaxGetWithData(a,d+"/getBlogPostStatuses",c,e,f)},this.getPost=function(a,c,e,f){b.AjaxGet(d+"/getPost/"+a,c,e,f)},this.addBlog=function(a,c,e,f){b.AjaxPost2(a,d+"/addBlog",c,e,f)},this.addPost=function(a,c,e,f){b.AjaxPost2(a,d+"/addPost",c,e,f)},this.updatePost=function(a,c,e,f){b.AjaxPut(a,d+"/updatePost",c,e,f)},this.updateBlog=function(a,c,e,f){b.AjaxPut(a,d+"/updateBlog",c,e,f)},this.deletePost=function(a,c,e,f){b.AjaxDelete(d+"/deletePost/"+a,c,e,f)},this.getHomeworkPosts=function(a,c,e,f){b.AjaxGet(d+"/getHomeworkPosts/"+a,c,e,f)},this.getHomeworkPost=function(a,c,e,f){b.AjaxGet(d+"/getHomeworkPost/"+a,c,e,f)},this.addHomework=function(a,c,e,f){b.AjaxPost2(a,d+"/addHomework",c,e,f)},this.updateHomework=function(a,c,e,f){b.AjaxPut(a,d+"/updateHomework",c,e,f)},this.deleteHomework=function(a,c,e,f){b.AjaxDelete(d+"/deleteHomework/"+a,c,e,f)},this.getCommunicationOptions=function(a,c,e,f){b.AjaxGetWithData(a,d+"/getCommunicationOptions",c,e,f)},this.getTeacherCommunications=function(a,c,e,f){b.AjaxGet(d+"/getTeacherCommunications/"+a,c,e,f)},this.getSchoolCommunications=function(a,c,e,f){b.AjaxGetWithData(a,d+"/getSchoolCommunications",c,e,f)},this.addCommunication=function(a,c,e,f){b.AjaxPost2(a,d+"/addCommunication",c,e,f)},this.getCommunication=function(a,c,e,f){b.AjaxGet(d+"/getCommunication/"+a,c,e,f)},this.updateCommunication=function(a,c,e,f){b.AjaxPut(a,d+"/updateCommunication",c,e,f)},this.deleteCommunication=function(a,c,e,f){b.AjaxDelete(d+"/deleteCommunication/"+a,c,e,f)},this}]);